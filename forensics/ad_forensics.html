<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-forensics/ad_forensics" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Forensische Analyse von Active Directory Datenbanken | Jan Starke</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://janstarke.github.io/img/fox/fuchs_blau_32.png"><meta data-rh="true" name="twitter:image" content="https://janstarke.github.io/img/fox/fuchs_blau_32.png"><meta data-rh="true" property="og:url" content="https://janstarke.github.io/forensics/ad_forensics"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Forensische Analyse von Active Directory Datenbanken | Jan Starke"><meta data-rh="true" name="description" content="Übersicht"><meta data-rh="true" property="og:description" content="Übersicht"><link data-rh="true" rel="icon" href="/img/fox/fuchs_blau.ico"><link data-rh="true" rel="canonical" href="https://janstarke.github.io/forensics/ad_forensics"><link data-rh="true" rel="alternate" href="https://janstarke.github.io/forensics/ad_forensics" hreflang="en"><link data-rh="true" rel="alternate" href="https://janstarke.github.io/forensics/ad_forensics" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Jan Starke RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Jan Starke Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2472801d.css">
<script src="/assets/js/runtime~main.c84d33ce.js" defer="defer"></script>
<script src="/assets/js/main.c5ff6397.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/fox/fuchs_blau_32.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/fox/fuchs_blau_32.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Jan Starke</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/janstarke" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Cool tools</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/category/forensics">Forensics</a><button aria-label="Collapse sidebar category &#x27;Forensics&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/forensics/ad_forensics">Forensische Analyse von Active Directory Datenbanken</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/forensics/snippets">Forensic snippets for me and you</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/forensics/triage">Forensic triage and data gathering</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/development">Development</a><button aria-label="Collapse sidebar category &#x27;Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/pbc4rust">PBC4Rust</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/forensics"><span itemprop="name">Forensics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Forensische Analyse von Active Directory Datenbanken</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Forensische Analyse von Active Directory Datenbanken mit <code>ntdsextract2</code></h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="übersicht">Übersicht<a class="hash-link" aria-label="Direct link to Übersicht" title="Direct link to Übersicht" href="/forensics/ad_forensics#übersicht">​</a></h2>
<p>Viele komplexe Angriffe gegen Unternehmensnetzwerke finden in mehreren Phasen statt:</p>
<ol>
<li>Informationsgewinnung</li>
<li>Initialer Zugriff: bspw. Ausnutzen einer Schwachstelle in einer Software</li>
<li>Persistenz: Sicherstellen, dass ein späterer Zugriff auf das System möglich ist, auch wenn bspw. die ausgenutzte Schwachstelle geschlossen wurde</li>
<li>Rechteausweitung: Übernahme eines Benutzerkontos mit weitergehenden Rechten</li>
</ol>
<p>und so weiter...</p>
<p>Die Benutzerkonten, Passwörter, Berechtigungen etc. werden in den meisten Unternehmensnetzwerken in einem Active Directory (<a href="/forensics/ad_forensics#AD">AD</a>) verwaltet. Deswegen ist das <a href="/forensics/ad_forensics#AD">AD</a> ein für Angreifer interessantes Mittel sowohl für Persistenz als auch für die Rechteausweitung. Dazu sind aktuell folgende Optionen bekannt:</p>
<ul>
<li>versteckte Benutzerkonten unter der Kontrolle des Angreifers</li>
<li>privilegierte Mitgliedschaften von Benutzerkonten, die eigentlich wenig Rechte haben sollten</li>
<li>privilegierte Computerkonten unter der Kontrolle des Angreifers</li>
</ul>
<p>Außerdem hinterlassen viele Angriffe auch unbeabsichtigt Spuren im Active Directory, die bei der Analyse genutzt werden können, bspw. neu angelegte Computerkonten.</p>
<p>Ziel des Artikels ist, Grundzüge der forensischen Analyse von <a href="/forensics/ad_forensics#AD">AD</a>-Datenbanken zu vermitteln. Es wird zunächst beschrieben, wie die <a href="/forensics/ad_forensics#AD">AD</a>-Datenbank aufgebaut ist, und was bei der forensischen Sicherung zu beachten ist. Abschließend wird gezeigt, wie man eine forensische Analyse einer <a href="/forensics/ad_forensics#AD">AD</a>-Datenbank mit <code>ntdsextract2</code> <a href="/forensics/ad_forensics#a1">[1]</a> durchführen kann. Um das möglichst einfach anschaulich zu gestalten, wurde eine einfache <a href="/forensics/ad_forensics#AD">AD</a>-Datenbank verwendet. In dieser Datenbank sind keine konkreten Angriffsspuren zu finden; der Artikel beschäftigt sich ausschließlich mit der Vorgehensweise bei der forensischen Arbeit; jedoch nicht mit konkreten Angriffsmethoden.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="spurensicherung">Spurensicherung<a class="hash-link" aria-label="Direct link to Spurensicherung" title="Direct link to Spurensicherung" href="/forensics/ad_forensics#spurensicherung">​</a></h2>
<p>Wir haben von einem Domain Controller des angegriffenen Netzwerks die Datei <code>%windir%\NTDS\ntds</code>.dit gesichert. Diese Datei ist eine Jet-Datenbank, in der die <a href="/forensics/ad_forensics#AD">AD</a>-Objekte gespeichert sind. Außerdem haben wir alle Log-Dateien mit gesichert. Es besteht die Möglichkeit, dass einige Inhalte noch nicht in die <code>ntds.dit</code> zurückgeschrieben wurden. Wir müssen also in der Lage sein, eine vollständig synchrone Variante der <a href="/forensics/ad_forensics#AD">AD</a>-Datenbank zu schreiben. In Summe haben wir folgende Dateien gesichert:</p>
<table><thead><tr><th>Datei</th><th>Beschreibung</th><th>Wichtig für Forensik?</th></tr></thead><tbody><tr><td><code>ntds.dit</code></td><td>AD Datenbank</td><td>✔️</td></tr><tr><td><code>edb.log</code></td><td>Transaction-Log für ntds.dit</td><td>✔️</td></tr><tr><td><code>edbxxxxx.log</code></td><td>Zusätzliche Transaction-Log-Dateien. Diese werden geschrieben, wenn <code>edb.log</code> voll ist, bevor die Logs in die <code>ntds.dit</code> zurückgeschrieben werden</td><td>✔️</td></tr><tr><td><code>res1.log</code> und <code>res2.log</code></td><td>Reserve-Logdateien. Diese enthalten keine Daten (theoretisch), sondern blockieren nur Speicherplatz. Wenn der Plattenplatz knapp wird, dann wird Speicherplatz dieser beiden Dateien genutzt, um die <code>edbxxxxx.log</code> schreiben zu können.</td><td>❌</td></tr><tr><td><code>temp.ed</code></td><td>&quot;Notizblock&quot; für die Arbeit mit der <code>ntds.dit</code></td><td>❌</td></tr><tr><td><code>schema.ini</code></td><td>Schemabeschreibung für die initiale Einrichtung des <a href="/forensics/ad_forensics#AD">AD</a> Schema</td><td>❌</td></tr></tbody></table>
<p>Sollte sich herausstellen, dass die <code>ntds.dit</code> nicht sauber ist, oder dass Informationen fehlen, dann müssen die Informationen in den Transaction-Logs zurückgespielt werden. Dafür wird das Programm <code>esentutl</code> genutzt; aber das ist nicht Thema dieses Artikels.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Für diesen Artikel habe ich eine öffentliche <a href="/forensics/ad_forensics#AD">AD</a> Datenbank von Didier Stevens <a href="/forensics/ad_forensics#a2">[2]</a> genutzt, die speziell für Lernzwecke zur Verfügung gestellt wurde.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="daten-in-der-ntdsdit">Daten in der <code>ntds.dit</code><a class="hash-link" aria-label="Direct link to daten-in-der-ntdsdit" title="Direct link to daten-in-der-ntdsdit" href="/forensics/ad_forensics#daten-in-der-ntdsdit">​</a></h3>
<p>Die Datei <code>ntds.dit</code> enthält — technisch gesehen — zunächst einmal eine EseDB-Datenbank (Extensible Storage Engine) mit mehreren Tabellen. Die Daten des Active Directory liegen in der Tabelle datatable; viele Verknüpfungen zwischen Objekten, bspw. Gruppenmitgliedschaften, sind in der Tabelle <code>link_table</code> gespeichert.</p>
<p>Jedes <a href="/forensics/ad_forensics#AD">AD</a>-Objekt entspricht einer Zeile (engl. <code>row</code>) der Tabelle <code>datatable</code>. Diese Tabelle hat eine Vielzahl von Spalten, je nachdem, wie genau das Schema des <a href="/forensics/ad_forensics#AD">AD</a> aussieht. Für jedes Attribut eines <a href="/forensics/ad_forensics#AD">AD</a>-Objekts existiert eine Spalte. Der Datentyp der Spalte sowie die Interpretation des Wertes obliegt dem Programm, das den Wert ausliest. Angenommen, wir wollen herausfinden, ob ein Account abgelaufen ist. Dann müssen wir folgende Schritte durchführen</p>
<p>Wir ermitteln die Spalte mit dem Namen <code>ATTq589983</code> und lesen den Wert aus</p>
<p>Der Wert in der Spalte ist (im Beispiel) <code>9223372036854775807</code>, mit dem Datentyp <code>Currency</code> (Währung). Natürlich handelt es sich nicht um Geld, sondern einfach um eine 64 Bit große Zahl, die die Anzahl der 100 Nanosekunden seit 01.01.1601 angibt <a href="/forensics/ad_forensics#a3">[3]</a>, und zwar in <a href="/forensics/ad_forensics#UTC">UTC</a>. Diese Zahl entspricht dem Zeitstempel <code>9999-12-31T23:59:59+0000</code>.</p>
<p>Theoretisch. Tatsächlich ist diese Zahl auch gleichzeitig die größte Zahl, die als 64 Bit mit Vorzeichen darstellbar ist. Microsoft hat diesen Wert vorgesehen, um zu speichern, dass ein Account nie abläuft <a href="/forensics/ad_forensics#a4">[4]</a>.</p>
<p>Die Antwort ist also: Der Account ist nicht abgelaufen.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="record-id-und-row-id"><em>Record ID</em> und <em>Row ID</em><a class="hash-link" aria-label="Direct link to record-id-und-row-id" title="Direct link to record-id-und-row-id" href="/forensics/ad_forensics#record-id-und-row-id">​</a></h3>
<p>Die Einträge in der <code>datatable</code> können normalerweise mit dem Attribute <code>DsRecordId</code> eindeutig identifiziert werden. Dieses Attribut wird nachfolgend mit <em>Record ID</em> bezeichnet und ist eine Eigenschaft eines <a href="/forensics/ad_forensics#AD">AD</a>-Objekts.</p>
<p>Allerdings nutzen einige Verknüpfungen nicht das Feld <code>DsRecordId</code>, sondern die Nummer der Zeile in der <code>datatable</code>. Das ist beispielsweise bei der Speicherung von Gruppenmitgliedschaften der Fall. Aus diesem Grund wird von <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> zusätzlich zur <em>Record ID</em> auch immer die Zeilennummer (<em>Row ID</em>) mit ausgelesen und verwendet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="timeline-analyse">Timeline-Analyse<a class="hash-link" aria-label="Direct link to Timeline-Analyse" title="Direct link to Timeline-Analyse" href="/forensics/ad_forensics#timeline-analyse">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="zeitstempel">Zeitstempel<a class="hash-link" aria-label="Direct link to Zeitstempel" title="Direct link to Zeitstempel" href="/forensics/ad_forensics#zeitstempel">​</a></h3>
<p>Obwohl EseDB einen eigenen Datentyp für Zeitstempel hat, nutzt <a href="/forensics/ad_forensics#AD">AD</a> den Datentyp <code>Currency</code>, um einen Zeitstempel im Format <a href="/forensics/ad_forensics#filetime">FILETIME</a> zu speichern. Einige Werte haben eine besondere Bedeutung, die bei der forensischen Analyse berücksichtigt werden sollte:</p>
<table><thead><tr><th>Attribut</th><th>Bedeutung von <code>0x0000000000000000</code></th><th>Bedeutung von <code>0x7FFFFFFFFFFFFFFF</code></th></tr></thead><tbody><tr><td><code>record_time</code></td><td></td><td></td></tr><tr><td><code>when_created</code></td><td></td><td></td></tr><tr><td><code>when_created</code></td><td></td><td></td></tr><tr><td><code>last_logon</code></td><td>Es ist unbekannt, wann die letzte Anmeldung war</td><td></td></tr><tr><td><code>last_logon_time_stamp</code></td><td>Es ist unbekannt, wann die letzte Anmeldung war</td><td></td></tr><tr><td><code>account_expires</code></td><td>&quot;Wenn zu einem beliebigen Zeitpunkt ein Konto, das mit einer Ablaufzeit konfiguriert wurde, auf Nie läuft ab, wird das <code>accountExpires</code>-Attribut auf 0 festgelegt.&quot; <a href="/forensics/ad_forensics#accountExpires">[6]</a></td><td>&quot;Wenn ein Konto erstellt wird, wird das Konto zunächst auf Nie ablaufen festgelegt. Das accountExpires-Attribut ist auf den Standardwert von <code>9223372036854775807</code> festgelegt, ein Wert, der dem Höchstwert einer 64-Bit-Ganzzahl mit Vorzeichen entspricht.&quot;<a href="/forensics/ad_forensics#accountExpires">[6]</a></td></tr><tr><td><code>password_last_set</code></td><td>Wenn das <a href="/forensics/ad_forensics#UAC">UAC</a>-Flag <code>UF_DONT_EXPIRE_PASSWD</code> nicht gesetzt ist, dann muss der Benutzer das Passwort bei der nächsten Anmeldung ändern.</td><td></td></tr><tr><td><code>bad_pwd_time</code></td><td>Es ist unbekannt, wann der letzte erfolglose Anmeldeversuch war</td><td></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="erstellen-der-timeline">Erstellen der Timeline<a class="hash-link" aria-label="Direct link to Erstellen der Timeline" title="Direct link to Erstellen der Timeline" href="/forensics/ad_forensics#erstellen-der-timeline">​</a></h3>
<p>Zunächst verschaffen wir uns einen Überblick über die Aktivitäten in der Datenbank innerhalb eines bestimmten Zeitraums. Wir nutzen dafür die Programme <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> und <a href="/forensics/ad_forensics#mactime"><code>mactime2</code></a>, und zur schöneren Darstellung <a href="/forensics/ad_forensics#xsv"><code>xsv</code></a>. Das Kommando</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ntdsextract2 ntds.dit timeline | mactime2 -d | xsv table</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>erzeugt folgende Ausgabe:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T08:05:50+00:00  0   m...      0   0   1817  SUPPORT_388945a0 (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T08:15:31+00:00  0   m...      0   0   1861  krbtgt (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T08:15:59+00:00  0   m...      0   0   1836  ADDEMO$ (Computer, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:01:44+00:00  0   m...      0   0   1815  Administrator (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:22+00:00  0   .a..      0   0   1815  Administrator (Person, last logon on this DC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:23+00:00  0   .a..      0   0   1836  ADDEMO$ (Computer, last logon on this DC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:29+00:00  0   m...      0   0   3276  user01 (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:35+00:00  0   m...      0   0   3277  user02 (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:35+00:00  0   m...      0   0   3278  user03 (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2016-07-10T10:55:35+00:00  0   m...      0   0   3279  user04 (Person, password last set)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Das ist eine chronologisch sortierte Abfolge von Ereignissen, die im untersuchten <a href="/forensics/ad_forensics#AD">AD</a> stattgefunden haben. Man kann hier mehrere Informationen sehen:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>2016-07-10T08:05:50+00:00</code></td><td>Das ist ein Zeitstempel in einem <a href="/forensics/ad_forensics#RFC3339">RFC3339</a>-konformen Format.</td></tr><tr><td><code>SUPPORT_388945a0 (Person, password last set)</code></td><td>Der Name des Objekts ist <code>SUPPORT_388945a0</code>, der Objekttyp ist Person (was einem Benutzerkonto entspricht), und zu der angegebenen Zeit wurde das Passwort des Accounts gesetzt.</td></tr><tr><td><code>1817</code></td><td>In der Ausgabe von <a href="/forensics/ad_forensics#mactime2"><code>mactime2</code></a> steht hier normalerweise die <em>Inode ID</em>, als eindeutige ID einer Datei im Dateisystem. Das <a href="/forensics/ad_forensics#AD">AD</a> hat keine Inodes, wohl aber eine <em>Record ID</em> (im Attribut <code>DsRecordId</code>). <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> schreibt diese Zahl in das Inode-Feld.</td></tr><tr><td><code>last logon on this DC</code></td><td>Dieser Zeitstempel gibt an, wann sich der Benutzer an diesem Domain Controller angemeldet hat. Wenn man eine Kopie der <code>ntds.dit</code> von einem anderen Domain Controller analysieren würde, würde bei diesem Timestamp die Meldung <code>last logon on any DC</code> stehen.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unterstützte-timestamps">Unterstützte Timestamps<a class="hash-link" aria-label="Direct link to Unterstützte Timestamps" title="Direct link to Unterstützte Timestamps" href="/forensics/ad_forensics#unterstützte-timestamps">​</a></h3>
<p><a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> kann aktuell folgende Timestamps darstellen:</p>
<table><thead><tr><th>Attribut</th><th>Meldung</th><th>Beschreibung</th></tr></thead><tbody><tr><td><code>DsRecordTime</code></td><td><code>record creation time</code></td><td>Erstellung des AD-Eintrags</td></tr><tr><td><code>AttWhenCreated</code></td><td><code>object created</code></td><td>Erstellung des Objekts</td></tr><tr><td><code>AttWhenChanged</code></td><td><code>object changed</code></td><td>Letzte Änderung des Objekts</td></tr><tr><td><code>AttLastLogon</code></td><td><code>last logon on this DC</code></td><td>Letzte Anmeldung an diesem DC</td></tr><tr><td><code>AttLastLogonTimestamp</code></td><td><code>last logon on any DC</code></td><td>Letzte Anmeldung an einem anderen DC</td></tr><tr><td><code>AttBadPasswordTime</code></td><td><code>bad pwd time</code></td><td>Letztmalige Falscheingabe des Passworts</td></tr><tr><td><code>AttPwdLastSet</code></td><td><code>password last set</code></td><td>Letzte Änderung des Passworts</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="weitere-analysemöglichkeiten">Weitere Analysemöglichkeiten<a class="hash-link" aria-label="Direct link to Weitere Analysemöglichkeiten" title="Direct link to Weitere Analysemöglichkeiten" href="/forensics/ad_forensics#weitere-analysemöglichkeiten">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gelöschte-objekte-anzeigen">Gelöschte Objekte anzeigen<a class="hash-link" aria-label="Direct link to Gelöschte Objekte anzeigen" title="Direct link to Gelöschte Objekte anzeigen" href="/forensics/ad_forensics#gelöschte-objekte-anzeigen">​</a></h3>
<p>Interessant für Forensiker: Wenn im <a href="/forensics/ad_forensics#AD">AD</a> ein Objekt gelöscht, dann wird es zunächst nicht physisch gelöscht, sondern in den Container Deleted Objects verschoben und umbenannt. Angenommen, wir löschen das Objekt <code>cn=user01,cn=Users,dc=demo,cn=local</code>, und angenommen die <a href="/forensics/ad_forensics#UUID">UUID</a> des Containers <code>cn=Users,dc=demo,cn=local</code> ist <code>261d3f52-7117-4ef9-8cdb-1cc6fa87a31c</code>. Dann hat das Objekt anschließend den <a href="/forensics/ad_forensics#DN">DN</a> <code>cn=user01\0ADEL:261d3f52-7117-4ef9-8cdb-1cc6fa87a31c,cn=Deleted Objects,dc=demo,cn=local</code>. Mit Hilfe der <a href="/forensics/ad_forensics#UUID">UUID</a> lässt sich der ursprüngliche Speicherort rekonstruieren.</p>
<p>Erst nach Ablauf der <em>Tompstone Lifetime</em> (<a href="/forensics/ad_forensics#TSL">TSL</a>), die je nach Serverversion standardmäßig 60-180 Tage beträgt <a href="/forensics/ad_forensics#a19">[10]</a>, wird das Objekt wirklich physisch gelöscht. Bis dahin ist das Objekt (leicht verändert; s.o.) noch vorhanden und kann durch <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> angezeigt werden, wenn man die timeline mit dem Schalter <code>--include-deleted</code> aktiviert.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verzeichnisbaum-anzeigen">Verzeichnisbaum anzeigen<a class="hash-link" aria-label="Direct link to Verzeichnisbaum anzeigen" title="Direct link to Verzeichnisbaum anzeigen" href="/forensics/ad_forensics#verzeichnisbaum-anzeigen">​</a></h3>
<p>Eine weitere Möglichkeit, sich einen Überblick zu verschaffen, ist das Kommando <code>tree</code> von <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ntdsextract2 ntds.dit tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cn=$ROOT_OBJECT$ (id=2/row=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── o=Boot (id=4/row=2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── cn=Schema (id=5/row=3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── cn=BootMachine (id=7/row=5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── cn=local (id=1457/row=1267)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── dc=demo (id=1458/row=1268)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cn=System (id=1468/row=1278)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=Default Domain Policy (id=1689/row=1487)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=Meetings (id=1691/row=1489)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=RID Manager$ (id=1880/row=1652)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=RpcServices (id=1685/row=1483)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=Dfs-Configuration (id=1701/row=1499)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=BCKUPKEY_79ba72fa-c30c-4c8c-b832-91c5ac912716 Secret (id=1951/row=1719)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=IP Security (id=1702/row=1500)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=Server (id=1835/row=1607)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=BCKUPKEY_fc41aaf0-2a1e-4629-a6ae-a0d755f39395 Secret (id=1953/row=1721)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=DomainUpdates (id=1751/row=1531)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=File Replication Service (id=1700/row=1498)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=BCKUPKEY_P Secret (id=1952/row=1720)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=ComPartitionSets (id=1745/row=1525)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=RAS and IAS Servers Access Check (id=1699/row=1497)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=ComPartitions (id=1744/row=1524)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=WMIPolicy (id=1746/row=1526)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=BCKUPKEY_PREFERRED Secret (id=1954/row=1722)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=MicrosoftDNS (id=1884/row=1656)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=AdminSDHolder (id=1743/row=1523)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=FileLinks (id=1686/row=1484)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=Policies (id=1692/row=1490)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── cn=WinsockServices (id=1684/row=1482)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cn=Users (id=1465/row=1275)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=user08 (id=3283/row=3051)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=user37 (id=3312/row=3080)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── cn=user06 (id=3281/row=3049)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Auch hier sieht man wieder die <em>Record ID</em> (Attribut <code>DsRecordId</code>), die bereits in der <a href="/forensics/ad_forensics#erstellen-der-timeline">Timeline-Analyse</a> aufgetaucht ist. Zusätzlich ist die Zeilennummer (<code>row</code>) innerhalb der Datentabelle der <a href="/forensics/ad_forensics#AD">AD</a> Datenbank angezeigt. Als Name der jeweiligen Objekte wird in der Baumansicht immer der <em>Relative Distinguished Name</em> (<a href="/forensics/ad_forensics#RDN">RDN</a>) angezeigt. Zusätzlich mit dem <em>Distinguished Name</em> (<a href="/forensics/ad_forensics#DN">DN</a>) des Elternobjekts lässt sich der <a href="/forensics/ad_forensics#DN">DN</a> eines bestimmten Objekts bilden. Beispielsweise ist <code>cn=user06,cn=Users,dc=demo,cn=local</code> der <a href="/forensics/ad_forensics#DN">DN</a> des Benutzers <code>user06</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="computerkonten-anzeigen">Computerkonten anzeigen<a class="hash-link" aria-label="Direct link to Computerkonten anzeigen" title="Direct link to Computerkonten anzeigen" href="/forensics/ad_forensics#computerkonten-anzeigen">​</a></h3>
<p>Als nächstes schauen wir uns die Computerkonten an:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ntdsextract2 ntds.dit computer -F json-lines -D | jq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Die Befehle zum Anzeigen von Benutzern, Computern oder Gruppen unterstützen drei Ausgabeformate:</p>
<ul>
<li><code>csv</code> (einzelne sind mit Semikolon voneinander getrennt)</li>
<li><code>json</code> (formatiertes <a href="/forensics/ad_forensics#JSON">JSON</a>; als Liste von Einzelobjekten)</li>
<li><code>json-lines</code> (ein <a href="/forensics/ad_forensics#JSON">JSON</a>-Objekt pro Zeile)</li>
</ul>
<p>Das Format <code>json-lines</code> eignet sich hervorragend zur Weiterverarbeitung durch Programme wie etwa <a href="/forensics/ad_forensics#jq"><code>jq</code></a>, was ich im Beispiel oben demonstriert habe. Die Ausgabe mit meinen Beispieldaten ist ziemlich kurz:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sid&quot;: &quot;S-1-5-21-3188177830-2933342842-421106997-1003&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;distinguished_name&quot;: &quot;cn=ADDEMO,ou=Domain Controllers,dc=demo,cn=local&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;user_principal_name&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;rdn&quot;: &quot;ADDEMO&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sam_account_name&quot;: &quot;ADDEMO$&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sam_account_type&quot;: &quot;SAM_MACHINE_ACCOUNT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;user_account_control&quot;: &quot;ADS_UF_SERVER_TRUST_ACCOUNT | ADS_UF_TRUSTED_FOR_DELEGATION&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;logon_count&quot;: 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;bad_pwd_count&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;admin_count&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;is_deleted&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;primary_group_id&quot;: 516,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;primary_group&quot;: &quot;Domain Controllers&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;member_of&quot;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;comment&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;record_time&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;when_created&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;when_changed&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;last_logon&quot;: &quot;2016-07-10T10:55:23+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;last_logon_time_stamp&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;account_expires&quot;: &quot;9999-12-31T23:59:59+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;password_last_set&quot;: &quot;2016-07-10T08:15:59+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;bad_pwd_time&quot;: &quot;1601-01-01T00:00:00+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;creator_sid&quot;: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Hier sind zwei Attribute hervorzuheben:</p>
<ul>
<li><code>distinguished_name</code> ist kein Attribut des Objekts, sondern wird wie oben beschrieben aus dem <a href="/forensics/ad_forensics#RDN">RDN</a> des Objekts und dem <a href="/forensics/ad_forensics#DN">DN</a> des Elternobjekts gebildet. Deswegen wird dieses Attribut standardmäßig auch nicht angezeigt. Mit der Option <code>--include-dn</code> bzw. <code>-H</code> lässt sich die Anzeige aber aktivieren</li>
<li><code>creator_sid</code> zeigt die Security ID (<a href="/forensics/ad_forensics#SID">SID</a>) des Benutzers an, der diesen Computer zum <a href="/forensics/ad_forensics#AD">AD</a> hinzugefügt hat, falls dieser Benutzer kein Administrator ist. What???!!!! Das geht? Ja. Wenn die Eigenschaft <a href="/forensics/ad_forensics#a12"><code>ms-DS-MachineAccountQuota</code></a> einen Wert größer 0 hat, dann gibt dieser Wert an, wie viele Computer ein eingeschränkter Benutzer ins <a href="/forensics/ad_forensics#AD">AD</a> aufnehmen darf. Standardmäßig ist dieser Wert auf 10 gestellt. Wir haben bereits Angriffe analysiert, bei denen diese Eigenschaft ausgenutzt wurde; und wir haben entsprechend auffällige Computer gesehen haben.
Eine einfache Option, verdächtige Computerkonten zu ermitteln, ist also indem man mit <code> | jq &#x27;select(.creator_sid!=null)&#x27;</code> filtert.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benutzerkonten-anzeigen">Benutzerkonten anzeigen<a class="hash-link" aria-label="Direct link to Benutzerkonten anzeigen" title="Direct link to Benutzerkonten anzeigen" href="/forensics/ad_forensics#benutzerkonten-anzeigen">​</a></h3>
<p>Bis jetzt haben wir keine Auffälligkeiten gefunden. Schauen wir uns als nächstes mal alle Benutzer an, die Mitglied der Gruppe <code>Domain Admins</code> sind. Dazu nutzen wir wieder <a href="/forensics/ad_forensics#jq"><code>jq</code></a>:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kommando">Kommando<a class="hash-link" aria-label="Direct link to Kommando" title="Direct link to Kommando" href="/forensics/ad_forensics#kommando">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ntdsextract2 ntds.dit user -F json-lines -D | jq &#x27;select(.member_of | contains([&quot;Domain Admins&quot;]))&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ausgabe">Ausgabe<a class="hash-link" aria-label="Direct link to Ausgabe" title="Direct link to Ausgabe" href="/forensics/ad_forensics#ausgabe">​</a></h4>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sid&quot;: &quot;S-1-5-21-3188177830-2933342842-421106997-500&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;distinguished_name&quot;: &quot;cn=Administrator,cn=Users,dc=demo,cn=local&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;user_principal_name&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;rdn&quot;: &quot;Administrator&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sam_account_name&quot;: &quot;Administrator&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sam_account_type&quot;: &quot;SAM_USER_OBJECT&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;user_account_control&quot;: &quot;ADS_UF_NORMAL_ACCOUNT | ADS_UF_DONT_EXPIRE_PASSWD&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;logon_count&quot;: 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;bad_pwd_count&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;admin_count&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;is_deleted&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;primary_group_id&quot;: 513,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;primary_group&quot;: &quot;Domain Users&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;member_of&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Group Policy Creator Owners&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Domain Admins&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Administrators&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Schema Admins&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Enterprise Admins&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;comment&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;record_time&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;when_created&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;when_changed&quot;: &quot;1601-06-01T18:23:32+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;last_logon&quot;: &quot;2016-07-10T10:55:22+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;last_logon_time_stamp&quot;: null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;account_expires&quot;: &quot;9999-12-31T23:59:59+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;password_last_set&quot;: &quot;2016-07-10T10:01:44+0000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;bad_pwd_time&quot;: &quot;1601-01-01T00:00:00+0000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Die Gruppenmitgliedschaften von Benutzern und Computern zu prüfen sollte Teil jeder forensischen Untersuchung sollte sein.</p></div></div>
<p><a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> bietet die Möglichkeit, alternativ zum <a href="/forensics/ad_forensics#RDN">RDN</a> des Gruppennamens auch den vollständigen <a href="/forensics/ad_forensics#DN">DN</a> anzuzeigen, oder auch die <a href="/forensics/ad_forensics#SID">SID</a> oder den Wert von <code>samAccountName</code>. Die Option <code>--member-of</code> erlaubt die Auswahl des gewünschten Wertes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="detailansicht-eines-eintrags">Detailansicht eines Eintrags<a class="hash-link" aria-label="Direct link to Detailansicht eines Eintrags" title="Direct link to Detailansicht eines Eintrags" href="/forensics/ad_forensics#detailansicht-eines-eintrags">​</a></h3>
<p>Es kann durchaus sein, dass man sich während einer Untersuchung für die Details eines Eintrags interessiert. Es gibt die Möglichkeit, sich mit <a href="/forensics/ad_forensics#a1"><code>ntdsextract2</code></a> und dem Kommando <code>entry</code> die Rohdaten eines Eintrags anzeigen zu lassen. Dabei hat man die Wahl, ob für den Eintrag die <em>Record ID</em> (<code>DsRecordId</code>) oder die <a href="/forensics/ad_forensics#RID">RID</a> angegeben wird (die <a href="/forensics/ad_forensics#SID">SID</a> eines Benutzers besteht grob aus zwei Teilen: eine Domain-ID und eine <a href="/forensics/ad_forensics#SID">SID</a>. Die Domain-ID ist für alle Benutzer in einer Domäne identisch. Die <a href="/forensics/ad_forensics#RID">RID</a> ist der Teil der <a href="/forensics/ad_forensics#SID">SID</a> nach dem letzten Minus;  bspw. ist <code>500</code> die <a href="/forensics/ad_forensics#RID">RID</a> von <code>S-1-5-21-3188177830-2933342842-421106997-500</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kommando-1">Kommando<a class="hash-link" aria-label="Direct link to Kommando" title="Direct link to Kommando" href="/forensics/ad_forensics#kommando-1">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ntdsextract2 ntds.dit entry --sid 500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ausgabe-1">Ausgabe<a class="hash-link" aria-label="Direct link to Ausgabe" title="Direct link to Ausgabe" href="/forensics/ad_forensics#ausgabe-1">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AttAccountExpires        : Currency(9223372036854775807)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttBadPasswordTime       : Currency(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttBadPwdCount           : I32(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttCodePage              : I32(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttCommonName            : LargeText(Administrator)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttCountryCode           : I32(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttDbcsPwd               : LargeBinary([17, 0, 0, 0, 0, 0, 0, 0, 208, 94, 27, 88, 60, 180, 61, 222, 135, 179, 115, 44, 163, 220, 20, 58, 223, 210, 160, 16, 8, 4, 18, 48, 181, 46, 245, 200, 161, 47, 192, 91])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttDescription           : LargeText(Built-in account for administering the computer/domain)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttInstanceType          : I32(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttIsCriticalSystemObject: I32(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttLastLogoff            : Currency(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttLastLogon             : Currency(131126217226406250)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttLogonCount            : I32(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttNtSecurityDescriptor  : LargeBinary([51, 0, 0, 0, 0, 0, 0, 0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttObjDistName           : I32(1815)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttObjectCategory        : I32(1128)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttObjectClass           : Multi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttObjectGuid            : LargeBinary([196, 146, 141, 186, 125, 119, 164, 65, 163, 20, 106, 106, 58, 95, 246, 109])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttObjectSid             : LargeBinary([1, 5, 0, 0, 0, 0, 0, 5, 21, 0, 0, 0, 166, 187, 7, 190, 122, 66, 215, 174, 53, 149, 25, 25, 0, 0, 1, 244])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttPrimaryGroupId        : I32(513)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttPwdLastSet            : Currency(131126185044375000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttRdn                   : LargeText(Administrator)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttReplPropertyMetaData  : Long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttSamAccountName        : LargeText(Administrator)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttSamAccountType        : I32(805306368)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttUnicodePwd            : LargeBinary([17, 0, 0, 0, 0, 0, 0, 0, 44, 105, 0, 122, 74, 180, 161, 23, 83, 211, 68, 233, 176, 234, 208, 74, 152, 44, 61, 208, 167, 250, 124, 156, 131, 136, 137, 221, 25, 221, 51, 1])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttUserAccountControl    : I32(66048)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttUsnChanged            : Currency(8194)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttUsnCreated            : Currency(8194)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttWhenChanged           : Currency(13112612035)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AttWhenCreated           : Currency(13112612035)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DsAncestors              : LargeBinary([2, 0, 0, 0, 177, 5, 0, 0, 178, 5, 0, 0, 185, 5, 0, 0, 23, 7, 0, 0])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DsParentRecordId         : I32(1465)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DsRecordId               : I32(1815)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DsRecordTime             : Currency(13112612035)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Bei der Ausgabe von <code>entry</code> ist zu sehen, dass keine Interpretation der Daten vorgenommen wird. Der Wert von <code>DsRecordTime</code> ist beispielsweise vom Typ <code>Currency</code>(<code>13112612035</code>), weil <code>Currency</code> der interne Datentyp für Festkommazahlen mit 64bit Länge ist. Die Interpretation von Daten durch eine Software ist immer fehleranfällig (<em>nicht</em> fehlerhaft, aber anfällig); beispielsweise könnte ein Zeitstempel falsch berechnet sein. Durch den Verzicht auf jegliche Interpretation bei der Ausgabe von <code>entry</code> wird diese Art von Fehlern ausgeschlossen.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="abkürzungen">Abkürzungen<a class="hash-link" aria-label="Direct link to Abkürzungen" title="Direct link to Abkürzungen" href="/forensics/ad_forensics#abkürzungen">​</a></h2>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a id="AD">AD</a></td><td>Active Directory</td></tr><tr><td><a id="DN">DN</a></td><td>Distinguished Name</td></tr><tr><td><a id="EseDB">EseDB</a></td><td>Extensible Storage Engine Database</td></tr><tr><td><a id="JSON">JSON</a></td><td>Javascript Object Notation</td></tr><tr><td><a id="RDN">RDN</a></td><td>Relative Distinguished Name</td></tr><tr><td><a id="RID">RID</a></td><td>Relative Identifier</td></tr><tr><td><a id="SID">SID</a></td><td>Security Identifier</td></tr><tr><td><a id="TSL">TSL</a></td><td>Tompstone Lifetime</td></tr><tr><td><a id="UAC">UAC</a></td><td>User Acount Control</td></tr><tr><td><a id="UTC">UTC</a></td><td>Universal Time Coordinated</td></tr><tr><td><a id="UUID">UUID</a></td><td>Universally Unique Identifier</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quellen">Quellen<a class="hash-link" aria-label="Direct link to Quellen" title="Direct link to Quellen" href="/forensics/ad_forensics#quellen">​</a></h2>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a id="a1">[1]</a></td><td><a href="https://github.com/janstarke/ntdsextract2" target="_blank" rel="noopener noreferrer">https://github.com/janstarke/ntdsextract2</a></td></tr><tr><td><a id="a2">[2]</a></td><td><a href="https://blog.didierstevens.com/2016/07/12/practice-ntds-dit-file-part-1" target="_blank" rel="noopener noreferrer">https://blog.didierstevens.com/2016/07/12/practice-ntds-dit-file-part-1</a></td></tr><tr><td><a id="a3">[3]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime</a></td></tr><tr><td><a id="a4">[4]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires</a></td></tr><tr><td><a id="filetime">[5]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime</a></td></tr><tr><td><a id="accountExpires">[6]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires</a></td></tr><tr><td><a id="mactime2">[7]</a></td><td><a href="https://github.com/dfir-dd/dfir-toolkit/blob/main/doc/mactime2.md" target="_blank" rel="noopener noreferrer">https://github.com/dfir-dd/dfir-toolkit/blob/main/doc/mactime2.md</a></td></tr><tr><td><a id="xsv">[8]</a></td><td><a href="https://github.com/BurntSushi/xsv" target="_blank" rel="noopener noreferrer">https://github.com/BurntSushi/xsv</a></td></tr><tr><td><a id="RFC3339">[9]</a></td><td><a href="https://datatracker.ietf.org/doc/html/rfc3339" target="_blank" rel="noopener noreferrer">https://datatracker.ietf.org/doc/html/rfc3339</a></td></tr><tr><td><a id="a10">[10]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/adschema/a-tombstonelifetime" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/adschema/a-tombstonelifetime</a></td></tr><tr><td><a id="jq">[11]</a></td><td><a href="https://jqlang.github.io/jq/" target="_blank" rel="noopener noreferrer">https://jqlang.github.io/jq/</a></td></tr><tr><td><a id="a12">[12]</a></td><td><a href="https://learn.microsoft.com/de-de/windows/win32/adschema/a-ms-ds-machineaccountquota" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/de-de/windows/win32/adschema/a-ms-ds-machineaccountquota</a></td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/category/forensics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Forensics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/forensics/snippets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Forensic snippets for me and you</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#übersicht">Übersicht</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#spurensicherung">Spurensicherung</a><ul><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#daten-in-der-ntdsdit">Daten in der <code>ntds.dit</code></a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#record-id-und-row-id"><em>Record ID</em> und <em>Row ID</em></a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#timeline-analyse">Timeline-Analyse</a><ul><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#zeitstempel">Zeitstempel</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#erstellen-der-timeline">Erstellen der Timeline</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#unterstützte-timestamps">Unterstützte Timestamps</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#weitere-analysemöglichkeiten">Weitere Analysemöglichkeiten</a><ul><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#gelöschte-objekte-anzeigen">Gelöschte Objekte anzeigen</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#verzeichnisbaum-anzeigen">Verzeichnisbaum anzeigen</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#computerkonten-anzeigen">Computerkonten anzeigen</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#benutzerkonten-anzeigen">Benutzerkonten anzeigen</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#detailansicht-eines-eintrags">Detailansicht eines Eintrags</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#abkürzungen">Abkürzungen</a></li><li><a class="table-of-contents__link toc-highlight" href="/forensics/ad_forensics#quellen">Quellen</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a href="https://github.com/janstarke" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Jan Starke. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>