"use strict";(self.webpackChunkjanstarke_blog=self.webpackChunkjanstarke_blog||[]).push([[2594],{5227:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var i=s(5893),t=s(1151);const r={layout:"page",title:"Forensic triage and data gathering"},d="Required tools",l={id:"forensics/triage",title:"Forensic triage and data gathering",description:"In this page I'm summarizing a lot of stuff which is related to collection triage data.",source:"@site/docs/02_forensics/triage.mdx",sourceDirName:"02_forensics",slug:"/forensics/triage",permalink:"/forensics/triage",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{layout:"page",title:"Forensic triage and data gathering"},sidebar:"tutorialSidebar",previous:{title:"Forensic snippets for me and you",permalink:"/forensics/snippets"},next:{title:"Development",permalink:"/category/development"}},o={},c=[{value:"in Linux",id:"in-linux",level:2},{value:"in MacOS",id:"in-macos",level:2},{value:"Filesystem timeline",id:"filesystem-timeline",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In this page I'm summarizing a lot of stuff which is related to collection triage data."}),"\n",(0,i.jsx)(n.h1,{id:"required-tools",children:"Required tools"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["sleuthkit ",(0,i.jsx)(n.a,{href:"https://www.sleuthkit.org/",children:"https://www.sleuthkit.org/"})]}),"\n",(0,i.jsxs)(n.li,{children:["afflib-tools ",(0,i.jsx)(n.a,{href:"https://github.com/simsong/AFFLIBv3",children:"https://github.com/simsong/AFFLIBv3"})]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"expected-result-sorted-by-priority",children:"Expected Result (sorted by priority)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Bodyfile for all partitions"}),"\n",(0,i.jsx)(n.li,{children:"Windows event logs"}),"\n",(0,i.jsx)(n.li,{children:"Registry"}),"\n",(0,i.jsx)(n.li,{children:"User hives"}),"\n",(0,i.jsx)(n.li,{children:"User profiles"}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"mounting-stuff",children:"Mounting stuff"}),"\n",(0,i.jsx)(n.h2,{id:"in-linux",children:"in Linux"}),"\n",(0,i.jsx)(n.p,{children:"If you have vmdk files, you first need to turn them to raw images (which is vvery slow) or you need to create a raw view onto them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo affuse -o ro,allow_other /cases/sample/myserver.vmdk /mnt/aff/myserver/\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-o ro"})}),(0,i.jsx)(n.td,{children:"read-only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-o allow_other"})}),(0,i.jsx)(n.td,{children:"allow access to other users"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Next, to make things easy, we create loop devices for every partition:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ sudo losetup --show -f -P /mnt/aff/myserver/myserver.vmdk.raw\n/dev/loop2\n"})}),"\n",(0,i.jsxs)(n.p,{children:["this generates ",(0,i.jsx)(n.code,{children:"/dev/loop2p1"})," for partition 1, and so on. To see which partitions you have, use ",(0,i.jsx)(n.code,{children:"mmls"}),"."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--show"})}),(0,i.jsxs)(n.td,{children:["print device name after setup  (with ",(0,i.jsx)(n.code,{children:"-f"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("code",{children:"-f | --find"})}),(0,i.jsx)(n.td,{children:"find first unused device"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("code",{children:"-P |\xa0--partscan"})}),(0,i.jsx)(n.td,{children:"create a partitioned loop device"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Now, we could mount a partition. Keep in mind that you never, ever, omit the ",(0,i.jsx)(n.code,{children:"ro"})," option!"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ sudo mount -o ro,show_sys_files,streams_interface=windows /dev/loop2p1 /mnt/myserver/C\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-o ro"})}),(0,i.jsx)(n.td,{children:"read-only"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-o show_sys_files"})}),(0,i.jsx)(n.td,{children:"Show the metafiles in directory listings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-o streams_interface=windows"})}),(0,i.jsxs)(n.td,{children:["enable access to streams using the Windows syntax (e.g. ",(0,i.jsx)(n.code,{children:"cat file:stream"}),")"]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"in-macos",children:"in MacOS"}),"\n",(0,i.jsxs)(n.p,{children:["Currently, I do not know any option to mount ",(0,i.jsx)(n.code,{children:"VMDK"})," files in MacOS. However, one can convert images using qemu-img:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"qemu-img convert -f vmdk -O raw myserver.vmdk myserver.vmdk.raw\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now, you can attach that raw image as a loop device:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sudo hdiutil attach -imagekey diskimage-class=CRawDiskImage -nomount -readonly myserver.vmdk.raw\n"})}),"\n",(0,i.jsx)(n.h1,{id:"handling-lvm-partitions",children:"Handling LVM partitions"}),"\n",(0,i.jsxs)(n.p,{children:["Assume you now have a partition ",(0,i.jsx)(n.code,{children:"/dev/loop20p1"})," which contains a physical volume (pv). You can use kpartx to read the volume information and create the relevant device nodes:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo kpartx -r -a -v /dev/loop20p1\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-r"})}),(0,i.jsx)(n.td,{children:"read-only partition mappings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-a"})}),(0,i.jsx)(n.td,{children:"add partition mappings"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-v"})}),(0,i.jsx)(n.td,{children:"operate verbosely"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Now, you can use ",(0,i.jsx)(n.code,{children:"pvs"})," to display information about physical volumes. In my case, I had a physical volume named ",(0,i.jsx)(n.code,{children:"data_pv"}),". Next, you need to activate the volumes you're going to work with:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo vgchange --activate y data_pv\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This will create a lot of device nodes beneath ",(0,i.jsx)(n.code,{children:"/dev/data_pv"}),", one for every logical volume in ",(0,i.jsx)(n.code,{children:"data_pv"}),". You can now work with them."]}),"\n",(0,i.jsxs)(n.p,{children:["I took a lot of information from ",(0,i.jsx)(n.a,{href:"https://countuponsecurity.com/tag/linux-lvm-forensics",children:"https://countuponsecurity.com/tag/linux-lvm-forensics"})]}),"\n",(0,i.jsx)(n.h1,{id:"timeline",children:"Timeline"}),"\n",(0,i.jsx)(n.h2,{id:"filesystem-timeline",children:"Filesystem timeline"}),"\n",(0,i.jsx)(n.p,{children:"To create a filesystem timeline, you need to know the following information:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Which partition to triage?"}),"\n",(0,i.jsx)(n.li,{children:"Which timezone has been configured on the system?"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'fls -r -m "C:/" -z CET /dev/loop2p1 >myserver_c.bodyfile\n'})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-r"})}),(0,i.jsx)(n.td,{children:"Recurse on directory entries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'-m "C:/"'})}),(0,i.jsxs)(n.td,{children:["Display output in mactime input format with ",(0,i.jsx)(n.code,{children:"C:/"})," as the actual mount point of the image"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"-z CET"})}),(0,i.jsxs)(n.td,{children:["Time zone of original machine (",(0,i.jsx)(n.code,{children:"CET"}),") (only useful with -l)"]})]})]})]}),"\n",(0,i.jsx)(n.h1,{id:"important-windows-triage-artifacts",children:"Important Windows triage artifacts"}),"\n",(0,i.jsxs)(n.p,{children:["| Artifact | Location |\xa0\n|-|-|\n|System Registry | ",(0,i.jsx)(n.code,{children:"%windir%\\System32\\config\\SYSTEM"})," ",(0,i.jsx)(n.code,{children:"%windir%\\System32\\config\\SOFTWARE"})," |\n|Event Logs | ",(0,i.jsx)(n.code,{children:"%windir%\\System32\\winevt\\Logs\\*.evtx"}),"|\n|User profile hives| ",(0,i.jsx)(n.code,{children:"C:\\Users\\*\\NTUSER.DAT"})," |\n|User profiles|",(0,i.jsx)(n.code,{children:"C:\\Users\\*"}),"|"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>d});var i=s(7294);const t={},r=i.createContext(t);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);