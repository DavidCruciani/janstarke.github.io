"use strict";(self.webpackChunkjanstarke_blog=self.webpackChunkjanstarke_blog||[]).push([[9832],{7177:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>s,metadata:()=>c,toc:()=>a});var t=i(4848),r=i(8453);const s={layout:"page",title:"Forensische Analyse von Active Directory Datenbanken"},d="Digitale Forensik: Analyse von Active Directory Datenbanken",c={id:"forensics/ad_forensics",title:"Forensische Analyse von Active Directory Datenbanken",description:"Viele komplexe Angriffe gegen Unternehmensnetzwerke finden in mehreren Phasen statt:",source:"@site/docs/02_forensics/ad_forensics.md",sourceDirName:"02_forensics",slug:"/forensics/ad_forensics",permalink:"/forensics/ad_forensics",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{layout:"page",title:"Forensische Analyse von Active Directory Datenbanken"},sidebar:"tutorialSidebar",previous:{title:"Forensics",permalink:"/category/forensics"},next:{title:"Forensic snippets for me and you",permalink:"/forensics/snippets"}},l={},a=[{value:"Spurensicherung",id:"spurensicherung",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"digitale-forensik-analyse-von-active-directory-datenbanken",children:"Digitale Forensik: Analyse von Active Directory Datenbanken"}),"\n",(0,t.jsx)(n.p,{children:"Viele komplexe Angriffe gegen Unternehmensnetzwerke finden in mehreren Phasen statt:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Informationsgewinnung"}),"\n",(0,t.jsx)(n.li,{children:"Initialer Zugriff: bspw. Ausnutzen einer Schwachstelle in einer Software"}),"\n",(0,t.jsx)(n.li,{children:"Persistenz: Sicherstellen, dass ein sp\xe4terer Zugriff auf das System m\xf6glich ist, auch wenn bspw. die ausgenutzte Schwachstelle geschlossen wurde"}),"\n",(0,t.jsx)(n.li,{children:"Rechteausweitung: \xdcbernahme eines Benutzerkontos mit weitergehenden Rechten"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"und so weiter..."}),"\n",(0,t.jsx)(n.p,{children:"Die Benutzerkonten, Passw\xf6rter, Berechtigungen etc. werden in den meisten Unternehmensnetzwerken in einem Active Directory (AD) verwaltet. Deswegen ist das AD ein f\xfcr Angreifer interessantes Mittel sowohl f\xfcr Persistenz als auch f\xfcr die Rechteausweitung. Dazu sind aktuell folgende Optionen bekannt:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"versteckte Benutzerkonten unter der Kontrolle des Angreifers"}),"\n",(0,t.jsx)(n.li,{children:"privilegierte Mitgliedschaften von Benutzerkonten, die eigentlich wenig Rechte haben sollten"}),"\n",(0,t.jsx)(n.li,{children:"privilegierte Computerkonten unter der Kontrolle des Angreifers"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Au\xdferdem hinterlassen viele Angriffe auch unbeabsichtigt Spuren im Active Directory, die bei der Analyse genutzt werden k\xf6nnen, bspw. neu angelegte Computerkonten."}),"\n",(0,t.jsxs)(n.p,{children:["Ziel des Artikels ist, Grundz\xfcge der forensischen Analyse von AD-Datenbanken zu vermitteln. Es wird zun\xe4chst beschrieben, wie die AD-Datenbank aufgebaut ist, und was bei der forensischen Sicherung zu beachten ist. Abschlie\xdfend wird gezeigt, wie man eine forensische Analyse einer AD-Datenbank mit ",(0,t.jsx)(n.a,{href:"https://github.com/janstarke/ntdsextract2",children:(0,t.jsx)(n.code,{children:"ntdsextract2"})})," durchf\xfchren kann. Um das m\xf6glichst einfach anschaulich zu gestalten, wurde eine einfache AD-Datenbank verwendet. In dieser Datenbank sind keine konkreten Angriffsspuren zu finden; der Artikel besch\xe4ftigt sich ausschlie\xdflich mit der Vorgehensweise bei der forensischen Arbeit; jedoch nicht mit konkreten Angriffsmethoden."]}),"\n",(0,t.jsx)(n.h2,{id:"spurensicherung",children:"Spurensicherung"}),"\n",(0,t.jsxs)(n.p,{children:["Wir haben von einem Domain Controller des angegriffenen Netzwerks die Datei ",(0,t.jsx)(n.code,{children:"%windir%\\NTDS\\ntds"}),".dit gesichert. Diese Datei ist eine Jet-Datenbank, in der die AD-Objekte gespeichert sind. Au\xdferdem haben wir alle Log-Dateien mit gesichert. Es besteht die M\xf6glichkeit, dass einige Inhalte noch nicht in die ",(0,t.jsx)(n.code,{children:"ntds.dit"})," zur\xfcckgeschrieben wurden. Wir m\xfcssen also in der Lage sein, eine vollst\xe4ndig synchrone Variante der AD-Datenbank zu schreiben. In Summe haben wir folgende Dateien gesichert:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Datei"}),(0,t.jsx)(n.th,{children:"Beschreibung"}),(0,t.jsx)(n.th,{children:"Wichtig f\xfcr Forensik?"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ntds.dit"})}),(0,t.jsx)(n.td,{children:"AD Datenbank"}),(0,t.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"edb.log"})}),(0,t.jsx)(n.td,{children:"Transaction-Log f\xfcr ntds.dit"}),(0,t.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"edbxxxxx.log"})}),(0,t.jsxs)(n.td,{children:["Zus\xe4tzliche Transaction-Log-Dateien. Diese werden geschrieben, wenn ",(0,t.jsx)(n.code,{children:"edb.log"})," voll ist, bevor die Logs in die ",(0,t.jsx)(n.code,{children:"ntds.dit"})," zur\xfcckgeschrieben werden"]}),(0,t.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"res1.log"})," und ",(0,t.jsx)(n.code,{children:"res2.log"})]}),(0,t.jsxs)(n.td,{children:["Reserve-Logdateien. Diese enthalten keine Daten (theoretisch), sondern blockieren nur Speicherplatz. Wenn der Plattenplatz knapp wird, dann wird Speicherplatz dieser beiden Dateien genutzt, um die ",(0,t.jsx)(n.code,{children:"edbxxxxx.log"})," schreiben zu k\xf6nnen."]}),(0,t.jsx)(n.td,{children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"temp.ed"})}),(0,t.jsxs)(n.td,{children:['"Notizblock" f\xfcr die Arbeit mit der ',(0,t.jsx)(n.code,{children:"ntds.dit"})]}),(0,t.jsx)(n.td,{children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"schema.ini"})}),(0,t.jsx)(n.td,{children:"Schemabeschreibung f\xfcr die initiale Einrichtung des AD Schema"}),(0,t.jsx)(n.td,{children:"\u274c"})]})]})]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var t=i(6540);const r={},s=t.createContext(r);function d(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);