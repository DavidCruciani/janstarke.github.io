"use strict";(self.webpackChunkjanstarke_blog=self.webpackChunkjanstarke_blog||[]).push([[9832],{7177:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>o,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var s=i(4848),r=i(8453);const t={layout:"page",title:"Forensische Analyse von Active Directory Datenbanken"},d="Forensische Analyse von Active Directory Datenbanken mit ntdsextract2",c={id:"forensics/ad_forensics",title:"Forensische Analyse von Active Directory Datenbanken",description:"\xdcbersicht",source:"@site/docs/02_forensics/ad_forensics.md",sourceDirName:"02_forensics",slug:"/forensics/ad_forensics",permalink:"/forensics/ad_forensics",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{layout:"page",title:"Forensische Analyse von Active Directory Datenbanken"},sidebar:"tutorialSidebar",previous:{title:"Forensics",permalink:"/category/forensics"},next:{title:"Forensic snippets for me and you",permalink:"/forensics/snippets"}},l={},a=[{value:"\xdcbersicht",id:"\xfcbersicht",level:2},{value:"Spurensicherung",id:"spurensicherung",level:2},{value:"Daten in der <code>ntds.dit</code>",id:"daten-in-der-ntdsdit",level:3},{value:"<em>Record ID</em> und <em>Row ID</em>",id:"record-id-und-row-id",level:3},{value:"Timeline-Analyse",id:"timeline-analyse",level:2},{value:"Zeitstempel",id:"zeitstempel",level:3},{value:"Erstellen der Timeline",id:"erstellen-der-timeline",level:3},{value:"Unterst\xfctzte Timestamps",id:"unterst\xfctzte-timestamps",level:3},{value:"Weitere Analysem\xf6glichkeiten",id:"weitere-analysem\xf6glichkeiten",level:2},{value:"Gel\xf6schte Objekte anzeigen",id:"gel\xf6schte-objekte-anzeigen",level:3},{value:"Verzeichnisbaum anzeigen",id:"verzeichnisbaum-anzeigen",level:3},{value:"Computerkonten anzeigen",id:"computerkonten-anzeigen",level:3},{value:"Benutzerkonten anzeigen",id:"benutzerkonten-anzeigen",level:3},{value:"Kommando",id:"kommando",level:4},{value:"Ausgabe",id:"ausgabe",level:4},{value:"Detailansicht eines Eintrags",id:"detailansicht-eines-eintrags",level:3},{value:"Kommando",id:"kommando-1",level:4},{value:"Ausgabe",id:"ausgabe-1",level:4},{value:"Abk\xfcrzungen",id:"abk\xfcrzungen",level:2},{value:"Quellen",id:"quellen",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"forensische-analyse-von-active-directory-datenbanken-mit-ntdsextract2",children:["Forensische Analyse von Active Directory Datenbanken mit ",(0,s.jsx)(n.code,{children:"ntdsextract2"})]}),"\n",(0,s.jsx)(n.h2,{id:"\xfcbersicht",children:"\xdcbersicht"}),"\n",(0,s.jsx)(n.p,{children:"Viele komplexe Angriffe gegen Unternehmensnetzwerke finden in mehreren Phasen statt:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Informationsgewinnung"}),"\n",(0,s.jsx)(n.li,{children:"Initialer Zugriff: bspw. Ausnutzen einer Schwachstelle in einer Software"}),"\n",(0,s.jsx)(n.li,{children:"Persistenz: Sicherstellen, dass ein sp\xe4terer Zugriff auf das System m\xf6glich ist, auch wenn bspw. die ausgenutzte Schwachstelle geschlossen wurde"}),"\n",(0,s.jsx)(n.li,{children:"Rechteausweitung: \xdcbernahme eines Benutzerkontos mit weitergehenden Rechten"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"und so weiter..."}),"\n",(0,s.jsxs)(n.p,{children:["Die Benutzerkonten, Passw\xf6rter, Berechtigungen etc. werden in den meisten Unternehmensnetzwerken in einem Active Directory (",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),") verwaltet. Deswegen ist das ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," ein f\xfcr Angreifer interessantes Mittel sowohl f\xfcr Persistenz als auch f\xfcr die Rechteausweitung. Dazu sind aktuell folgende Optionen bekannt:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"versteckte Benutzerkonten unter der Kontrolle des Angreifers"}),"\n",(0,s.jsx)(n.li,{children:"privilegierte Mitgliedschaften von Benutzerkonten, die eigentlich wenig Rechte haben sollten"}),"\n",(0,s.jsx)(n.li,{children:"privilegierte Computerkonten unter der Kontrolle des Angreifers"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Au\xdferdem hinterlassen viele Angriffe auch unbeabsichtigt Spuren im Active Directory, die bei der Analyse genutzt werden k\xf6nnen, bspw. neu angelegte Computerkonten."}),"\n",(0,s.jsxs)(n.p,{children:["Ziel des Artikels ist, Grundz\xfcge der forensischen Analyse von ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Datenbanken zu vermitteln. Es wird zun\xe4chst beschrieben, wie die ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Datenbank aufgebaut ist, und was bei der forensischen Sicherung zu beachten ist. Abschlie\xdfend wird gezeigt, wie man eine forensische Analyse einer ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Datenbank mit ",(0,s.jsx)(n.code,{children:"ntdsextract2"})," ",(0,s.jsx)(n.a,{href:"#a1",children:"[1]"})," durchf\xfchren kann. Um das m\xf6glichst einfach anschaulich zu gestalten, wurde eine einfache ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Datenbank verwendet. In dieser Datenbank sind keine konkreten Angriffsspuren zu finden; der Artikel besch\xe4ftigt sich ausschlie\xdflich mit der Vorgehensweise bei der forensischen Arbeit; jedoch nicht mit konkreten Angriffsmethoden."]}),"\n",(0,s.jsx)(n.h2,{id:"spurensicherung",children:"Spurensicherung"}),"\n",(0,s.jsxs)(n.p,{children:["Wir haben von einem Domain Controller des angegriffenen Netzwerks die Datei ",(0,s.jsx)(n.code,{children:"%windir%\\NTDS\\ntds"}),".dit gesichert. Diese Datei ist eine Jet-Datenbank, in der die ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Objekte gespeichert sind. Au\xdferdem haben wir alle Log-Dateien mit gesichert. Es besteht die M\xf6glichkeit, dass einige Inhalte noch nicht in die ",(0,s.jsx)(n.code,{children:"ntds.dit"})," zur\xfcckgeschrieben wurden. Wir m\xfcssen also in der Lage sein, eine vollst\xe4ndig synchrone Variante der ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Datenbank zu schreiben. In Summe haben wir folgende Dateien gesichert:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Datei"}),(0,s.jsx)(n.th,{children:"Beschreibung"}),(0,s.jsx)(n.th,{children:"Wichtig f\xfcr Forensik?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ntds.dit"})}),(0,s.jsx)(n.td,{children:"AD Datenbank"}),(0,s.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"edb.log"})}),(0,s.jsx)(n.td,{children:"Transaction-Log f\xfcr ntds.dit"}),(0,s.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"edbxxxxx.log"})}),(0,s.jsxs)(n.td,{children:["Zus\xe4tzliche Transaction-Log-Dateien. Diese werden geschrieben, wenn ",(0,s.jsx)(n.code,{children:"edb.log"})," voll ist, bevor die Logs in die ",(0,s.jsx)(n.code,{children:"ntds.dit"})," zur\xfcckgeschrieben werden"]}),(0,s.jsx)(n.td,{children:"\u2714\ufe0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"res1.log"})," und ",(0,s.jsx)(n.code,{children:"res2.log"})]}),(0,s.jsxs)(n.td,{children:["Reserve-Logdateien. Diese enthalten keine Daten (theoretisch), sondern blockieren nur Speicherplatz. Wenn der Plattenplatz knapp wird, dann wird Speicherplatz dieser beiden Dateien genutzt, um die ",(0,s.jsx)(n.code,{children:"edbxxxxx.log"})," schreiben zu k\xf6nnen."]}),(0,s.jsx)(n.td,{children:"\u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"temp.ed"})}),(0,s.jsxs)(n.td,{children:['"Notizblock" f\xfcr die Arbeit mit der ',(0,s.jsx)(n.code,{children:"ntds.dit"})]}),(0,s.jsx)(n.td,{children:"\u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"schema.ini"})}),(0,s.jsxs)(n.td,{children:["Schemabeschreibung f\xfcr die initiale Einrichtung des ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," Schema"]}),(0,s.jsx)(n.td,{children:"\u274c"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Sollte sich herausstellen, dass die ",(0,s.jsx)(n.code,{children:"ntds.dit"})," nicht sauber ist, oder dass Informationen fehlen, dann m\xfcssen die Informationen in den Transaction-Logs zur\xfcckgespielt werden. Daf\xfcr wird das Programm ",(0,s.jsx)(n.code,{children:"esentutl"})," genutzt; aber das ist nicht Thema dieses Artikels."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["F\xfcr diesen Artikel habe ich eine \xf6ffentliche ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," Datenbank von Didier Stevens ",(0,s.jsx)(n.a,{href:"#a2",children:"[2]"})," genutzt, die speziell f\xfcr Lernzwecke zur Verf\xfcgung gestellt wurde."]})}),"\n",(0,s.jsxs)(n.h3,{id:"daten-in-der-ntdsdit",children:["Daten in der ",(0,s.jsx)(n.code,{children:"ntds.dit"})]}),"\n",(0,s.jsxs)(n.p,{children:["Die Datei ",(0,s.jsx)(n.code,{children:"ntds.dit"})," enth\xe4lt \u2014 technisch gesehen \u2014 zun\xe4chst einmal eine EseDB-Datenbank (Extensible Storage Engine) mit mehreren Tabellen. Die Daten des Active Directory liegen in der Tabelle datatable; viele Verkn\xfcpfungen zwischen Objekten, bspw. Gruppenmitgliedschaften, sind in der Tabelle ",(0,s.jsx)(n.code,{children:"link_table"})," gespeichert."]}),"\n",(0,s.jsxs)(n.p,{children:["Jedes ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Objekt entspricht einer Zeile (engl. ",(0,s.jsx)(n.code,{children:"row"}),") der Tabelle ",(0,s.jsx)(n.code,{children:"datatable"}),". Diese Tabelle hat eine Vielzahl von Spalten, je nachdem, wie genau das Schema des ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," aussieht. F\xfcr jedes Attribut eines ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Objekts existiert eine Spalte. Der Datentyp der Spalte sowie die Interpretation des Wertes obliegt dem Programm, das den Wert ausliest. Angenommen, wir wollen herausfinden, ob ein Account abgelaufen ist. Dann m\xfcssen wir folgende Schritte durchf\xfchren"]}),"\n",(0,s.jsxs)(n.p,{children:["Wir ermitteln die Spalte mit dem Namen ",(0,s.jsx)(n.code,{children:"ATTq589983"})," und lesen den Wert aus"]}),"\n",(0,s.jsxs)(n.p,{children:["Der Wert in der Spalte ist (im Beispiel) ",(0,s.jsx)(n.code,{children:"9223372036854775807"}),", mit dem Datentyp ",(0,s.jsx)(n.code,{children:"Currency"})," (W\xe4hrung). Nat\xfcrlich handelt es sich nicht um Geld, sondern einfach um eine 64 Bit gro\xdfe Zahl, die die Anzahl der 100 Nanosekunden seit 01.01.1601 angibt ",(0,s.jsx)(n.a,{href:"#a3",children:"[3]"}),", und zwar in ",(0,s.jsx)(n.a,{href:"#UTC",children:"UTC"}),". Diese Zahl entspricht dem Zeitstempel ",(0,s.jsx)(n.code,{children:"9999-12-31T23:59:59+0000"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Theoretisch. Tats\xe4chlich ist diese Zahl auch gleichzeitig die gr\xf6\xdfte Zahl, die als 64 Bit mit Vorzeichen darstellbar ist. Microsoft hat diesen Wert vorgesehen, um zu speichern, dass ein Account nie abl\xe4uft ",(0,s.jsx)(n.a,{href:"#a4",children:"[4]"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Die Antwort ist also: Der Account ist nicht abgelaufen."}),"\n",(0,s.jsxs)(n.h3,{id:"record-id-und-row-id",children:[(0,s.jsx)(n.em,{children:"Record ID"})," und ",(0,s.jsx)(n.em,{children:"Row ID"})]}),"\n",(0,s.jsxs)(n.p,{children:["Die Eintr\xe4ge in der ",(0,s.jsx)(n.code,{children:"datatable"})," k\xf6nnen normalerweise mit dem Attribute ",(0,s.jsx)(n.code,{children:"DsRecordId"})," eindeutig identifiziert werden. Dieses Attribut wird nachfolgend mit ",(0,s.jsx)(n.em,{children:"Record ID"})," bezeichnet und ist eine Eigenschaft eines ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"}),"-Objekts."]}),"\n",(0,s.jsxs)(n.p,{children:["Allerdings nutzen einige Verkn\xfcpfungen nicht das Feld ",(0,s.jsx)(n.code,{children:"DsRecordId"}),", sondern die Nummer der Zeile in der ",(0,s.jsx)(n.code,{children:"datatable"}),". Das ist beispielsweise bei der Speicherung von Gruppenmitgliedschaften der Fall. Aus diesem Grund wird von ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," zus\xe4tzlich zur ",(0,s.jsx)(n.em,{children:"Record ID"})," auch immer die Zeilennummer (",(0,s.jsx)(n.em,{children:"Row ID"}),") mit ausgelesen und verwendet."]}),"\n",(0,s.jsx)(n.h2,{id:"timeline-analyse",children:"Timeline-Analyse"}),"\n",(0,s.jsx)(n.h3,{id:"zeitstempel",children:"Zeitstempel"}),"\n",(0,s.jsxs)(n.p,{children:["Obwohl EseDB einen eigenen Datentyp f\xfcr Zeitstempel hat, nutzt ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," den Datentyp ",(0,s.jsx)(n.code,{children:"Currency"}),", um einen Zeitstempel im Format ",(0,s.jsx)(n.a,{href:"#filetime",children:"FILETIME"})," zu speichern. Einige Werte haben eine besondere Bedeutung, die bei der forensischen Analyse ber\xfccksichtigt werden sollte:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Attribut"}),(0,s.jsxs)(n.th,{children:["Bedeutung von ",(0,s.jsx)(n.code,{children:"0x0000000000000000"})]}),(0,s.jsxs)(n.th,{children:["Bedeutung von ",(0,s.jsx)(n.code,{children:"0x7FFFFFFFFFFFFFFF"})]})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"record_time"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"when_created"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"when_created"})}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"last_logon"})}),(0,s.jsx)(n.td,{children:"Es ist unbekannt, wann die letzte Anmeldung war"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"last_logon_time_stamp"})}),(0,s.jsx)(n.td,{children:"Es ist unbekannt, wann die letzte Anmeldung war"}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"account_expires"})}),(0,s.jsxs)(n.td,{children:['"Wenn zu einem beliebigen Zeitpunkt ein Konto, das mit einer Ablaufzeit konfiguriert wurde, auf Nie l\xe4uft ab, wird das ',(0,s.jsx)(n.code,{children:"accountExpires"}),'-Attribut auf 0 festgelegt." ',(0,s.jsx)(n.a,{href:"#accountExpires",children:"[6]"})]}),(0,s.jsxs)(n.td,{children:['"Wenn ein Konto erstellt wird, wird das Konto zun\xe4chst auf Nie ablaufen festgelegt. Das accountExpires-Attribut ist auf den Standardwert von ',(0,s.jsx)(n.code,{children:"9223372036854775807"}),' festgelegt, ein Wert, der dem H\xf6chstwert einer 64-Bit-Ganzzahl mit Vorzeichen entspricht."',(0,s.jsx)(n.a,{href:"#accountExpires",children:"[6]"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"password_last_set"})}),(0,s.jsxs)(n.td,{children:["Wenn das ",(0,s.jsx)(n.a,{href:"#UAC",children:"UAC"}),"-Flag ",(0,s.jsx)(n.code,{children:"UF_DONT_EXPIRE_PASSWD"})," nicht gesetzt ist, dann muss der Benutzer das Passwort bei der n\xe4chsten Anmeldung \xe4ndern."]}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bad_pwd_time"})}),(0,s.jsx)(n.td,{children:"Es ist unbekannt, wann der letzte erfolglose Anmeldeversuch war"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"erstellen-der-timeline",children:"Erstellen der Timeline"}),"\n",(0,s.jsxs)(n.p,{children:["Zun\xe4chst verschaffen wir uns einen \xdcberblick \xfcber die Aktivit\xe4ten in der Datenbank innerhalb eines bestimmten Zeitraums. Wir nutzen daf\xfcr die Programme ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," und ",(0,s.jsx)(n.a,{href:"#mactime",children:(0,s.jsx)(n.code,{children:"mactime2"})}),", und zur sch\xf6neren Darstellung ",(0,s.jsx)(n.a,{href:"#xsv",children:(0,s.jsx)(n.code,{children:"xsv"})}),". Das Kommando"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"ntdsextract2 ntds.dit timeline | mactime2 -d | xsv table\n"})}),"\n",(0,s.jsx)(n.p,{children:"erzeugt folgende Ausgabe:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"2016-07-10T08:05:50+00:00  0   m...      0   0   1817  SUPPORT_388945a0 (Person, password last set)\n2016-07-10T08:15:31+00:00  0   m...      0   0   1861  krbtgt (Person, password last set)\n2016-07-10T08:15:59+00:00  0   m...      0   0   1836  ADDEMO$ (Computer, password last set)\n2016-07-10T10:01:44+00:00  0   m...      0   0   1815  Administrator (Person, password last set)\n2016-07-10T10:55:22+00:00  0   .a..      0   0   1815  Administrator (Person, last logon on this DC)\n2016-07-10T10:55:23+00:00  0   .a..      0   0   1836  ADDEMO$ (Computer, last logon on this DC)\n2016-07-10T10:55:29+00:00  0   m...      0   0   3276  user01 (Person, password last set)\n2016-07-10T10:55:35+00:00  0   m...      0   0   3277  user02 (Person, password last set)\n2016-07-10T10:55:35+00:00  0   m...      0   0   3278  user03 (Person, password last set)\n2016-07-10T10:55:35+00:00  0   m...      0   0   3279  user04 (Person, password last set)\n...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Das ist eine chronologisch sortierte Abfolge von Ereignissen, die im untersuchten ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," stattgefunden haben. Man kann hier mehrere Informationen sehen:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2016-07-10T08:05:50+00:00"})}),(0,s.jsxs)(n.td,{children:["Das ist ein Zeitstempel in einem ",(0,s.jsx)(n.a,{href:"#RFC3339",children:"RFC3339"}),"-konformen Format."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SUPPORT_388945a0 (Person, password last set)"})}),(0,s.jsxs)(n.td,{children:["Der Name des Objekts ist ",(0,s.jsx)(n.code,{children:"SUPPORT_388945a0"}),", der Objekttyp ist Person (was einem Benutzerkonto entspricht), und zu der angegebenen Zeit wurde das Passwort des Accounts gesetzt."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1817"})}),(0,s.jsxs)(n.td,{children:["In der Ausgabe von ",(0,s.jsx)(n.a,{href:"#mactime2",children:(0,s.jsx)(n.code,{children:"mactime2"})})," steht hier normalerweise die ",(0,s.jsx)(n.em,{children:"Inode ID"}),", als eindeutige ID einer Datei im Dateisystem. Das ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," hat keine Inodes, wohl aber eine ",(0,s.jsx)(n.em,{children:"Record ID"})," (im Attribut ",(0,s.jsx)(n.code,{children:"DsRecordId"}),"). ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," schreibt diese Zahl in das Inode-Feld."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"last logon on this DC"})}),(0,s.jsxs)(n.td,{children:["Dieser Zeitstempel gibt an, wann sich der Benutzer an diesem Domain Controller angemeldet hat. Wenn man eine Kopie der ",(0,s.jsx)(n.code,{children:"ntds.dit"})," von einem anderen Domain Controller analysieren w\xfcrde, w\xfcrde bei diesem Timestamp die Meldung ",(0,s.jsx)(n.code,{children:"last logon on any DC"})," stehen."]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"unterst\xfctzte-timestamps",children:"Unterst\xfctzte Timestamps"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," kann aktuell folgende Timestamps darstellen:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Attribut"}),(0,s.jsx)(n.th,{children:"Meldung"}),(0,s.jsx)(n.th,{children:"Beschreibung"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DsRecordTime"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"record creation time"})}),(0,s.jsx)(n.td,{children:"Erstellung des AD-Eintrags"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttWhenCreated"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object created"})}),(0,s.jsx)(n.td,{children:"Erstellung des Objekts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttWhenChanged"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object changed"})}),(0,s.jsx)(n.td,{children:"Letzte \xc4nderung des Objekts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttLastLogon"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"last logon on this DC"})}),(0,s.jsx)(n.td,{children:"Letzte Anmeldung an diesem DC"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttLastLogonTimestamp"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"last logon on any DC"})}),(0,s.jsx)(n.td,{children:"Letzte Anmeldung an einem anderen DC"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttBadPasswordTime"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bad pwd time"})}),(0,s.jsx)(n.td,{children:"Letztmalige Falscheingabe des Passworts"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AttPwdLastSet"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"password last set"})}),(0,s.jsx)(n.td,{children:"Letzte \xc4nderung des Passworts"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"weitere-analysem\xf6glichkeiten",children:"Weitere Analysem\xf6glichkeiten"}),"\n",(0,s.jsx)(n.h3,{id:"gel\xf6schte-objekte-anzeigen",children:"Gel\xf6schte Objekte anzeigen"}),"\n",(0,s.jsxs)(n.p,{children:["Interessant f\xfcr Forensiker: Wenn im ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," ein Objekt gel\xf6scht, dann wird es zun\xe4chst nicht physisch gel\xf6scht, sondern in den Container Deleted Objects verschoben und umbenannt. Angenommen, wir l\xf6schen das Objekt ",(0,s.jsx)(n.code,{children:"cn=user01,cn=Users,dc=demo,cn=local"}),", und angenommen die ",(0,s.jsx)(n.a,{href:"#UUID",children:"UUID"})," des Containers ",(0,s.jsx)(n.code,{children:"cn=Users,dc=demo,cn=local"})," ist ",(0,s.jsx)(n.code,{children:"261d3f52-7117-4ef9-8cdb-1cc6fa87a31c"}),". Dann hat das Objekt anschlie\xdfend den ",(0,s.jsx)(n.a,{href:"#DN",children:"DN"})," ",(0,s.jsx)(n.code,{children:"cn=user01\\0ADEL:261d3f52-7117-4ef9-8cdb-1cc6fa87a31c,cn=Deleted Objects,dc=demo,cn=local"}),". Mit Hilfe der ",(0,s.jsx)(n.a,{href:"#UUID",children:"UUID"})," l\xe4sst sich der urspr\xfcngliche Speicherort rekonstruieren."]}),"\n",(0,s.jsxs)(n.p,{children:["Erst nach Ablauf der ",(0,s.jsx)(n.em,{children:"Tompstone Lifetime"})," (",(0,s.jsx)(n.a,{href:"#TSL",children:"TSL"}),"), die je nach Serverversion standardm\xe4\xdfig 60-180 Tage betr\xe4gt ",(0,s.jsx)(n.a,{href:"#a19",children:"[10]"}),", wird das Objekt wirklich physisch gel\xf6scht. Bis dahin ist das Objekt (leicht ver\xe4ndert; s.o.) noch vorhanden und kann durch ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," angezeigt werden, wenn man die timeline mit dem Schalter ",(0,s.jsx)(n.code,{children:"--include-deleted"})," aktiviert."]}),"\n",(0,s.jsx)(n.h3,{id:"verzeichnisbaum-anzeigen",children:"Verzeichnisbaum anzeigen"}),"\n",(0,s.jsxs)(n.p,{children:["Eine weitere M\xf6glichkeit, sich einen \xdcberblick zu verschaffen, ist das Kommando ",(0,s.jsx)(n.code,{children:"tree"})," von ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"$ ntdsextract2 ntds.dit tree\ncn=$ROOT_OBJECT$ (id=2/row=1)\n\u251c\u2500\u2500 o=Boot (id=4/row=2)\n\u2502   \u251c\u2500\u2500 cn=Schema (id=5/row=3)\n\u2502   \u2514\u2500\u2500 cn=BootMachine (id=7/row=5)\n\u2514\u2500\u2500 cn=local (id=1457/row=1267)\n    \u2514\u2500\u2500 dc=demo (id=1458/row=1268)\n        \u251c\u2500\u2500 cn=System (id=1468/row=1278)\n        \u2502   \u251c\u2500\u2500 cn=Default Domain Policy (id=1689/row=1487)\n        \u2502   \u251c\u2500\u2500 cn=Meetings (id=1691/row=1489)\n        \u2502   \u251c\u2500\u2500 cn=RID Manager$ (id=1880/row=1652)\n        \u2502   \u251c\u2500\u2500 cn=RpcServices (id=1685/row=1483)\n        \u2502   \u251c\u2500\u2500 cn=Dfs-Configuration (id=1701/row=1499)\n        \u2502   \u251c\u2500\u2500 cn=BCKUPKEY_79ba72fa-c30c-4c8c-b832-91c5ac912716 Secret (id=1951/row=1719)\n        \u2502   \u251c\u2500\u2500 cn=IP Security (id=1702/row=1500)\n        \u2502   \u251c\u2500\u2500 cn=Server (id=1835/row=1607)\n        \u2502   \u251c\u2500\u2500 cn=BCKUPKEY_fc41aaf0-2a1e-4629-a6ae-a0d755f39395 Secret (id=1953/row=1721)\n        \u2502   \u251c\u2500\u2500 cn=DomainUpdates (id=1751/row=1531)\n        \u2502   \u251c\u2500\u2500 cn=File Replication Service (id=1700/row=1498)\n        \u2502   \u251c\u2500\u2500 cn=BCKUPKEY_P Secret (id=1952/row=1720)\n        \u2502   \u251c\u2500\u2500 cn=ComPartitionSets (id=1745/row=1525)\n        \u2502   \u251c\u2500\u2500 cn=RAS and IAS Servers Access Check (id=1699/row=1497)\n        \u2502   \u251c\u2500\u2500 cn=ComPartitions (id=1744/row=1524)\n        \u2502   \u251c\u2500\u2500 cn=WMIPolicy (id=1746/row=1526)\n        \u2502   \u251c\u2500\u2500 cn=BCKUPKEY_PREFERRED Secret (id=1954/row=1722)\n        \u2502   \u251c\u2500\u2500 cn=MicrosoftDNS (id=1884/row=1656)\n        \u2502   \u251c\u2500\u2500 cn=AdminSDHolder (id=1743/row=1523)\n        \u2502   \u251c\u2500\u2500 cn=FileLinks (id=1686/row=1484)\n        \u2502   \u251c\u2500\u2500 cn=Policies (id=1692/row=1490)\n        \u2502   \u2514\u2500\u2500 cn=WinsockServices (id=1684/row=1482)\n        \u251c\u2500\u2500 cn=Users (id=1465/row=1275)\n        \u2502   \u251c\u2500\u2500 cn=user08 (id=3283/row=3051)\n        \u2502   \u251c\u2500\u2500 cn=user37 (id=3312/row=3080)\n        \u2502   \u251c\u2500\u2500 cn=user06 (id=3281/row=3049)\n...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Auch hier sieht man wieder die ",(0,s.jsx)(n.em,{children:"Record ID"})," (Attribut ",(0,s.jsx)(n.code,{children:"DsRecordId"}),"), die bereits in der ",(0,s.jsx)(n.a,{href:"#erstellen-der-timeline",children:"Timeline-Analyse"})," aufgetaucht ist. Zus\xe4tzlich ist die Zeilennummer (",(0,s.jsx)(n.code,{children:"row"}),") innerhalb der Datentabelle der ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," Datenbank angezeigt. Als Name der jeweiligen Objekte wird in der Baumansicht immer der ",(0,s.jsx)(n.em,{children:"Relative Distinguished Name"})," (",(0,s.jsx)(n.a,{href:"#RDN",children:"RDN"}),") angezeigt. Zus\xe4tzlich mit dem ",(0,s.jsx)(n.em,{children:"Distinguished Name"})," (",(0,s.jsx)(n.a,{href:"#DN",children:"DN"}),") des Elternobjekts l\xe4sst sich der ",(0,s.jsx)(n.a,{href:"#DN",children:"DN"})," eines bestimmten Objekts bilden. Beispielsweise ist ",(0,s.jsx)(n.code,{children:"cn=user06,cn=Users,dc=demo,cn=local"})," der ",(0,s.jsx)(n.a,{href:"#DN",children:"DN"})," des Benutzers ",(0,s.jsx)(n.code,{children:"user06"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"computerkonten-anzeigen",children:"Computerkonten anzeigen"}),"\n",(0,s.jsx)(n.p,{children:"Als n\xe4chstes schauen wir uns die Computerkonten an:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"ntdsextract2 ntds.dit computer -F json-lines -D | jq\n"})}),"\n",(0,s.jsx)(n.p,{children:"Die Befehle zum Anzeigen von Benutzern, Computern oder Gruppen unterst\xfctzen drei Ausgabeformate:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"csv"})," (einzelne sind mit Semikolon voneinander getrennt)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"json"})," (formatiertes ",(0,s.jsx)(n.a,{href:"#JSON",children:"JSON"}),"; als Liste von Einzelobjekten)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"json-lines"})," (ein ",(0,s.jsx)(n.a,{href:"#JSON",children:"JSON"}),"-Objekt pro Zeile)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Das Format ",(0,s.jsx)(n.code,{children:"json-lines"})," eignet sich hervorragend zur Weiterverarbeitung durch Programme wie etwa ",(0,s.jsx)(n.a,{href:"#jq",children:(0,s.jsx)(n.code,{children:"jq"})}),", was ich im Beispiel oben demonstriert habe. Die Ausgabe mit meinen Beispieldaten ist ziemlich kurz:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "sid": "S-1-5-21-3188177830-2933342842-421106997-1003",\n  "distinguished_name": "cn=ADDEMO,ou=Domain Controllers,dc=demo,cn=local",\n  "user_principal_name": null,\n  "rdn": "ADDEMO",\n  "sam_account_name": "ADDEMO$",\n  "sam_account_type": "SAM_MACHINE_ACCOUNT",\n  "user_account_control": "ADS_UF_SERVER_TRUST_ACCOUNT | ADS_UF_TRUSTED_FOR_DELEGATION",\n  "logon_count": 10,\n  "bad_pwd_count": 0,\n  "admin_count": null,\n  "is_deleted": false,\n  "primary_group_id": 516,\n  "primary_group": "Domain Controllers",\n  "member_of": [],\n  "comment": null,\n  "record_time": "1601-06-01T18:23:32+0000",\n  "when_created": "1601-06-01T18:23:32+0000",\n  "when_changed": "1601-06-01T18:23:32+0000",\n  "last_logon": "2016-07-10T10:55:23+0000",\n  "last_logon_time_stamp": null,\n  "account_expires": "9999-12-31T23:59:59+0000",\n  "password_last_set": "2016-07-10T08:15:59+0000",\n  "bad_pwd_time": "1601-01-01T00:00:00+0000",\n  "creator_sid": null\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Hier sind zwei Attribute hervorzuheben:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"distinguished_name"})," ist kein Attribut des Objekts, sondern wird wie oben beschrieben aus dem ",(0,s.jsx)(n.a,{href:"#RDN",children:"RDN"})," des Objekts und dem ",(0,s.jsx)(n.a,{href:"#DN",children:"DN"})," des Elternobjekts gebildet. Deswegen wird dieses Attribut standardm\xe4\xdfig auch nicht angezeigt. Mit der Option ",(0,s.jsx)(n.code,{children:"--include-dn"})," bzw. ",(0,s.jsx)(n.code,{children:"-H"})," l\xe4sst sich die Anzeige aber aktivieren"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"creator_sid"})," zeigt die Security ID (",(0,s.jsx)(n.a,{href:"#SID",children:"SID"}),") des Benutzers an, der diesen Computer zum ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," hinzugef\xfcgt hat, falls dieser Benutzer kein Administrator ist. What???!!!! Das geht? Ja. Wenn die Eigenschaft ",(0,s.jsx)(n.a,{href:"#a12",children:(0,s.jsx)(n.code,{children:"ms-DS-MachineAccountQuota"})})," einen Wert gr\xf6\xdfer 0 hat, dann gibt dieser Wert an, wie viele Computer ein eingeschr\xe4nkter Benutzer ins ",(0,s.jsx)(n.a,{href:"#AD",children:"AD"})," aufnehmen darf. Standardm\xe4\xdfig ist dieser Wert auf 10 gestellt. Wir haben bereits Angriffe analysiert, bei denen diese Eigenschaft ausgenutzt wurde; und wir haben entsprechend auff\xe4llige Computer gesehen haben.\nEine einfache Option, verd\xe4chtige Computerkonten zu ermitteln, ist also indem man mit ",(0,s.jsx)(n.code,{children:" | jq 'select(.creator_sid!=null)'"})," filtert."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"benutzerkonten-anzeigen",children:"Benutzerkonten anzeigen"}),"\n",(0,s.jsxs)(n.p,{children:["Bis jetzt haben wir keine Auff\xe4lligkeiten gefunden. Schauen wir uns als n\xe4chstes mal alle Benutzer an, die Mitglied der Gruppe ",(0,s.jsx)(n.code,{children:"Domain Admins"})," sind. Dazu nutzen wir wieder ",(0,s.jsx)(n.a,{href:"#jq",children:(0,s.jsx)(n.code,{children:"jq"})}),":"]}),"\n",(0,s.jsx)(n.h4,{id:"kommando",children:"Kommando"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"ntdsextract2 ntds.dit user -F json-lines -D | jq 'select(.member_of | contains([\"Domain Admins\"]))'\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ausgabe",children:"Ausgabe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "sid": "S-1-5-21-3188177830-2933342842-421106997-500",\n  "distinguished_name": "cn=Administrator,cn=Users,dc=demo,cn=local",\n  "user_principal_name": null,\n  "rdn": "Administrator",\n  "sam_account_name": "Administrator",\n  "sam_account_type": "SAM_USER_OBJECT",\n  "user_account_control": "ADS_UF_NORMAL_ACCOUNT | ADS_UF_DONT_EXPIRE_PASSWD",\n  "logon_count": 4,\n  "bad_pwd_count": 0,\n  "admin_count": null,\n  "is_deleted": false,\n  "primary_group_id": 513,\n  "primary_group": "Domain Users",\n  "member_of": [\n    "Group Policy Creator Owners",\n    "Domain Admins",\n    "Administrators",\n    "Schema Admins",\n    "Enterprise Admins"\n  ],\n  "comment": null,\n  "record_time": "1601-06-01T18:23:32+0000",\n  "when_created": "1601-06-01T18:23:32+0000",\n  "when_changed": "1601-06-01T18:23:32+0000",\n  "last_logon": "2016-07-10T10:55:22+0000",\n  "last_logon_time_stamp": null,\n  "account_expires": "9999-12-31T23:59:59+0000",\n  "password_last_set": "2016-07-10T10:01:44+0000",\n  "bad_pwd_time": "1601-01-01T00:00:00+0000"\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Die Gruppenmitgliedschaften von Benutzern und Computern zu pr\xfcfen sollte Teil jeder forensischen Untersuchung sollte sein."})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," bietet die M\xf6glichkeit, alternativ zum ",(0,s.jsx)(n.a,{href:"#RDN",children:"RDN"})," des Gruppennamens auch den vollst\xe4ndigen ",(0,s.jsx)(n.a,{href:"#DN",children:"DN"})," anzuzeigen, oder auch die ",(0,s.jsx)(n.a,{href:"#SID",children:"SID"})," oder den Wert von ",(0,s.jsx)(n.code,{children:"samAccountName"}),". Die Option ",(0,s.jsx)(n.code,{children:"--member-of"})," erlaubt die Auswahl des gew\xfcnschten Wertes."]}),"\n",(0,s.jsx)(n.h3,{id:"detailansicht-eines-eintrags",children:"Detailansicht eines Eintrags"}),"\n",(0,s.jsxs)(n.p,{children:["Es kann durchaus sein, dass man sich w\xe4hrend einer Untersuchung f\xfcr die Details eines Eintrags interessiert. Es gibt die M\xf6glichkeit, sich mit ",(0,s.jsx)(n.a,{href:"#a1",children:(0,s.jsx)(n.code,{children:"ntdsextract2"})})," und dem Kommando ",(0,s.jsx)(n.code,{children:"entry"})," die Rohdaten eines Eintrags anzeigen zu lassen. Dabei hat man die Wahl, ob f\xfcr den Eintrag die ",(0,s.jsx)(n.em,{children:"Record ID"})," (",(0,s.jsx)(n.code,{children:"DsRecordId"}),") oder die ",(0,s.jsx)(n.a,{href:"#RID",children:"RID"})," angegeben wird (die ",(0,s.jsx)(n.a,{href:"#SID",children:"SID"})," eines Benutzers besteht grob aus zwei Teilen: eine Domain-ID und eine ",(0,s.jsx)(n.a,{href:"#SID",children:"SID"}),". Die Domain-ID ist f\xfcr alle Benutzer in einer Dom\xe4ne identisch. Die ",(0,s.jsx)(n.a,{href:"#RID",children:"RID"})," ist der Teil der ",(0,s.jsx)(n.a,{href:"#SID",children:"SID"})," nach dem letzten Minus;  bspw. ist ",(0,s.jsx)(n.code,{children:"500"})," die ",(0,s.jsx)(n.a,{href:"#RID",children:"RID"})," von ",(0,s.jsx)(n.code,{children:"S-1-5-21-3188177830-2933342842-421106997-500"}),")."]}),"\n",(0,s.jsx)(n.h4,{id:"kommando-1",children:"Kommando"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"ntdsextract2 ntds.dit entry --sid 500\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ausgabe-1",children:"Ausgabe"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"AttAccountExpires        : Currency(9223372036854775807)\nAttBadPasswordTime       : Currency(0)\nAttBadPwdCount           : I32(0)\nAttCodePage              : I32(0)\nAttCommonName            : LargeText(Administrator)\nAttCountryCode           : I32(0)\nAttDbcsPwd               : LargeBinary([17, 0, 0, 0, 0, 0, 0, 0, 208, 94, 27, 88, 60, 180, 61, 222, 135, 179, 115, 44, 163, 220, 20, 58, 223, 210, 160, 16, 8, 4, 18, 48, 181, 46, 245, 200, 161, 47, 192, 91])\nAttDescription           : LargeText(Built-in account for administering the computer/domain)\nAttInstanceType          : I32(4)\nAttIsCriticalSystemObject: I32(1)\nAttLastLogoff            : Currency(0)\nAttLastLogon             : Currency(131126217226406250)\nAttLogonCount            : I32(4)\nAttNtSecurityDescriptor  : LargeBinary([51, 0, 0, 0, 0, 0, 0, 0])\nAttObjDistName           : I32(1815)\nAttObjectCategory        : I32(1128)\nAttObjectClass           : Multi\nAttObjectGuid            : LargeBinary([196, 146, 141, 186, 125, 119, 164, 65, 163, 20, 106, 106, 58, 95, 246, 109])\nAttObjectSid             : LargeBinary([1, 5, 0, 0, 0, 0, 0, 5, 21, 0, 0, 0, 166, 187, 7, 190, 122, 66, 215, 174, 53, 149, 25, 25, 0, 0, 1, 244])\nAttPrimaryGroupId        : I32(513)\nAttPwdLastSet            : Currency(131126185044375000)\nAttRdn                   : LargeText(Administrator)\nAttReplPropertyMetaData  : Long\nAttSamAccountName        : LargeText(Administrator)\nAttSamAccountType        : I32(805306368)\nAttUnicodePwd            : LargeBinary([17, 0, 0, 0, 0, 0, 0, 0, 44, 105, 0, 122, 74, 180, 161, 23, 83, 211, 68, 233, 176, 234, 208, 74, 152, 44, 61, 208, 167, 250, 124, 156, 131, 136, 137, 221, 25, 221, 51, 1])\nAttUserAccountControl    : I32(66048)\nAttUsnChanged            : Currency(8194)\nAttUsnCreated            : Currency(8194)\nAttWhenChanged           : Currency(13112612035)\nAttWhenCreated           : Currency(13112612035)\nDsAncestors              : LargeBinary([2, 0, 0, 0, 177, 5, 0, 0, 178, 5, 0, 0, 185, 5, 0, 0, 23, 7, 0, 0])\nDsParentRecordId         : I32(1465)\nDsRecordId               : I32(1815)\nDsRecordTime             : Currency(13112612035)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Bei der Ausgabe von ",(0,s.jsx)(n.code,{children:"entry"})," ist zu sehen, dass keine Interpretation der Daten vorgenommen wird. Der Wert von ",(0,s.jsx)(n.code,{children:"DsRecordTime"})," ist beispielsweise vom Typ ",(0,s.jsx)(n.code,{children:"Currency"}),"(",(0,s.jsx)(n.code,{children:"13112612035"}),"), weil ",(0,s.jsx)(n.code,{children:"Currency"})," der interne Datentyp f\xfcr Festkommazahlen mit 64bit L\xe4nge ist. Die Interpretation von Daten durch eine Software ist immer fehleranf\xe4llig (",(0,s.jsx)(n.em,{children:"nicht"})," fehlerhaft, aber anf\xe4llig); beispielsweise k\xf6nnte ein Zeitstempel falsch berechnet sein. Durch den Verzicht auf jegliche Interpretation bei der Ausgabe von ",(0,s.jsx)(n.code,{children:"entry"})," wird diese Art von Fehlern ausgeschlossen."]}),"\n",(0,s.jsx)(n.h2,{id:"abk\xfcrzungen",children:"Abk\xfcrzungen"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"AD",children:"AD"})}),(0,s.jsx)(n.td,{children:"Active Directory"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"DN",children:"DN"})}),(0,s.jsx)(n.td,{children:"Distinguished Name"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"EseDB",children:"EseDB"})}),(0,s.jsx)(n.td,{children:"Extensible Storage Engine Database"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"JSON",children:"JSON"})}),(0,s.jsx)(n.td,{children:"Javascript Object Notation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"RDN",children:"RDN"})}),(0,s.jsx)(n.td,{children:"Relative Distinguished Name"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"RID",children:"RID"})}),(0,s.jsx)(n.td,{children:"Relative Identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"SID",children:"SID"})}),(0,s.jsx)(n.td,{children:"Security Identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"TSL",children:"TSL"})}),(0,s.jsx)(n.td,{children:"Tompstone Lifetime"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"UAC",children:"UAC"})}),(0,s.jsx)(n.td,{children:"User Acount Control"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"UTC",children:"UTC"})}),(0,s.jsx)(n.td,{children:"Universal Time Coordinated"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"UUID",children:"UUID"})}),(0,s.jsx)(n.td,{children:"Universally Unique Identifier"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"quellen",children:"Quellen"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a1",children:"[1]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://github.com/janstarke/ntdsextract2",children:"https://github.com/janstarke/ntdsextract2"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a2",children:"[2]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://blog.didierstevens.com/2016/07/12/practice-ntds-dit-file-part-1",children:"https://blog.didierstevens.com/2016/07/12/practice-ntds-dit-file-part-1"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a3",children:"[3]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime",children:"https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a4",children:"[4]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires",children:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"filetime",children:"[5]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime",children:"https://learn.microsoft.com/de-de/windows/win32/api/minwinbase/ns-minwinbase-filetime"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"accountExpires",children:"[6]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires",children:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-accountexpires"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"mactime2",children:"[7]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://github.com/dfir-dd/dfir-toolkit/blob/main/doc/mactime2.md",children:"https://github.com/dfir-dd/dfir-toolkit/blob/main/doc/mactime2.md"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"xsv",children:"[8]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://github.com/BurntSushi/xsv",children:"https://github.com/BurntSushi/xsv"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"RFC3339",children:"[9]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc3339",children:"https://datatracker.ietf.org/doc/html/rfc3339"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a10",children:"[10]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-tombstonelifetime",children:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-tombstonelifetime"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"jq",children:"[11]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://jqlang.github.io/jq/",children:"https://jqlang.github.io/jq/"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)("a",{id:"a12",children:"[12]"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-ms-ds-machineaccountquota",children:"https://learn.microsoft.com/de-de/windows/win32/adschema/a-ms-ds-machineaccountquota"})})]})]})]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var s=i(6540);const r={},t=s.createContext(r);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);